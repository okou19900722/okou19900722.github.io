{"pageProps":{"categories":["releases","guides","news"],"category":"guides","page":5,"posts":[{"filename":"blog/2017-01-25-building-services-and-apis-with-amqp-1-0.mdx","date":"2017-01-25","slug":"building-services-and-apis-with-amqp-1-0","meta":{"title":"Building services and APIs with AMQP 1.0","category":"guides","authors":[{"name":"Jakub Scholz","github_id":"scholzj"}],"summary":"Microservices and APIs are everywhere. Everyone talks about them, presentation slides are full of them ... some people are actually even building them."},"readingTime":{"text":"8 min read","minutes":7.475,"time":448500,"words":1495},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Mi\\xADcroser\\xADvices and APIs are every\\xADwhere. Every\\xADone talks about them, pre\\xADsen\\xADta\\xADtion slides are full of them \\u2026 some peo\\xADple are ac\\xADtu\\xADally even build\\xADing them. Mi\\xADcroser\\xADvices and APIs are of course not com\\xADpletely new con\\xADcepts and they are a bit over-\\u200Bhyped. But in gen\\xADeral the ideas be\\xADhind them are not bad. Un\\xADfor\\xADtu\\xADnately, many peo\\xADple seem to be\\xADlieve that the only way how to im\\xADple\\xADment an API in mi\\xADcroser\\xADvice is to use HTTP and REST. That is of course not true. Mi\\xADcroser\\xADvices and APIs can be based on many dif\\xADfer\\xADent pro\\xADto\\xADcols and tech\\xADnolo\\xADgies. My fa\\xADvorite one is of course \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://www.amqp.org\"\n  }), \"AMQP\"), \". Don\\u2019t take me wrong, HTTP and REST is not nec\\xADes\\xADsar\\xADily bad. But in some cases AMQP is sim\\xADply bet\\xADter and cre\\xADat\\xADing AMQP based APIs does not need to be com\\xADpli\\xADcated.\"), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"This is a re-\\u200Bpublication of the fol\\xADlow\\xADing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://blog.effectivemessaging.com/2017/01/building-services-and-apis-with-amqp-10.html\"\n  }), \"blog post\"))), mdx(\"h2\", {\n    \"id\": \"livescore-service\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#livescore-service\"\n  })), \"LiveScore service\"), mdx(\"p\", null, \"For demon\\xADstra\\xADtion, I will use a very sim\\xADple ser\\xADvice for keep\\xADing scores of foot\\xADball games. It has very basic API. It has only three calls:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Add a new game\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Up\\xADdate a score of ex\\xADist\\xADing game\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"List the scores\\nThe AMQP vari\\xADants will be ad\\xADdi\\xADtion\\xADally able to push live up\\xADdates to the clients.\")), mdx(\"p\", null, \"The demo is using Java and Vert.x toolkit. \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx.io/\"\n  }), \"Vert.x\"), \" is cool and I def\\xADi\\xADnitely rec\\xADom\\xADmend it to every\\xADone. But most of the stuff from the demo should be pos\\xADsi\\xADble also in any other pro\\xADgram\\xADming lan\\xADguages and/or frame\\xADwork.\"), mdx(\"h2\", {\n    \"id\": \"http-api\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#http-api\"\n  })), \"HTTP API\"), mdx(\"p\", null, \"HTTP im\\xADple\\xADmen\\xADta\\xADtion of my ser\\xADvice is a typ\\xADi\\xADcal REST API. Since it is very sim\\xADple, it ac\\xADcepts re\\xADquests only on one end\\xADpoint \\u2013 /api/v1.0/scores. New games are added as POST op\\xADer\\xADa\\xADtions, scores are up\\xADdated with PUT op\\xADer\\xADa\\xADtions and list of all scores can be ob\\xADtained with GET.\"), mdx(\"p\", null, \"With Vert.x, cre\\xADat\\xADing HTTP/REST API is very easy. First the web router has to be cre\\xADated with all planned API calls:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"router = Router.router(vertx);  \\nrouter.route(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/v1.0/*\\\"\"), \").handler(BodyHandler.create());  \\nrouter.get(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/v1.0/scores\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::getScores);  \\nrouter.post(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/v1.0/scores\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::addGame);  \\nrouter.put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/api/v1.0/scores\\\"\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::setScore);  \\n\")), mdx(\"p\", null, \"Then the HTTP server has to be cre\\xADated and linked with the router:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"HttpServerOptions httpOptions = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" HttpServerOptions();  \\nserver = vertx.createHttpServer(httpOptions)  \\n   .requestHandler(router::accept)  \\n   .listen(httpPort);  \\n\")), mdx(\"p\", null, \"And fi\\xADnally the han\\xADdlers which will be trig\\xADgered for each API call have to be im\\xADple\\xADmented as well. The full code is on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/scholzj/livescore-demo-vertx-http\"\n  }), \"GitHub\"), \".\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/services-and-apis-with-amqp/HTTP-API.png\",\n    \"alt\": null\n  }))), mdx(\"p\", null, \"The HTTP API doesn\\u2019t pro\\xADvide any way how to au\\xADto\\xADmat\\xADi\\xADcally push the score up\\xADdates to the clients. The clients sim\\xADply have to poll the ser\\xADvice pe\\xADri\\xADod\\xADi\\xADcally to get the up\\xADdates. HTTP has of course some ways how to push live up\\xADdates to clients. For ex\\xADam\\xADple, with Web\\xADSock\\xADets or with chun\\xADked trans\\xADfers. How\\xADever, these are not that easy to im\\xADple\\xADment. The ser\\xADvice would also need to keep sep\\xADa\\xADrate con\\xADnec\\xADtion with every client and push the up\\xADdates for each of them sep\\xADa\\xADrately.\"), mdx(\"h2\", {\n    \"id\": \"amqp-api\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#amqp-api\"\n  })), \"AMQP API\"), mdx(\"p\", null, \"Cre\\xADat\\xADing the HTTP API was re\\xADally easy. Cre\\xADat\\xADing an AMQP API has to be more com\\xADpli\\xADcated, right? We would need an AMQP server, which will lis\\xADten on some port, ac\\xADcept the con\\xADnec\\xADtions, ses\\xADsions, links and so on. There are usu\\xADally no nice and sim\\xADple to use li\\xADbraries for this.\"), mdx(\"p\", null, \"Sure, this is one way how to do it. There is ac\\xADtu\\xADally a nice li\\xADbrary called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://qpid.apache.org/proton/index.html\"\n  }), \"Apache Qpid Pro\\xADton\"), \". It has Java and C ver\\xADsions and bind\\xADings into many other lan\\xADguages (Go, C++, Python, \\u2026). It makes cre\\xADat\\xADing your own AMQP server lot eas\\xADier. It will take care of de\\xADcod\\xADing and en\\xADcod\\xADing the AMQP pro\\xADto\\xADcol, han\\xADdling the con\\xADnec\\xADtions, ses\\xADsions etc. But still, Qpid Pro\\xADton is not even nearly as easy to use as the HTTP router used for the HTTP API.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/services-and-apis-with-amqp/AMQP-Server-API.png\",\n    \"alt\": \"API with AMQP server\"\n  }))), mdx(\"p\", null, \"Are there any eas\\xADier op\\xADtions? What if all what is needed to cre\\xADate AMQP based API is a sim\\xADple AMQP client? Nor\\xADmally, that should not be a pos\\xADsi\\xADble be\\xADcause we need the API to lis\\xADten on some port for the clients to con\\xADnect to it and send re\\xADquests. And clients usu\\xADally don\\u2019t lis\\xADten on any ports. How\\xADever, Apache Qpid has some\\xADthing called \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://qpid.apache.org/components/dispatch-router/index.html\"\n  }), \"Dis\\xADpatch\"), \". It works as a light\\xADweight AMQP router. Dis\\xADpatch will serve as the AMQP server which was miss\\xADing. It will take care of han\\xADdling client con\\xADnec\\xADtions, se\\xADcu\\xADrity and shield the ser\\xADvice from the ac\\xADtual clients. All the ser\\xADvice needs to do is to use AMQP client to con\\xADnect to Dis\\xADpatch on pre\\xADde\\xADfined ad\\xADdress and wait for the re\\xADquest.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/services-and-apis-with-amqp/AMQP-API.png\",\n    \"alt\": \"AMQP API with Dispatch router\"\n  }))), mdx(\"p\", null, \"Dis\\xADpatch needs to be con\\xADfig\\xADured with three API entry points as ad\\xADdresses:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"address {  \\n    prefix: /setScore  \\n    distribution: balanced  \\n}  \\naddress {  \\n    prefix: /getScore  \\n    distribution: balanced  \\n}  \\naddress {  \\n    prefix: /addGame  \\n    distribution: balanced  \\n}  \\n\")), mdx(\"p\", null, \"LiveScore ser\\xADvice will con\\xADnect to these ad\\xADdresses as a re\\xADceiver / con\\xADsumer. Clients will con\\xADnect to them as senders  /pro\\xADduc\\xADers. And Dis\\xADpatch will take care of rout\\xADing the mes\\xADsages be\\xADtween the clients and the ser\\xADvice. Clients can also cre\\xADate ad\\xADdi\\xADtional re\\xADceivers so that the ser\\xADvice is able to re\\xADspond to their re\\xADquests and spec\\xADify the ad\\xADdress of the re\\xADceiver as the reply-\\u200Bto header in the re\\xADquest mes\\xADsage. LiveScore ser\\xADvice will au\\xADto\\xADmat\\xADi\\xADcally send the re\\xADsponse to this ad\\xADdress. But spec\\xADi\\xADfy\\xADing a reply-\\u200Bto is not manda\\xADtory. If the client wants, it can sim\\xADply fire the re\\xADquest and for\\xADget about the re\\xADsponse.\"), mdx(\"p\", null, \"LiveScore ser\\xADvice is using Vert.x AMQP Bridge which al\\xADlows easy in\\xADte\\xADgra\\xADtion be\\xADtween the Vert.x Event Bus and the AMQP con\\xADnec\\xADtion to my router. The ser\\xADvice starts the AMQP Bridge and if it suc\\xADcess\\xADfully con\\xADnects to Dis\\xADpatch it cre\\xADates three re\\xADceivers for the API calls.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"AmqpBridgeOptions options = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" AmqpBridgeOptions().addEnabledSaslMechanism(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"ANONYMOUS\\\"\"), \");  \\nbridge = AmqpBridge.create(vertx, options);  \\nbridge.start(amqpHostname, amqpPort, res -> {  \\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (res.succeeded())  \\n   {  \\n     bridge.createConsumer(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/setScore\\\"\"), \").setMaxBufferedMessages(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"100\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::setScore);  \\n     bridge.createConsumer(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/getScores\\\"\"), \").setMaxBufferedMessages(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"100\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::getScores);  \\n     bridge.createConsumer(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/addGame\\\"\"), \").setMaxBufferedMessages(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"100\"), \").handler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"this\"), \"::addGame);  \\n     fut.complete();  \\n   }  \\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"else\"), \"  \\n   {  \\n     fut.fail(res.cause());  \\n   }  \\n});  \\n\")), mdx(\"p\", null, \"The only other thing which needs to be done is cre\\xADat\\xADing han\\xADdlers for han\\xADdling the re\\xADquests re\\xADceived from clients:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"public\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"getScores\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(Message<Object> msg)\"), \"  \\n\"), \"{  \\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \"(msg.replyAddress() != \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"null\"), \")  \\n   {  \\n     JsonObject response = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject();  \\n     response.put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"application_properties\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject().put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"status\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"200\"), \"));  \\n     response.put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"body\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonArray(Json.encode(scoreService.getScores())).encode());  \\n     msg.reply(response);  \\n   }  \\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"else\"), \"  \\n   {  \\n     LOG.warn(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Received LiveScore/getScores request without reply to address\\\"\"), \");  \\n   }  \\n}  \\n\")), mdx(\"p\", null, \"Live broad\\xADcast\\xADing of score up\\xADdates is also very easy. New ad\\xADdress has to be added into Dis\\xADpatch con\\xADfig\\xADu\\xADra\\xADtion. This ad\\xADdress will be used in op\\xADpo\\xADsite di\\xADrec\\xADtion. the ser\\xADvice con\\xADnects to it as sender / pro\\xADducer and clients which want to re\\xADceive the live up\\xADdates cre\\xADate a re\\xADceiver against this ad\\xADdress. What is im\\xADpor\\xADtant, this ad\\xADdress has to be marked as mul\\xADti\\xADcast. Thanks to that every sin\\xADgle mes\\xADsage will be de\\xADliv\\xADered to all con\\xADnected clients and not just to one of them:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"address {  \\n    prefix: /liveScores  \\n    distribution: multicast  \\n}  \\n\")), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/services-and-apis-with-amqp/AMQP-API-multicast.png\",\n    \"alt\": \"Multicasting messages\"\n  }))), mdx(\"p\", null, \"Thanks to the mul\\xADti\\xADcast dis\\xADtri\\xADb\\xADu\\xADtion, the ser\\xADvice doesn\\u2019t need to send a sep\\xADa\\xADrate up\\xADdate to every sin\\xADgle client. It sends the mes\\xADsage only once and dis\\xADpatch takes care of the rest.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"public\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"void\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"broadcastUpdates\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"(Game game)\"), \"  \\n\"), \"{  \\n   LOG.info(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Broadcasting game update \\\"\"), \" + game);  \\n   JsonObject message = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject();  \\n   message.put(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"body\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" JsonObject(Json.encode(game)).encode());  \\n   producer.send(message);  \\n} \\n\")), mdx(\"p\", null, \"Again, the com\\xADplete source codes of the demo ser\\xADvice are avail\\xADable on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/scholzj/livescore-demo-vertx-amqp-bridge\"\n  }), \"GitHub\"), \".\"), mdx(\"h2\", {\n    \"id\": \"how-to-structure-amqp-apis\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#how-to-structure-amqp-apis\"\n  })), \"How to structure AMQP APIs?\"), mdx(\"p\", null, \"Com\\xADpared to HTTP and REST, AMQP gives its users a lot more free\\xADdom when de\\xADsign\\xADing the API. It isn\\u2019t tied up by the avail\\xADable HTTP meth\\xADods.\"), mdx(\"p\", null, \"My LiveScore ser\\xADvice is using the API end\\xADpoints named ac\\xADcord\\xADing to their func\\xADtion:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"/LiveScore/ad\\xADdGame\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"/LiveScore/setScore\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"/LiveScore/getScores\\nIt also uses HTTP sta\\xADtus codes in ap\\xADpli\\xADca\\xADtion prop\\xADer\\xADties of the dif\\xADfer\\xADent mes\\xADsages to de\\xADscribe the re\\xADsult of the re\\xADquest and JSON as the mes\\xADsage pay\\xADload with the ac\\xADtual re\\xADquest and re\\xADsponse.\")), mdx(\"p\", null, \"Is that the best way? To be hon\\xADest, I don\\u2019t know. Just for the re\\xADquest en\\xADcod\\xADing there are many dif\\xADfer\\xADent op\\xADtions. AMQP has its own en\\xADcod\\xADings which sup\\xADports all pos\\xADsi\\xADble basic as well as more ad\\xADvanced data types and struc\\xADtures. But AMQP can also trans\\xADfer any opaque data - be it JSON, XML, Google Pro\\xADto\\xADcol Buffers or any\\xADthing else. For sim\\xADple re\\xADquest, the pay\\xADload can be com\\xADpletely skipped and ap\\xADpli\\xADca\\xADtion prop\\xADer\\xADties can be used in\\xADstead. And for every\\xADone who re\\xADally loves HTTP/REST, one can also model the API in REST style as I did in an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/scholzj/livescore-demo-vertx-amqp-bridge-rest-style\"\n  }), \"al\\xADter\\xADna\\xADtive im\\xADple\\xADmen\\xADta\\xADtion\"), \" of my demo ser\\xADvice.\"), mdx(\"h2\", {\n    \"id\": \"browser\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#browser\"\n  })), \"Browser\"), mdx(\"p\", null, \"One of the en\\xADvi\\xADron\\xADments where HTTP is so to say \\u201Cat home\\u201D is browser. AMQP will prob\\xADa\\xADbly never be as \\u201Cna\\xADtive\\u201D pro\\xADto\\xADcol for any browser as HTTP is. How\\xADever AMQP can be used even from browsers. It has Web\\xADSocket bind\\xADing and there are Javascript AMQP li\\xADbraries - for ex\\xADam\\xADple rhea. So AMQP can be also used re\\xADally every\\xADwhere.\"), mdx(\"h2\", {\n    \"id\": \"decoupling\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#decoupling\"\n  })), \"Decoupling\"), mdx(\"p\", null, \"It is im\\xADpor\\xADtant to men\\xADtion that the Dis\\xADpatch router doesn\\u2019t de\\xADcou\\xADple the client from the ser\\xADvice. If de\\xADcou\\xADpling is what is needed, it can be eas\\xADily achieved by re\\xADplac\\xADing the Dis\\xADpatch router with some AMQP bro\\xADker. The bro\\xADker would de\\xADcou\\xADple the client from the ser\\xADvice with\\xADout any changes in the ser\\xADvice or clients.\"), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"While cre\\xADat\\xADing APIs using AMQP can be very easy, it doesn\\u2019t mean that AMQP is the best pro\\xADto\\xADcol for all APIs. There are def\\xADi\\xADnitely APIs where HTTP is more suit\\xADable. But in some use cases, AMQP has clear ad\\xADvan\\xADtages. In my LiveScore ex\\xADam\\xADple it is es\\xADpe\\xADcially one to many com\\xADmu\\xADni\\xADca\\xADtion. It is im\\xADpor\\xADtant to keep the mind open and se\\xADlect the best avail\\xADable for given ser\\xADvice.\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>Mi­croser­vices and APIs are every­where. Every­one talks about them, pre­sen­ta­tion slides are full of them … some peo­ple are ac­tu­ally even build­ing them. Mi­croser­vices and APIs are of course not com­pletely new con­cepts and they are a bit over-​hyped. But in gen­eral the ideas be­hind them are not bad. Un­for­tu­nately, many peo­ple seem to be­lieve that the only way how to im­ple­ment an API in mi­croser­vice is to use HTTP and REST. That is of course not true. Mi­croser­vices and APIs can be based on many dif­fer­ent pro­to­cols and tech­nolo­gies. My fa­vorite one is of course <a href=\"http://www.amqp.org\">AMQP</a>. Don’t take me wrong, HTTP and REST is not nec­es­sar­ily bad. But in some cases AMQP is sim­ply bet­ter and cre­at­ing AMQP based APIs does not need to be com­pli­cated.</p><div class=\"alert info\"><p>This is a re-​publication of the fol­low­ing <a href=\"http://blog.effectivemessaging.com/2017/01/building-services-and-apis-with-amqp-10.html\">blog post</a></p></div><h2 id=\"livescore-service\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#livescore-service\"></a>LiveScore service</h2><p>For demon­stra­tion, I will use a very sim­ple ser­vice for keep­ing scores of foot­ball games. It has very basic API. It has only three calls:</p><ul><li>Add a new game</li><li>Up­date a score of ex­ist­ing game</li><li>List the scores\nThe AMQP vari­ants will be ad­di­tion­ally able to push live up­dates to the clients.</li></ul><p>The demo is using Java and Vert.x toolkit. <a href=\"http://vertx.io/\">Vert.x</a> is cool and I def­i­nitely rec­om­mend it to every­one. But most of the stuff from the demo should be pos­si­ble also in any other pro­gram­ming lan­guages and/or frame­work.</p><h2 id=\"http-api\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#http-api\"></a>HTTP API</h2><p>HTTP im­ple­men­ta­tion of my ser­vice is a typ­i­cal REST API. Since it is very sim­ple, it ac­cepts re­quests only on one end­point – /api/v1.0/scores. New games are added as POST op­er­a­tions, scores are up­dated with PUT op­er­a­tions and list of all scores can be ob­tained with GET.</p><p>With Vert.x, cre­at­ing HTTP/REST API is very easy. First the web router has to be cre­ated with all planned API calls:</p><pre><code class=\"hljs language-java\">router = Router.router(vertx);  \nrouter.route(<span class=\"hljs-string\">&quot;/api/v1.0/*&quot;</span>).handler(BodyHandler.create());  \nrouter.get(<span class=\"hljs-string\">&quot;/api/v1.0/scores&quot;</span>).handler(<span class=\"hljs-keyword\">this</span>::getScores);  \nrouter.post(<span class=\"hljs-string\">&quot;/api/v1.0/scores&quot;</span>).handler(<span class=\"hljs-keyword\">this</span>::addGame);  \nrouter.put(<span class=\"hljs-string\">&quot;/api/v1.0/scores&quot;</span>).handler(<span class=\"hljs-keyword\">this</span>::setScore);  \n</code></pre><p>Then the HTTP server has to be cre­ated and linked with the router:</p><pre><code class=\"hljs language-java\">HttpServerOptions httpOptions = <span class=\"hljs-keyword\">new</span> HttpServerOptions();  \nserver = vertx.createHttpServer(httpOptions)  \n   .requestHandler(router::accept)  \n   .listen(httpPort);  \n</code></pre><p>And fi­nally the han­dlers which will be trig­gered for each API call have to be im­ple­mented as well. The full code is on <a href=\"https://github.com/scholzj/livescore-demo-vertx-http\">GitHub</a>.</p><p><img src=\"/images/blog/services-and-apis-with-amqp/HTTP-API.png\"/></p><p>The HTTP API doesn’t pro­vide any way how to au­to­mat­i­cally push the score up­dates to the clients. The clients sim­ply have to poll the ser­vice pe­ri­od­i­cally to get the up­dates. HTTP has of course some ways how to push live up­dates to clients. For ex­am­ple, with Web­Sock­ets or with chun­ked trans­fers. How­ever, these are not that easy to im­ple­ment. The ser­vice would also need to keep sep­a­rate con­nec­tion with every client and push the up­dates for each of them sep­a­rately.</p><h2 id=\"amqp-api\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#amqp-api\"></a>AMQP API</h2><p>Cre­at­ing the HTTP API was re­ally easy. Cre­at­ing an AMQP API has to be more com­pli­cated, right? We would need an AMQP server, which will lis­ten on some port, ac­cept the con­nec­tions, ses­sions, links and so on. There are usu­ally no nice and sim­ple to use li­braries for this.</p><p>Sure, this is one way how to do it. There is ac­tu­ally a nice li­brary called <a href=\"http://qpid.apache.org/proton/index.html\">Apache Qpid Pro­ton</a>. It has Java and C ver­sions and bind­ings into many other lan­guages (Go, C++, Python, …). It makes cre­at­ing your own AMQP server lot eas­ier. It will take care of de­cod­ing and en­cod­ing the AMQP pro­to­col, han­dling the con­nec­tions, ses­sions etc. But still, Qpid Pro­ton is not even nearly as easy to use as the HTTP router used for the HTTP API.</p><p><img src=\"/images/blog/services-and-apis-with-amqp/AMQP-Server-API.png\" alt=\"API with AMQP server\"/></p><p>Are there any eas­ier op­tions? What if all what is needed to cre­ate AMQP based API is a sim­ple AMQP client? Nor­mally, that should not be a pos­si­ble be­cause we need the API to lis­ten on some port for the clients to con­nect to it and send re­quests. And clients usu­ally don’t lis­ten on any ports. How­ever, Apache Qpid has some­thing called <a href=\"http://qpid.apache.org/components/dispatch-router/index.html\">Dis­patch</a>. It works as a light­weight AMQP router. Dis­patch will serve as the AMQP server which was miss­ing. It will take care of han­dling client con­nec­tions, se­cu­rity and shield the ser­vice from the ac­tual clients. All the ser­vice needs to do is to use AMQP client to con­nect to Dis­patch on pre­de­fined ad­dress and wait for the re­quest.</p><p><img src=\"/images/blog/services-and-apis-with-amqp/AMQP-API.png\" alt=\"AMQP API with Dispatch router\"/></p><p>Dis­patch needs to be con­fig­ured with three API entry points as ad­dresses:</p><pre><code class=\"hljs language-text\">address {  \n    prefix: /setScore  \n    distribution: balanced  \n}  \naddress {  \n    prefix: /getScore  \n    distribution: balanced  \n}  \naddress {  \n    prefix: /addGame  \n    distribution: balanced  \n}  \n</code></pre><p>LiveScore ser­vice will con­nect to these ad­dresses as a re­ceiver / con­sumer. Clients will con­nect to them as senders  /pro­duc­ers. And Dis­patch will take care of rout­ing the mes­sages be­tween the clients and the ser­vice. Clients can also cre­ate ad­di­tional re­ceivers so that the ser­vice is able to re­spond to their re­quests and spec­ify the ad­dress of the re­ceiver as the reply-​to header in the re­quest mes­sage. LiveScore ser­vice will au­to­mat­i­cally send the re­sponse to this ad­dress. But spec­i­fy­ing a reply-​to is not manda­tory. If the client wants, it can sim­ply fire the re­quest and for­get about the re­sponse.</p><p>LiveScore ser­vice is using Vert.x AMQP Bridge which al­lows easy in­te­gra­tion be­tween the Vert.x Event Bus and the AMQP con­nec­tion to my router. The ser­vice starts the AMQP Bridge and if it suc­cess­fully con­nects to Dis­patch it cre­ates three re­ceivers for the API calls.</p><pre><code class=\"hljs language-java\">AmqpBridgeOptions options = <span class=\"hljs-keyword\">new</span> AmqpBridgeOptions().addEnabledSaslMechanism(<span class=\"hljs-string\">&quot;ANONYMOUS&quot;</span>);  \nbridge = AmqpBridge.create(vertx, options);  \nbridge.start(amqpHostname, amqpPort, res -&gt; {  \n   <span class=\"hljs-keyword\">if</span> (res.succeeded())  \n   {  \n     bridge.createConsumer(<span class=\"hljs-string\">&quot;/setScore&quot;</span>).setMaxBufferedMessages(<span class=\"hljs-number\">100</span>).handler(<span class=\"hljs-keyword\">this</span>::setScore);  \n     bridge.createConsumer(<span class=\"hljs-string\">&quot;/getScores&quot;</span>).setMaxBufferedMessages(<span class=\"hljs-number\">100</span>).handler(<span class=\"hljs-keyword\">this</span>::getScores);  \n     bridge.createConsumer(<span class=\"hljs-string\">&quot;/addGame&quot;</span>).setMaxBufferedMessages(<span class=\"hljs-number\">100</span>).handler(<span class=\"hljs-keyword\">this</span>::addGame);  \n     fut.complete();  \n   }  \n   <span class=\"hljs-keyword\">else</span>  \n   {  \n     fut.fail(res.cause());  \n   }  \n});  \n</code></pre><p>The only other thing which needs to be done is cre­at­ing han­dlers for han­dling the re­quests re­ceived from clients:</p><pre><code class=\"hljs language-java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getScores</span><span class=\"hljs-params\">(Message&lt;Object&gt; msg)</span>  \n</span>{  \n   <span class=\"hljs-keyword\">if</span>(msg.replyAddress() != <span class=\"hljs-keyword\">null</span>)  \n   {  \n     JsonObject response = <span class=\"hljs-keyword\">new</span> JsonObject();  \n     response.put(<span class=\"hljs-string\">&quot;application_properties&quot;</span>, <span class=\"hljs-keyword\">new</span> JsonObject().put(<span class=\"hljs-string\">&quot;status&quot;</span>, <span class=\"hljs-number\">200</span>));  \n     response.put(<span class=\"hljs-string\">&quot;body&quot;</span>, <span class=\"hljs-keyword\">new</span> JsonArray(Json.encode(scoreService.getScores())).encode());  \n     msg.reply(response);  \n   }  \n   <span class=\"hljs-keyword\">else</span>  \n   {  \n     LOG.warn(<span class=\"hljs-string\">&quot;Received LiveScore/getScores request without reply to address&quot;</span>);  \n   }  \n}  \n</code></pre><p>Live broad­cast­ing of score up­dates is also very easy. New ad­dress has to be added into Dis­patch con­fig­u­ra­tion. This ad­dress will be used in op­po­site di­rec­tion. the ser­vice con­nects to it as sender / pro­ducer and clients which want to re­ceive the live up­dates cre­ate a re­ceiver against this ad­dress. What is im­por­tant, this ad­dress has to be marked as mul­ti­cast. Thanks to that every sin­gle mes­sage will be de­liv­ered to all con­nected clients and not just to one of them:</p><pre><code class=\"hljs language-text\">address {  \n    prefix: /liveScores  \n    distribution: multicast  \n}  \n</code></pre><p><img src=\"/images/blog/services-and-apis-with-amqp/AMQP-API-multicast.png\" alt=\"Multicasting messages\"/></p><p>Thanks to the mul­ti­cast dis­tri­b­u­tion, the ser­vice doesn’t need to send a sep­a­rate up­date to every sin­gle client. It sends the mes­sage only once and dis­patch takes care of the rest.</p><pre><code class=\"hljs language-java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">broadcastUpdates</span><span class=\"hljs-params\">(Game game)</span>  \n</span>{  \n   LOG.info(<span class=\"hljs-string\">&quot;Broadcasting game update &quot;</span> + game);  \n   JsonObject message = <span class=\"hljs-keyword\">new</span> JsonObject();  \n   message.put(<span class=\"hljs-string\">&quot;body&quot;</span>, <span class=\"hljs-keyword\">new</span> JsonObject(Json.encode(game)).encode());  \n   producer.send(message);  \n} \n</code></pre><p>Again, the com­plete source codes of the demo ser­vice are avail­able on <a href=\"https://github.com/scholzj/livescore-demo-vertx-amqp-bridge\">GitHub</a>.</p><h2 id=\"how-to-structure-amqp-apis\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#how-to-structure-amqp-apis\"></a>How to structure AMQP APIs?</h2><p>Com­pared to HTTP and REST, AMQP gives its users a lot more free­dom when de­sign­ing the API. It isn’t tied up by the avail­able HTTP meth­ods.</p><p>My LiveScore ser­vice is using the API end­points named ac­cord­ing to their func­tion:</p><ul><li>/LiveScore/ad­dGame</li><li>/LiveScore/setScore</li><li>/LiveScore/getScores\nIt also uses HTTP sta­tus codes in ap­pli­ca­tion prop­er­ties of the dif­fer­ent mes­sages to de­scribe the re­sult of the re­quest and JSON as the mes­sage pay­load with the ac­tual re­quest and re­sponse.</li></ul><p>Is that the best way? To be hon­est, I don’t know. Just for the re­quest en­cod­ing there are many dif­fer­ent op­tions. AMQP has its own en­cod­ings which sup­ports all pos­si­ble basic as well as more ad­vanced data types and struc­tures. But AMQP can also trans­fer any opaque data - be it JSON, XML, Google Pro­to­col Buffers or any­thing else. For sim­ple re­quest, the pay­load can be com­pletely skipped and ap­pli­ca­tion prop­er­ties can be used in­stead. And for every­one who re­ally loves HTTP/REST, one can also model the API in REST style as I did in an <a href=\"https://github.com/scholzj/livescore-demo-vertx-amqp-bridge-rest-style\">al­ter­na­tive im­ple­men­ta­tion</a> of my demo ser­vice.</p><h2 id=\"browser\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#browser\"></a>Browser</h2><p>One of the en­vi­ron­ments where HTTP is so to say “at home” is browser. AMQP will prob­a­bly never be as “na­tive” pro­to­col for any browser as HTTP is. How­ever AMQP can be used even from browsers. It has Web­Socket bind­ing and there are Javascript AMQP li­braries - for ex­am­ple rhea. So AMQP can be also used re­ally every­where.</p><h2 id=\"decoupling\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#decoupling\"></a>Decoupling</h2><p>It is im­por­tant to men­tion that the Dis­patch router doesn’t de­cou­ple the client from the ser­vice. If de­cou­pling is what is needed, it can be eas­ily achieved by re­plac­ing the Dis­patch router with some AMQP bro­ker. The bro­ker would de­cou­ple the client from the ser­vice with­out any changes in the ser­vice or clients.</p><h2 id=\"conclusion\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"></a>Conclusion</h2><p>While cre­at­ing APIs using AMQP can be very easy, it doesn’t mean that AMQP is the best pro­to­col for all APIs. There are def­i­nitely APIs where HTTP is more suit­able. But in some use cases, AMQP has clear ad­van­tages. In my LiveScore ex­am­ple it is es­pe­cially one to many com­mu­ni­ca­tion. It is im­por­tant to keep the mind open and se­lect the best avail­able for given ser­vice.</p>","scope":{}},"tfIdfTerms":[{"term":"amqp","tf":29},{"term":"api","tf":28},{"term":"servic","tf":22},{"term":"client","tf":22},{"term":"http","tf":18},{"term":"us","tf":16},{"term":"will","tf":14},{"term":"creat","tf":13},{"term":"connect","tf":12},{"term":"request","tf":11},{"term":"not","tf":10},{"term":"need","tf":10},{"term":"updat","tf":10},{"term":"dispatch","tf":10},{"term":"livescor","tf":9},{"term":"address","tf":9},{"term":"rest","tf":8},{"term":"score","tf":8},{"term":"on","tf":7},{"term":"easi","tf":7},{"term":"router","tf":7},{"term":"receiv","tf":7},{"term":"call","tf":6},{"term":"messag","tf":6},{"term":"implement","tf":5}]},{"filename":"blog/2016-12-29-internet-of-things-reactive-and-asynchronous-with-vert-x.mdx","date":"2016-12-29","slug":"internet-of-things-reactive-and-asynchronous-with-vert-x","meta":{"title":"Internet of Things - Reactive and Asynchronous with Vert.x","category":"guides","authors":[{"name":"Paolo Patierno","github_id":"ppatierno"}],"summary":"I have to admit … before joining Red Hat I didn’t know about the Eclipse Vert.x project but it took me few days to fall in love with it!"},"readingTime":{"text":"4 min read","minutes":3.68,"time":220800,"words":736},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx-iot/vertx-iot.png\",\n    \"alt\": \"Vert.x IoT\"\n  }))), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"This is a re-\\u200Bpublication of the fol\\xADlow\\xADing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://paolopatierno.wordpress.com/2016/12/27/internet-of-things-reactive-and-asynchronous-with-vert-x/\"\n  }), \"blog post\"), \".\")), mdx(\"p\", null, \"I have to admit \\u2026 be\\xADfore join\\xADing Red Hat I didn\\u2019t know about the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx.io/\"\n  }), mdx(\"em\", {\n    parentName: \"a\"\n  }, \"Eclipse Vert.x\")), \" project but it took me few days to fall in love with it!\"), mdx(\"p\", null, \"For the other de\\xADvel\\xADop\\xADers who don\\u2019t know what Vert.x is, the best de\\xADf\\xADi\\xADn\\xADi\\xADtion is \\u2026\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"\\u2026 a toolkit to build dis\\xADtrib\\xADuted and re\\xADac\\xADtive sys\\xADtems on top of the JVM using an asyn\\xADchro\\xADnous non block\\xADing de\\xADvel\\xADop\\xADment model\")), mdx(\"p\", null, \"The first big thing is re\\xADlated to de\\xADvelop a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"re\\xADac\\xADtive\"), \" sys\\xADtem using Vert.x which means :\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Re\\xADspon\\xADsive\"), \" : the sys\\xADtem re\\xADsponds in an ac\\xADcept\\xADable time;\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Elas\\xADtic\"), \" : the sys\\xADtem can scale up and scale down;\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Re\\xADsilient\"), \" : the sys\\xADtem is de\\xADsigned to han\\xADdle fail\\xADures grace\\xADfully;\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Asyn\\xADchro\\xADnous\"), \" : the in\\xADter\\xADac\\xADtion with the sys\\xADtem is achieved using asyn\\xADchro\\xADnous mes\\xADsages;\")), mdx(\"p\", null, \"The other big thing is re\\xADlated to use an \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"asyn\\xADchro\\xADnous non block\\xADing\"), \" de\\xADvel\\xADop\\xADment model which doesn\\u2019t mean to be multi-\\u200Bthreading but thanks to the non block\\xADing I/O (i.e. for han\\xADdling net\\xADwork, file sys\\xADtem, \\u2026) and call\\xADbacks sys\\xADtem, it\\u2019s pos\\xADsi\\xADble to han\\xADdle a huge num\\xADbers of events per sec\\xADond using a sin\\xADgle thread (aka \\u201Cevent loop\\u201D).\"), mdx(\"p\", null, \"You can find a lot of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx.io/materials/\"\n  }), \"ma\\xADte\\xADr\\xADial\"), \" on the of\\xADfi\\xADcial web site in order to bet\\xADter un\\xADder\\xADstand what Vert.x is and all its main fea\\xADtures; it\\u2019s not my ob\\xADjec\\xADtive to ex\\xADplain it in this very short ar\\xADti\\xADcle that is mostly \\u2026 you guess \\u2026 mes\\xADsag\\xADing and IoT ori\\xADented  :-)\"), mdx(\"p\", null, \"In my opin\\xADion, all the above fea\\xADtures make Vert.x a great toolkit for build\\xADing In\\xADter\\xADnet of Things ap\\xADpli\\xADca\\xADtions where being re\\xADac\\xADtive and asyn\\xADchro\\xADnous is a \\u201Cmust\\u201D in order to han\\xADdle mil\\xADlions of con\\xADnec\\xADtions from de\\xADvices and all the mes\\xADsages in\\xADgested from them.\"), mdx(\"h2\", {\n    \"id\": \"vertx-and-the-internet-of-things\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#vertx-and-the-internet-of-things\"\n  })), \"Vert.x and the Internet of Things\"), mdx(\"p\", null, \"As a toolkit, so made of dif\\xADfer\\xADent com\\xADpo\\xADnents, what are the ones pro\\xADvided by Vert.x and use\\xADful to IoT?\"), mdx(\"p\", null, \"Start\\xADing from the Vert.x \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/eclipse/vert.x\"\n  }), \"Core\"), \" com\\xADpo\\xADnent, there is sup\\xADport for both ver\\xADsions of HTTP pro\\xADto\\xADcol so 1.1 and 2.0 in order to de\\xADvelop an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx.io/docs/vertx-core/java/#_writing_http_servers_and_clients\"\n  }), \"HTTP server\"), \" which can ex\\xADpose a REST\\xADful API to the de\\xADvices. Today , a lot of web and mo\\xADbile de\\xADvel\\xADop\\xADers pre\\xADfer to use this pro\\xADto\\xADcol for build\\xADing their IoT so\\xADlu\\xADtion lever\\xADag\\xADing on the deep knowl\\xADedge they have about the HTTP pro\\xADto\\xADcol.\"), mdx(\"p\", null, \"Re\\xADgard\\xADing more IoT ori\\xADented pro\\xADto\\xADcols, there is the Vert.x \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-mqtt-server\"\n  }), \"MQTT server\"), \" com\\xADpo\\xADnent which doesn\\u2019t pro\\xADvide a full bro\\xADker but ex\\xADposes an API that a de\\xADvel\\xADoper can use in order to han\\xADdle in\\xADcom\\xADing con\\xADnec\\xADtions and mes\\xADsages from re\\xADmote MQTT clients and then build\\xADing the busi\\xADness logic on top of it, so for ex\\xADam\\xADple de\\xADvel\\xADop\\xADing a real bro\\xADker or ex\\xADe\\xADcut\\xADing pro\\xADto\\xADcol trans\\xADla\\xADtion (i.e. to/from plain TCP,to/from the Vert.x Event Bus,to/from HTTP,to/from AMQP and so on). The API raises all events re\\xADlated to the con\\xADnec\\xADtion re\\xADquest from a re\\xADmote MQTT client and all sub\\xADse\\xADquent in\\xADcom\\xADing mes\\xADsages; at same time, the API pro\\xADvides the way to reply to the re\\xADmote end\\xADpoint. The de\\xADvel\\xADoper doesn\\u2019t need to know how MQTT works on the wire in terms of en\\xADcod\\xADing/de\\xADcod\\xADing mes\\xADsages.\"), mdx(\"p\", null, \"Re\\xADlated to the AMQP 1.0 pro\\xADto\\xADcol there are the Vert.x \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-proton\"\n  }), \"Pro\\xADton\"), \" and the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-amqp-bridge\"\n  }), \"AMQP bridge\"), \" com\\xADpo\\xADnents. The first one pro\\xADvides a thin wrap\\xADper around the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://qpid.apache.org/\"\n  }), \"Apache Qpid\"), \" Pro\\xADton en\\xADgine and can be used for in\\xADter\\xADact\\xADing with AMQP based mes\\xADsag\\xADing sys\\xADtems as clients (sender and re\\xADceiver) but even de\\xADvel\\xADop\\xADing a server. The last one pro\\xADvides a bridge be\\xADtween the pro\\xADto\\xADcol and the Vert.x Event Bus mostly used for com\\xADmu\\xADni\\xADca\\xADtion be\\xADtween de\\xADployed Vert.x ver\\xADti\\xADcles. Thanks to this bridge, ver\\xADti\\xADcles can in\\xADter\\xADact with AMQP com\\xADpo\\xADnents in a sim\\xADple way.\"), mdx(\"p\", null, \"Last but not least, the Vert.x \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-kafka-client\"\n  }), \"Kafka client\"), \" com\\xADpo\\xADnent which pro\\xADvides ac\\xADcess to Apache Kafka for send\\xADing and con\\xADsum\\xADing mes\\xADsages from top\\xADics and re\\xADlated par\\xADti\\xADtions. A lot of IoT sce\\xADnar\\xADios lever\\xADage on Apache Kafka in order to have an in\\xADges\\xADtion sys\\xADtem ca\\xADpa\\xADble of han\\xADdling mil\\xADlion mes\\xADsages per sec\\xADond.\"), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"The cur\\xADrent Vert.x code base pro\\xADvides quite in\\xADter\\xADest\\xADing com\\xADpo\\xADnents for de\\xADvel\\xADop\\xADing IoT so\\xADlu\\xADtions which are al\\xADready avail\\xADable in the cur\\xADrent 3.3.3 ver\\xADsion (see Vert.x Pro\\xADton and AMQP bridge) and that will be avail\\xADable soon in the fu\\xADture 3.4.0 ver\\xADsion (see MQTT server and Kafka client). Of course, you don\\u2019t need to wait for their of\\xADfi\\xADcial re\\xADlease be\\xADcause, even if under de\\xADvel\\xADop\\xADment, you can al\\xADready adopt these com\\xADpo\\xADnents and pro\\xADvide your feed\\xADback to the com\\xADmu\\xADnity.\"), mdx(\"p\", null, \"This ecosys\\xADtem will grow in the fu\\xADture and Vert.x will be a lead\\xADing actor in the IoT ap\\xADpli\\xADca\\xADtions world based on a mi\\xADcroser\\xADvices ar\\xADchi\\xADtec\\xADture!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p><img src=\"/images/blog/vertx-iot/vertx-iot.png\" alt=\"Vert.x IoT\"/></p><div class=\"alert info\"><p>This is a re-​publication of the fol­low­ing <a href=\"https://paolopatierno.wordpress.com/2016/12/27/internet-of-things-reactive-and-asynchronous-with-vert-x/\">blog post</a>.</p></div><p>I have to admit … be­fore join­ing Red Hat I didn’t know about the <a href=\"http://vertx.io/\"><em>Eclipse Vert.x</em></a> project but it took me few days to fall in love with it!</p><p>For the other de­vel­op­ers who don’t know what Vert.x is, the best de­f­i­n­i­tion is …</p><blockquote><p>… a toolkit to build dis­trib­uted and re­ac­tive sys­tems on top of the JVM using an asyn­chro­nous non block­ing de­vel­op­ment model</p></blockquote><p>The first big thing is re­lated to de­velop a <em>re­ac­tive</em> sys­tem using Vert.x which means :</p><ul><li><em>Re­spon­sive</em> : the sys­tem re­sponds in an ac­cept­able time;</li><li><em>Elas­tic</em> : the sys­tem can scale up and scale down;</li><li><em>Re­silient</em> : the sys­tem is de­signed to han­dle fail­ures grace­fully;</li><li><em>Asyn­chro­nous</em> : the in­ter­ac­tion with the sys­tem is achieved using asyn­chro­nous mes­sages;</li></ul><p>The other big thing is re­lated to use an <em>asyn­chro­nous non block­ing</em> de­vel­op­ment model which doesn’t mean to be multi-​threading but thanks to the non block­ing I/O (i.e. for han­dling net­work, file sys­tem, …) and call­backs sys­tem, it’s pos­si­ble to han­dle a huge num­bers of events per sec­ond using a sin­gle thread (aka “event loop”).</p><p>You can find a lot of <a href=\"http://vertx.io/materials/\">ma­te­r­ial</a> on the of­fi­cial web site in order to bet­ter un­der­stand what Vert.x is and all its main fea­tures; it’s not my ob­jec­tive to ex­plain it in this very short ar­ti­cle that is mostly … you guess … mes­sag­ing and IoT ori­ented  :-)</p><p>In my opin­ion, all the above fea­tures make Vert.x a great toolkit for build­ing In­ter­net of Things ap­pli­ca­tions where being re­ac­tive and asyn­chro­nous is a “must” in order to han­dle mil­lions of con­nec­tions from de­vices and all the mes­sages in­gested from them.</p><h2 id=\"vertx-and-the-internet-of-things\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#vertx-and-the-internet-of-things\"></a>Vert.x and the Internet of Things</h2><p>As a toolkit, so made of dif­fer­ent com­po­nents, what are the ones pro­vided by Vert.x and use­ful to IoT?</p><p>Start­ing from the Vert.x <a href=\"https://github.com/eclipse/vert.x\">Core</a> com­po­nent, there is sup­port for both ver­sions of HTTP pro­to­col so 1.1 and 2.0 in order to de­velop an <a href=\"http://vertx.io/docs/vertx-core/java/#_writing_http_servers_and_clients\">HTTP server</a> which can ex­pose a REST­ful API to the de­vices. Today , a lot of web and mo­bile de­vel­op­ers pre­fer to use this pro­to­col for build­ing their IoT so­lu­tion lever­ag­ing on the deep knowl­edge they have about the HTTP pro­to­col.</p><p>Re­gard­ing more IoT ori­ented pro­to­cols, there is the Vert.x <a href=\"https://github.com/vert-x3/vertx-mqtt-server\">MQTT server</a> com­po­nent which doesn’t pro­vide a full bro­ker but ex­poses an API that a de­vel­oper can use in order to han­dle in­com­ing con­nec­tions and mes­sages from re­mote MQTT clients and then build­ing the busi­ness logic on top of it, so for ex­am­ple de­vel­op­ing a real bro­ker or ex­e­cut­ing pro­to­col trans­la­tion (i.e. to/from plain TCP,to/from the Vert.x Event Bus,to/from HTTP,to/from AMQP and so on). The API raises all events re­lated to the con­nec­tion re­quest from a re­mote MQTT client and all sub­se­quent in­com­ing mes­sages; at same time, the API pro­vides the way to reply to the re­mote end­point. The de­vel­oper doesn’t need to know how MQTT works on the wire in terms of en­cod­ing/de­cod­ing mes­sages.</p><p>Re­lated to the AMQP 1.0 pro­to­col there are the Vert.x <a href=\"https://github.com/vert-x3/vertx-proton\">Pro­ton</a> and the <a href=\"https://github.com/vert-x3/vertx-amqp-bridge\">AMQP bridge</a> com­po­nents. The first one pro­vides a thin wrap­per around the <a href=\"http://qpid.apache.org/\">Apache Qpid</a> Pro­ton en­gine and can be used for in­ter­act­ing with AMQP based mes­sag­ing sys­tems as clients (sender and re­ceiver) but even de­vel­op­ing a server. The last one pro­vides a bridge be­tween the pro­to­col and the Vert.x Event Bus mostly used for com­mu­ni­ca­tion be­tween de­ployed Vert.x ver­ti­cles. Thanks to this bridge, ver­ti­cles can in­ter­act with AMQP com­po­nents in a sim­ple way.</p><p>Last but not least, the Vert.x <a href=\"https://github.com/vert-x3/vertx-kafka-client\">Kafka client</a> com­po­nent which pro­vides ac­cess to Apache Kafka for send­ing and con­sum­ing mes­sages from top­ics and re­lated par­ti­tions. A lot of IoT sce­nar­ios lever­age on Apache Kafka in order to have an in­ges­tion sys­tem ca­pa­ble of han­dling mil­lion mes­sages per sec­ond.</p><h2 id=\"conclusion\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"></a>Conclusion</h2><p>The cur­rent Vert.x code base pro­vides quite in­ter­est­ing com­po­nents for de­vel­op­ing IoT so­lu­tions which are al­ready avail­able in the cur­rent 3.3.3 ver­sion (see Vert.x Pro­ton and AMQP bridge) and that will be avail­able soon in the fu­ture 3.4.0 ver­sion (see MQTT server and Kafka client). Of course, you don’t need to wait for their of­fi­cial re­lease be­cause, even if under de­vel­op­ment, you can al­ready adopt these com­po­nents and pro­vide your feed­back to the com­mu­nity.</p><p>This ecosys­tem will grow in the fu­ture and Vert.x will be a lead­ing actor in the IoT ap­pli­ca­tions world based on a mi­croser­vices ar­chi­tec­ture!</p>","scope":{}},"tfIdfTerms":[{"term":"develop","tf":12},{"term":"system","tf":10},{"term":"us","tf":10},{"term":"messag","tf":9},{"term":"compon","tf":8},{"term":"provid","tf":8},{"term":"iot","tf":7},{"term":"protocol","tf":7},{"term":"handl","tf":6},{"term":"amqp","tf":6},{"term":"asynchron","tf":5},{"term":"relat","tf":5},{"term":"event","tf":5},{"term":"order","tf":5},{"term":"mqtt","tf":5},{"term":"client","tf":5},{"term":"build","tf":4},{"term":"thing","tf":4},{"term":"http","tf":4},{"term":"server","tf":4},{"term":"api","tf":4},{"term":"bridg","tf":4},{"term":"kafka","tf":4},{"term":"know","tf":3},{"term":"toolkit","tf":3}]},{"filename":"blog/2016-12-07-getting-started-with-new-fabric8-vert-x-maven-plugin.mdx","date":"2016-12-07","slug":"getting-started-with-new-fabric8-vert-x-maven-plugin","meta":{"title":"Getting started with new fabric8 Vert.x Maven Plugin","category":"guides","authors":[{"name":"Kamesh Sampath","github_id":"kameshsampath"}],"summary":"The all new fabric8 Vert.x Maven Plugin allows you to setup, package, run, start, stop and redeploy easily with a very little configuration resulting in a less verbose pom.xml."},"readingTime":{"text":"5 min read","minutes":4.455,"time":267300,"words":891},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"The all new \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \" al\\xADlows you to setup, pack\\xADage, run, start, stop and re\\xADde\\xADploy eas\\xADily with a very lit\\xADtle con\\xADfig\\xADu\\xADra\\xADtion re\\xADsult\\xADing in a less ver\\xADbose \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\"), \".\"), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"The plug\\xADin is de\\xADvel\\xADoped under the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://fabric8.io/\"\n  }), \"fab\\xADric8\"), \" um\\xADbrella.\")), mdx(\"p\", null, \"Tra\\xADdi\\xADtion\\xADally Vert.x ap\\xADpli\\xADca\\xADtions using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" need to have one or more of the fol\\xADlow\\xADing plu\\xADg\\xADins:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://maven.apache.org/plugins/maven-shade-plugin/\"\n  }), \"Maven Shade Plu\\xADgin\"), \" - aids in pack\\xADag\\xADing a uber jar of Vert.x ap\\xADpli\\xADca\\xADtion with ad\\xADdi\\xADtional con\\xADfig\\xADu\\xADra\\xADtions to per\\xADform SPI com\\xADbin\\xADing, MAN\\xADI\\xADFEST.MF en\\xADtries etc.,\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://www.mojohaus.org/exec-maven-plugin/\"\n  }), \"Maven Exec Plu\\xADgin\"), \" - aids in start\\xADing the Vert.x ap\\xADpli\\xADca\\xADtion\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://maven.apache.org/plugins/maven-ant-plugin/\"\n  }), \"Maven Ant Plu\\xADgin\"), \" - aids in stop\\xADping the run\\xADning Vert.x ap\\xADpli\\xADca\\xADtion\")), mdx(\"p\", null, \"Though these are great plu\\xADg\\xADins and do what is re\\xADquired, but at the end of the day the de\\xADvel\\xADoper is left with a ver\\xADbose \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\"), \" which might be\\xADcome harder to main\\xADtain as the ap\\xADpli\\xADca\\xADtion or its con\\xADfig\\xADu\\xADra\\xADtion grows. Even if we de\\xADcide to go this way and use those plu\\xADg\\xADins, there are some things which can\\u2019t done or done eas\\xADily:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"run\"), \" an ap\\xADpli\\xADca\\xADtion on fore\\xADground - which is a typ\\xADi\\xADcal way dur\\xADing de\\xADvel\\xADop\\xADment where the ap\\xADpli\\xADca\\xADtion starts in fore\\xADground of \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" build and killed au\\xADto\\xADmat\\xADi\\xADcally once we hit \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Ctrl + c\"), \"(or \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"CMD + c\"), \" on Mac)\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"redeploy\"), \" is one of the coolest fea\\xADture of Vert.x al\\xADlow\\xADing us to per\\xADform hot de\\xADploy\\xADments. Still we can man\\xADage to do this with IDE sup\\xADport but not na\\xADtively using \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" - typ\\xADi\\xADcal cases where we dis\\xADable \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Au\\xADto\\xADmatic Builds\"), \" via IDE\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"setup\"), \" Vert.x ap\\xADpli\\xADca\\xADtions with sen\\xADsi\\xADble de\\xADfaults and re\\xADquired Vert.x de\\xADpen\\xADden\\xADcies e.g. vertx-\\u200Bcore\")), mdx(\"p\", null, \"In this first blog of fab\\xADric8 Vert.x Maven Plu\\xADgin se\\xADries we will help you to get started with this new \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \", high\\xADlight\\xADing how this plug\\xADin helps al\\xADle\\xADvi\\xADat\\xADing the afore\\xADmen\\xADtioned pain points with a less ver\\xADbose \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\"), \".\"), mdx(\"p\", null, \"The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" plug\\xADin source code is avail\\xADable at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/fabric8io/vertx-maven-plugin\"\n  }), \"github\"), \" with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" plug\\xADin doc\\xADu\\xADmen\\xADta\\xADtion avail\\xADable at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\")), mdx(\"p\", null, \"The source code of the ex\\xADam\\xADples used in this blog are avail\\xADable at \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kameshsampath/vmp-blog\"\n  }), \"github\")), mdx(\"h2\", {\n    \"id\": \"lets-set-it-up\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#lets-set-it-up\"\n  })), \"Let\\u2019s set it up\"), mdx(\"p\", null, \"Its very easy to setup and get started. Let\\u2019s say you have a project called \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"vmp-\\u200Bblog\"), \" with the fol\\xADlow\\xADing con\\xADtent as part of your \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\")), mdx(Gist, {\n    url: \"https://gist.github.com/kameshsampath/0e0cfc90ea3cb9d69553ee9901dfd796\",\n    mdxType: \"Gist\"\n  }), mdx(\"p\", null, \"from the project di\\xADrec\\xADtory just run the fol\\xADlow\\xADing com\\xADmand:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"mvn io.fabric8:vertx-maven-plugin:1.0.0:setup\\n\")), mdx(\"p\", null, \"On suc\\xADcess\\xADful ex\\xADe\\xADcu\\xADtion of the above com\\xADmand the project\\u2019s \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\"), \" will be up\\xADdated:\"), mdx(Gist, {\n    url: \"https://gist.github.com/kameshsampath/3c2e96d98f1e16d0f7a0501c05ce0d12\",\n    mdxType: \"Gist\"\n  }), mdx(\"p\", null, \"The com\\xADmand did the fol\\xADlow\\xADing for you on the project:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"added cou\\xADple of prop\\xADer\\xADties\", mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"fabric8.vertx.plugin.version\"), \" - the lat\\xADest fab\\xADric8 vert.x maven plug\\xADin ver\\xADsion\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vertx.version\"), \" - the lat\\xADest Vert.x frame\\xADwork ver\\xADsion\"))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"added the Vert.x de\\xADpen\\xADdency BOM and vertx-\\u200Bcore de\\xADpen\\xADdency cor\\xADre\\xADspond\\xADing to \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vertx.version\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"added \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vertx-maven-plugin\"), \" with a sin\\xADgle ex\\xADe\\xADcu\\xADtion for goals \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://vmp.fabric8.io/#vertx:initalize\"\n  }), \"ini\\xADtial\\xADize\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://vmp.fabric8.io/#vertx:package\"\n  }), \"pack\\xADage\"))), mdx(\"p\", null, \"The source code cre\\xADated by this step is avail\\xADable \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kameshsampath/vmp-blog/tree/setup\"\n  }), \"here\")), mdx(\"p\", null, \"Et voil\\xE0, you are now all set to go with your Vert.x ap\\xADpli\\xADca\\xADtion build\\xADing with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \"!!\"), mdx(\"h2\", {\n    \"id\": \"lets-package-it\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#lets-package-it\"\n  })), \"Let\\u2019s package it\"), mdx(\"p\", null, \"Now that we have set up our project to use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-maven-plugin\"), \", lets add a sim\\xADple ver\\xADti\\xADcle and pack\\xADage the Vert.x ap\\xADpli\\xADca\\xADtion as typ\\xADi\\xADcal \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"uber\"), \" jar (in the Vert.x world we call them \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"fat\"), \" jars).  The source code of this sec\\xADtion is avail\\xADable \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kameshsampath/vmp-blog/tree/package\"\n  }), \"here\"), \".\"), mdx(\"p\", null, \"To make \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package\"), \" work cor\\xADrectly we need to add prop\\xADerty called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx.verticle\"), \", which will be used by the vertx-\\u200Bmaven-plugin to set the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Main-Verticle:\"), \" at\\xADtribute of the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MANIFEST.MF\"), \".  Please refer to the doc\\xADu\\xADmen\\xADta\\xADtion of  \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://vmp.fabric8.io/#vertx:package\"\n  }), \"pack\\xADage\"), \" for other pos\\xADsi\\xADble con\\xADfig\\xADu\\xADra\\xADtions.  There is also a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://vmp.fabric8.io/#vertx:examples\"\n  }), \"ex\\xADam\\xADples\"), \" sec\\xADtion of the vertx-\\u200Bmaven-plugin which pro\\xADvides var\\xADi\\xADous sam\\xADples snip\\xADpets.\"), mdx(\"p\", null, \"The up\\xADdated \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pom.xml\"), \" with the added prop\\xADerty \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-maven-plugin\"), \" is shown below:\"), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"Only up\\xADdated sec\\xADtion is shown below, rest of the pom.xml is same as above\")), mdx(Gist, {\n    url: \"https://gist.github.com/kameshsampath/24a1ed6a377b118f06af2c4b4ddf0ca0\",\n    mdxType: \"Gist\"\n  }), mdx(\"p\", null, \"To pack\\xADage the Vert.x ap\\xADpli\\xADca\\xADtion, run the fol\\xADlow\\xADing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" com\\xADmand from the project di\\xADrec\\xADtory:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"mvn clean package\\n\")), mdx(\"p\", null, \"On suc\\xADcess\\xADful run of the above com\\xADmand you should see the file with name \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${project.finalName}.jar\"), \" cre\\xADated in the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${project.build.directory}\"), \", you could now do the fol\\xADlow\\xADing to start and run the Vert.x ap\\xADpli\\xADca\\xADtion.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"java -jar \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"${project.build.directory}\"), \"/\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-variable\"\n  }), \"${project.finalName}\"), \".jar\\n\")), mdx(\"p\", null, \"The gen\\xADer\\xADated \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"MANIFEST.MF\"), \" file is as shown below:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"Main-Class                               io.vertx.core.Launcher\\nMain-Verticle                            io.fabric8.blog.MainVerticle\\nManifest-Version                         1.0\\n\")), mdx(\"p\", null, \"The source code up to now is avail\\xADable in \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kameshsampath/vmp-blog/tree/package\"\n  }), \"here\")), mdx(\"h3\", {\n    \"id\": \"spi-combination\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#spi-combination\"\n  })), \"SPI Combination\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package\"), \" goal by de\\xADfault does a SPI com\\xADbi\\xADna\\xADtion, lets say you have a ser\\xADvice file called \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"com.fasterxml.jackson.core.JsonFactory\"), \" in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${project.basedir}/src/main/resources/META-INF/services\"), \" with con\\xADtents:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"foo.bar.baz.MyImpl\\n${combine}\\n\")), mdx(\"p\", null, \"Dur\\xADing pack\\xADag\\xADing, if the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \" finds an\\xADother \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"com.fasterxml.jackson.core.JsonFactory\"), \" ser\\xADvice de\\xADf\\xADi\\xADn\\xADi\\xADtion file within the project de\\xADpen\\xADden\\xADcies with con\\xADtent \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"foo.bar.baz2.My\\xADImpl2\"), \", then it merges the con\\xADtent into \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"com.fasterxml.jackson.core.JsonFactory\"), \" of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${project.basedir}/src/main/resources/META-INF/services\"), \", re\\xADsult\\xADing in the fol\\xADlow\\xADing con\\xADtent:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"foo.bar.baz.MyImpl\\nfoo.bar.baz2.MyImpl2\\n\")), mdx(\"p\", null, \"The po\\xADsi\\xADtion of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${combine}\"), \" con\\xADtrols the or\\xADder\\xADing of the merge, since we added \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"${combine}\"), \" below \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"foo.bar.baz.My\\xADImpl\"), \" all other SPI de\\xADf\\xADi\\xADn\\xADi\\xADtions will be ap\\xADpended below \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"foo.bar.baz.My\\xADImpl\")), mdx(\"h2\", {\n    \"id\": \"whats-next-\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#whats-next-\"\n  })), \"What\\u2019s next ?\"), mdx(\"p\", null, \"It\\u2019s good to have the jar pack\\xADaged and run using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"java -jar uber-jar\"), \", but when doing typ\\xADi\\xADcal de\\xADvel\\xADop\\xADment you don\\u2019t  want to do fre\\xADquent \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" pack\\xADag\\xADing and wish to see your changes au\\xADto\\xADmat\\xADi\\xADcally re\\xADde\\xADployed.\"), mdx(\"p\", null, \"Don\\u2019t worry!!! As part of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \" we have added the in\\xADcre\\xADmen\\xADtal builder to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://maven.apache.org\"\n  }), \"Apache Maven\"), \" build, which will watch for your source and re\\xADsource changes to per\\xADform au\\xADto\\xADmatic re-\\u200Bbuild and del\\xADe\\xADgate the re\\xADde\\xADploy\\xADment to Vert.x.\"), mdx(\"p\", null, \"Run, re\\xADde\\xADploy and other fea\\xADtures of the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \" will be ex\\xADplored in de\\xADtail in the next part of this se\\xADries, until then have fun with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vmp.fabric8.io\"\n  }), \"fab\\xADric8 Vert.x Maven Plu\\xADgin\"), \"!!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>The all new <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a> al­lows you to setup, pack­age, run, start, stop and re­de­ploy eas­ily with a very lit­tle con­fig­u­ra­tion re­sult­ing in a less ver­bose <code>pom.xml</code>.</p><div class=\"alert info\"><p>The plug­in is de­vel­oped under the <a href=\"https://fabric8.io/\">fab­ric8</a> um­brella.</p></div><p>Tra­di­tion­ally Vert.x ap­pli­ca­tions using <a href=\"http://maven.apache.org\">Apache Maven</a> need to have one or more of the fol­low­ing plu­g­ins:</p><ul><li><a href=\"https://maven.apache.org/plugins/maven-shade-plugin/\">Maven Shade Plu­gin</a> - aids in pack­ag­ing a uber jar of Vert.x ap­pli­ca­tion with ad­di­tional con­fig­u­ra­tions to per­form SPI com­bin­ing, MAN­I­FEST.MF en­tries etc.,</li><li><a href=\"http://www.mojohaus.org/exec-maven-plugin/\">Maven Exec Plu­gin</a> - aids in start­ing the Vert.x ap­pli­ca­tion</li><li><a href=\"https://maven.apache.org/plugins/maven-ant-plugin/\">Maven Ant Plu­gin</a> - aids in stop­ping the run­ning Vert.x ap­pli­ca­tion</li></ul><p>Though these are great plu­g­ins and do what is re­quired, but at the end of the day the de­vel­oper is left with a ver­bose <code>pom.xml</code> which might be­come harder to main­tain as the ap­pli­ca­tion or its con­fig­u­ra­tion grows. Even if we de­cide to go this way and use those plu­g­ins, there are some things which can’t done or done eas­ily:</p><ul><li><code>run</code> an ap­pli­ca­tion on fore­ground - which is a typ­i­cal way dur­ing de­vel­op­ment where the ap­pli­ca­tion starts in fore­ground of <a href=\"http://maven.apache.org\">Apache Maven</a> build and killed au­to­mat­i­cally once we hit <code>Ctrl + c</code>(or <code>CMD + c</code> on Mac)</li><li><code>redeploy</code> is one of the coolest fea­ture of Vert.x al­low­ing us to per­form hot de­ploy­ments. Still we can man­age to do this with IDE sup­port but not na­tively using <a href=\"http://maven.apache.org\">Apache Maven</a> - typ­i­cal cases where we dis­able <em>Au­to­matic Builds</em> via IDE</li><li><code>setup</code> Vert.x ap­pli­ca­tions with sen­si­ble de­faults and re­quired Vert.x de­pen­den­cies e.g. vertx-​core</li></ul><p>In this first blog of fab­ric8 Vert.x Maven Plu­gin se­ries we will help you to get started with this new <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a>, high­light­ing how this plug­in helps al­le­vi­at­ing the afore­men­tioned pain points with a less ver­bose <code>pom.xml</code>.</p><p>The <a href=\"http://maven.apache.org\">Apache Maven</a> plug­in source code is avail­able at <a href=\"https://github.com/fabric8io/vertx-maven-plugin\">github</a> with <a href=\"http://maven.apache.org\">Apache Maven</a> plug­in doc­u­men­ta­tion avail­able at <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a></p><p>The source code of the ex­am­ples used in this blog are avail­able at <a href=\"https://github.com/kameshsampath/vmp-blog\">github</a></p><h2 id=\"lets-set-it-up\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#lets-set-it-up\"></a>Let’s set it up</h2><p>Its very easy to setup and get started. Let’s say you have a project called <em>vmp-​blog</em> with the fol­low­ing con­tent as part of your <code>pom.xml</code></p><div>...waiting for Gist...</div><p>from the project di­rec­tory just run the fol­low­ing com­mand:</p><pre><code class=\"hljs language-bash\">mvn io.fabric8:vertx-maven-plugin:1.0.0:setup\n</code></pre><p>On suc­cess­ful ex­e­cu­tion of the above com­mand the project’s <code>pom.xml</code> will be up­dated:</p><div>...waiting for Gist...</div><p>The com­mand did the fol­low­ing for you on the project:</p><ul><li>added cou­ple of prop­er­ties<ul><li><code>fabric8.vertx.plugin.version</code> - the lat­est fab­ric8 vert.x maven plug­in ver­sion</li><li><code>vertx.version</code> - the lat­est Vert.x frame­work ver­sion</li></ul></li><li>added the Vert.x de­pen­dency BOM and vertx-​core de­pen­dency cor­re­spond­ing to <code>vertx.version</code></li><li>added <code>vertx-maven-plugin</code> with a sin­gle ex­e­cu­tion for goals <a href=\"https://vmp.fabric8.io/#vertx:initalize\">ini­tial­ize</a> and <a href=\"https://vmp.fabric8.io/#vertx:package\">pack­age</a></li></ul><p>The source code cre­ated by this step is avail­able <a href=\"https://github.com/kameshsampath/vmp-blog/tree/setup\">here</a></p><p>Et voilà, you are now all set to go with your Vert.x ap­pli­ca­tion build­ing with <a href=\"http://maven.apache.org\">Apache Maven</a>!!</p><h2 id=\"lets-package-it\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#lets-package-it\"></a>Let’s package it</h2><p>Now that we have set up our project to use <code>vertx-maven-plugin</code>, lets add a sim­ple ver­ti­cle and pack­age the Vert.x ap­pli­ca­tion as typ­i­cal <em>uber</em> jar (in the Vert.x world we call them <em>fat</em> jars).  The source code of this sec­tion is avail­able <a href=\"https://github.com/kameshsampath/vmp-blog/tree/package\">here</a>.</p><p>To make <code>package</code> work cor­rectly we need to add prop­erty called <code>vertx.verticle</code>, which will be used by the vertx-​maven-plugin to set the <code>Main-Verticle:</code> at­tribute of the <code>MANIFEST.MF</code>.  Please refer to the doc­u­men­ta­tion of  <a href=\"https://vmp.fabric8.io/#vertx:package\">pack­age</a> for other pos­si­ble con­fig­u­ra­tions.  There is also a <a href=\"https://vmp.fabric8.io/#vertx:examples\">ex­am­ples</a> sec­tion of the vertx-​maven-plugin which pro­vides var­i­ous sam­ples snip­pets.</p><p>The up­dated <code>pom.xml</code> with the added prop­erty <code>vertx-maven-plugin</code> is shown below:</p><div class=\"alert info\"><p>Only up­dated sec­tion is shown below, rest of the pom.xml is same as above</p></div><div>...waiting for Gist...</div><p>To pack­age the Vert.x ap­pli­ca­tion, run the fol­low­ing <a href=\"http://maven.apache.org\">Apache Maven</a> com­mand from the project di­rec­tory:</p><pre><code class=\"hljs language-bash\">mvn clean package\n</code></pre><p>On suc­cess­ful run of the above com­mand you should see the file with name <code>${project.finalName}.jar</code> cre­ated in the <code>${project.build.directory}</code>, you could now do the fol­low­ing to start and run the Vert.x ap­pli­ca­tion.</p><pre><code class=\"hljs language-bash\">java -jar <span class=\"hljs-variable\">${project.build.directory}</span>/<span class=\"hljs-variable\">${project.finalName}</span>.jar\n</code></pre><p>The gen­er­ated <code>MANIFEST.MF</code> file is as shown below:</p><pre><code class=\"hljs language-text\">Main-Class                               io.vertx.core.Launcher\nMain-Verticle                            io.fabric8.blog.MainVerticle\nManifest-Version                         1.0\n</code></pre><p>The source code up to now is avail­able in <a href=\"https://github.com/kameshsampath/vmp-blog/tree/package\">here</a></p><h3 id=\"spi-combination\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#spi-combination\"></a>SPI Combination</h3><p>The <code>package</code> goal by de­fault does a SPI com­bi­na­tion, lets say you have a ser­vice file called <code>com.fasterxml.jackson.core.JsonFactory</code> in <code>${project.basedir}/src/main/resources/META-INF/services</code> with con­tents:</p><pre><code class=\"hljs language-text\">foo.bar.baz.MyImpl\n${combine}\n</code></pre><p>Dur­ing pack­ag­ing, if the <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a> finds an­other <code>com.fasterxml.jackson.core.JsonFactory</code> ser­vice de­f­i­n­i­tion file within the project de­pen­den­cies with con­tent <em>foo.bar.baz2.My­Impl2</em>, then it merges the con­tent into <code>com.fasterxml.jackson.core.JsonFactory</code> of <code>${project.basedir}/src/main/resources/META-INF/services</code>, re­sult­ing in the fol­low­ing con­tent:</p><pre><code class=\"hljs language-text\">foo.bar.baz.MyImpl\nfoo.bar.baz2.MyImpl2\n</code></pre><p>The po­si­tion of <code>${combine}</code> con­trols the or­der­ing of the merge, since we added <code>${combine}</code> below <em>foo.bar.baz.My­Impl</em> all other SPI de­f­i­n­i­tions will be ap­pended below <em>foo.bar.baz.My­Impl</em></p><h2 id=\"whats-next-\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#whats-next-\"></a>What’s next ?</h2><p>It’s good to have the jar pack­aged and run using <code>java -jar uber-jar</code>, but when doing typ­i­cal de­vel­op­ment you don’t  want to do fre­quent <a href=\"http://maven.apache.org\">Apache Maven</a> pack­ag­ing and wish to see your changes au­to­mat­i­cally re­de­ployed.</p><p>Don’t worry!!! As part of <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a> we have added the in­cre­men­tal builder to <a href=\"http://maven.apache.org\">Apache Maven</a> build, which will watch for your source and re­source changes to per­form au­to­matic re-​build and del­e­gate the re­de­ploy­ment to Vert.x.</p><p>Run, re­de­ploy and other fea­tures of the <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a> will be ex­plored in de­tail in the next part of this se­ries, until then have fun with <a href=\"http://vmp.fabric8.io\">fab­ric8 Vert.x Maven Plu­gin</a>!!</p>","scope":{}},"tfIdfTerms":[{"term":"maven","tf":23},{"term":"plugin","tf":21},{"term":"applic","tf":12},{"term":"fabric8","tf":10},{"term":"packag","tf":10},{"term":"apach","tf":9},{"term":"run","tf":8},{"term":"us","tf":8},{"term":"follow","tf":7},{"term":"project","tf":7},{"term":"start","tf":6},{"term":"will","tf":6},{"term":"sourc","tf":6},{"term":"avail","tf":6},{"term":"ad","tf":6},{"term":"build","tf":5},{"term":"code","tf":5},{"term":"let","tf":5},{"term":"content","tf":5},{"term":"command","tf":5},{"term":"configur","tf":4},{"term":"develop","tf":4},{"term":"jar","tf":4},{"term":"spi","tf":4},{"term":"typic","tf":4}]},{"filename":"blog/2016-12-02-oauth2-got-easy.mdx","date":"2016-12-02","slug":"oauth2-got-easy","meta":{"title":"OAuth2 got easy","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"Oauth2 support exists in Eclipse Vert.x since version 3.2.0. The implementation follows the principles that rule the whole vert.x ecosystem."},"readingTime":{"text":"2 min read","minutes":1.865,"time":111900,"words":373},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Oauth2\"), \" sup\\xADport ex\\xADists in Eclipse Vert.x since ver\\xADsion 3.2.0. The im\\xADple\\xADmen\\xADta\\xADtion fol\\xADlows the prin\\xADci\\xADples that rule the whole vert.x ecosys\\xADtem: un\\xADopin\\xADion\\xADated, it does what you want it to do, sim\\xADple but not too sim\\xADple.\"), mdx(\"p\", null, \"This works fine be\\xADcause \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"OAuth2\"), \" is a widely spread stan\\xADdard and ven\\xADdors ad\\xADhere to it quite well. How\\xADever due to the API and the de\\xADtails of the spec\\xADi\\xADfi\\xADca\\xADtion it re\\xADquires some knowl\\xADedge on what kind of \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"flow\"), \" your ap\\xADpli\\xADca\\xADtion needs to sup\\xADport, what are the end\\xADpoints for au\\xADtho\\xADriz\\xADing and get\\xADting to\\xADkens. This in\\xADfor\\xADma\\xADtion, even though eas\\xADily ac\\xADces\\xADsi\\xADble to any\\xADone who\\u2019s got the time and will, to read the ven\\xADdor doc\\xADu\\xADmen\\xADta\\xADtion is easy to find, but it means that de\\xADvel\\xADop\\xADers would need to spend time in a non-\\u200Bproject problem-\\u200Brelated task.\"), mdx(\"p\", null, \"Vert.x thrives for being fast and pro\\xADduc\\xADtive, so what if we could help you fo\\xADcus\\xADing on your de\\xADvel\\xADop\\xADment tasks rather than read\\xADing Oauth2 provider doc\\xADu\\xADmen\\xADta\\xADtion? This is what you can ex\\xADpect for the next re\\xADlease.\"), mdx(\"p\", null, \"Out of the box you will find out that you can in\\xADstan\\xADti\\xADate an OAuth2 provider as easy as:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-clojure\"\n  }), \"Provider.create(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"vertx\"), \", clientId, clientSecret)\\n\")), mdx(\"p\", null, \"That\\u2019s it! sim\\xADple, to the point, sure it makes some as\\xADsump\\xADtions, it as\\xADsumes that you want to use the \\u201D\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AUTH_CODE\"), \"\\u201D flow which is what you nor\\xADmally do for web ap\\xADpli\\xADca\\xADtions with a back\\xADend.\"), mdx(\"p\", null, \"The sup\\xADported \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Provider\"), \" im\\xADple\\xADmen\\xADta\\xADtions will con\\xADfig\\xADure the base API (which will be still avail\\xADable) with the cor\\xADrect URLs, scope en\\xADcod\\xADing scheme or extra con\\xADfig\\xADu\\xADra\\xADtion such as \\u201D\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"shopId\"), \"\\u201D/\\u201D\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GUID\"), \"\\u201D for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Shopify\"), \"/\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Azure AD\"), \".\"), mdx(\"p\", null, \"So what sup\\xADported \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Provider\"), \"s can you al\\xADready find?\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://app.net/\"\n  }), \"App.net\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://azure.microsoft.com/en-us/\"\n  }), \"Azure\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://box.com\"\n  }), \"Box.com\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://dropbox.com\"\n  }), \"Drop\\xADbox\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://facebook.com\"\n  }), \"Face\\xADbook\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://foursquare.com\"\n  }), \"Foursquare\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://github.com\"\n  }), \"Github\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://google.com\"\n  }), \"Google\"), \" (ei\\xADther \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"AUTH_CODE\"), \" flow or \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"Server to Server\"), \" flow) \"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://instagram.com\"\n  }), \"In\\xADsta\\xADgram\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://keycloak.org\"\n  }), \"Key\\xADcloak\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://linkedin.com\"\n  }), \"LinkedIn\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://mailchimp.com\"\n  }), \"Mailchimp\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://salesforce.com\"\n  }), \"Sales\\xADforce\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://shopify.com\"\n  }), \"Shopify\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://soundcloud.com\"\n  }), \"Sound\\xADcloud\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://stripe.com\"\n  }), \"Stripe\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://twitter.com\"\n  }), \"Twit\\xADter\"))), mdx(\"p\", null, \"That\\u2019s a hand\\xADful of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Provider\"), \"s, but there is more. Say that you want to en\\xADsure that your SSL con\\xADnec\\xADtions are valid and want to con\\xADtrol the cer\\xADtifi\\xADcate val\\xADi\\xADda\\xADtion. Every provider also ac\\xADcepts a Http\\xADClien\\xADtOp\\xADtions ob\\xADject that will be used in\\xADter\\xADnally when con\\xADtact\\xADing your provider, so in this case, you have full se\\xADcu\\xADrity con\\xADtrol of your con\\xADnec\\xADtion, not just de\\xADfaults.\"), mdx(\"p\", null, \"You can ex\\xADpect this new code to land for 3.4 as it is not avail\\xADable in the cur\\xADrent re\\xADlease (3.3.3).\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p><code>Oauth2</code> sup­port ex­ists in Eclipse Vert.x since ver­sion 3.2.0. The im­ple­men­ta­tion fol­lows the prin­ci­ples that rule the whole vert.x ecosys­tem: un­opin­ion­ated, it does what you want it to do, sim­ple but not too sim­ple.</p><p>This works fine be­cause <code>OAuth2</code> is a widely spread stan­dard and ven­dors ad­here to it quite well. How­ever due to the API and the de­tails of the spec­i­fi­ca­tion it re­quires some knowl­edge on what kind of <em>flow</em> your ap­pli­ca­tion needs to sup­port, what are the end­points for au­tho­riz­ing and get­ting to­kens. This in­for­ma­tion, even though eas­ily ac­ces­si­ble to any­one who’s got the time and will, to read the ven­dor doc­u­men­ta­tion is easy to find, but it means that de­vel­op­ers would need to spend time in a non-​project problem-​related task.</p><p>Vert.x thrives for being fast and pro­duc­tive, so what if we could help you fo­cus­ing on your de­vel­op­ment tasks rather than read­ing Oauth2 provider doc­u­men­ta­tion? This is what you can ex­pect for the next re­lease.</p><p>Out of the box you will find out that you can in­stan­ti­ate an OAuth2 provider as easy as:</p><pre><code class=\"hljs language-clojure\">Provider.create(<span class=\"hljs-name\">vertx</span>, clientId, clientSecret)\n</code></pre><p>That’s it! sim­ple, to the point, sure it makes some as­sump­tions, it as­sumes that you want to use the ”<code>AUTH_CODE</code>” flow which is what you nor­mally do for web ap­pli­ca­tions with a back­end.</p><p>The sup­ported <code>Provider</code> im­ple­men­ta­tions will con­fig­ure the base API (which will be still avail­able) with the cor­rect URLs, scope en­cod­ing scheme or extra con­fig­u­ra­tion such as ”<code>shopId</code>”/”<code>GUID</code>” for <code>Shopify</code>/<code>Azure AD</code>.</p><p>So what sup­ported <code>Provider</code>s can you al­ready find?</p><ul><li><a href=\"https://app.net/\">App.net</a></li><li><a href=\"https://azure.microsoft.com/en-us/\">Azure</a></li><li><a href=\"https://box.com\">Box.com</a></li><li><a href=\"https://dropbox.com\">Drop­box</a></li><li><a href=\"https://facebook.com\">Face­book</a></li><li><a href=\"https://foursquare.com\">Foursquare</a></li><li><a href=\"http://github.com\">Github</a></li><li><a href=\"https://google.com\">Google</a> (ei­ther <code>AUTH_CODE</code> flow or <code>Server to Server</code> flow) </li><li><a href=\"https://instagram.com\">In­sta­gram</a></li><li><a href=\"https://keycloak.org\">Key­cloak</a></li><li><a href=\"https://linkedin.com\">LinkedIn</a></li><li><a href=\"https://mailchimp.com\">Mailchimp</a></li><li><a href=\"https://salesforce.com\">Sales­force</a></li><li><a href=\"https://shopify.com\">Shopify</a></li><li><a href=\"https://soundcloud.com\">Sound­cloud</a></li><li><a href=\"https://stripe.com\">Stripe</a></li><li><a href=\"https://twitter.com\">Twit­ter</a></li></ul><p>That’s a hand­ful of <code>Provider</code>s, but there is more. Say that you want to en­sure that your SSL con­nec­tions are valid and want to con­trol the cer­tifi­cate val­i­da­tion. Every provider also ac­cepts a Http­Clien­tOp­tions ob­ject that will be used in­ter­nally when con­tact­ing your provider, so in this case, you have full se­cu­rity con­trol of your con­nec­tion, not just de­faults.</p><p>You can ex­pect this new code to land for 3.4 as it is not avail­able in the cur­rent re­lease (3.3.3).</p>","scope":{}},"tfIdfTerms":[{"term":"will","tf":5},{"term":"support","tf":4},{"term":"want","tf":4},{"term":"flow","tf":4},{"term":"provid","tf":4},{"term":"simpl","tf":3},{"term":"not","tf":3},{"term":"find","tf":3},{"term":"implement","tf":2},{"term":"vendor","tf":2},{"term":"api","tf":2},{"term":"applic","tf":2},{"term":"need","tf":2},{"term":"time","tf":2},{"term":"read","tf":2},{"term":"document","tf":2},{"term":"easi","tf":2},{"term":"develop","tf":2},{"term":"task","tf":2},{"term":"oauth2","tf":2},{"term":"expect","tf":2},{"term":"releas","tf":2},{"term":"box","tf":2},{"term":"us","tf":2},{"term":"configur","tf":2}]},{"filename":"blog/2016-09-28-vert-x-featuring-continuous-delivery-with-jenkins-and-ansible.mdx","date":"2016-09-28","slug":"vert-x-featuring-continuous-delivery-with-jenkins-and-ansible","meta":{"title":"Vert.x featuring Continuous Delivery with Jenkins and Ansible","category":"guides","authors":[{"name":"Ricardo Hernandez","github_id":"ricardohmon"}],"summary":"This blog entry describes an approach to adopt Continuous Delivery for Vert.x applications using Jenkins and Ansible by taking advantage of the Jenkins Job DSL and Ansible plugins."},"readingTime":{"text":"9 min read","minutes":8.965,"time":537900,"words":1793},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This blog entry de\\xADscribes an ap\\xADproach to adopt \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Con\\xADtin\\xADu\\xADous De\\xADliv\\xADery\"), \" for Vert.x ap\\xADpli\\xADca\\xADtions using Jenk\\xADins and An\\xADsi\\xADble by tak\\xADing ad\\xADvan\\xADtage of the Jenk\\xADins Job DSL and An\\xADsi\\xADble plu\\xADg\\xADins.\"), mdx(\"h2\", {\n    \"id\": \"preamble\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#preamble\"\n  })), \"Preamble\"), mdx(\"p\", null, \"This post was writ\\xADten in con\\xADtext of the project ti\\xADtled \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://summerofcode.withgoogle.com/projects/#4858492141699072\"\n  }), \"De\\xADvOps tool\\xADing for Vert.x ap\\xADpli\\xADca\\xADtions\"), \"\\u201D, one of the projects at Vert.x tak\\xADing place dur\\xADing the 2016 edi\\xADtion of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://summerofcode.withgoogle.com/about/\"\n  }), \"Google Sum\\xADmer of Code\"), \", a pro\\xADgram that aims to bring stu\\xADdents to\\xADgether with open source or\\xADga\\xADni\\xADza\\xADtions in order to help them to gain ex\\xADpo\\xADsure to soft\\xADware de\\xADvel\\xADop\\xADment prac\\xADtices and real-\\u200Bworld chal\\xADlenges.\"), mdx(\"h2\", {\n    \"id\": \"introduction\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#introduction\"\n  })), \"Introduction\"), mdx(\"p\", null, \"Sys\\xADtem con\\xADfig\\xADu\\xADra\\xADtion man\\xADage\\xADment (e.g., An\\xADsi\\xADble) has been re\\xADally hype in the re\\xADcent years and there is a strong rea\\xADson for that.\\nCon\\xADfig\\xADu\\xADra\\xADtion man\\xADage\\xADment fa\\xADcil\\xADi\\xADtates con\\xADfig\\xADur\\xADing a new en\\xADvi\\xADron\\xADment fol\\xADlow\\xADing a fixed \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"recipe\"), \" or slightly vary\\xADing it with the help of pa\\xADra\\xADme\\xADters. This has not only the ad\\xADvan\\xADtage of being able to do it more fre\\xADquently but re\\xADduces the chance of er\\xADrors than doing it man\\xADu\\xADally.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Be\\xADyond that, com\\xADbin\\xADing it with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Con\\xADtin\\xADu\\xADous In\\xADte\\xADgra\\xADtion\"), \" tools (e.g., Jenk\\xADins) al\\xADlows mak\\xADing a de\\xADploy\\xADment as soon as a new code\\xADbase ver\\xADsion is avail\\xADable, which rep\\xADre\\xADsents the main build\\xADing block of a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Con\\xADtin\\xADu\\xADous De\\xADliv\\xADery\"), \" pipeline, one of the ob\\xADjec\\xADtives of em\\xADbrac\\xADing a De\\xADvOps cul\\xADture.\"), mdx(\"p\", null, \"Given that Vert.x is a frame\\xADwork that con\\xADsists in a few li\\xADbraries which can be shipped within a sin\\xADgle \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"fat jar\"), \", adopt\\xADing a De\\xADvOps cul\\xADture while de\\xADvel\\xADop\\xADing a Vert.x-\\u200Bbased ap\\xADpli\\xADca\\xADtion is straight\\xADfor\\xADward.\"), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#overview\"\n  })), \"Overview\"), mdx(\"p\", null, \"As seen in the di\\xADa\\xADgram below, this post de\\xADscribes a method to de\\xADfine a Jenk\\xADins build job which will react to changes in a code repos\\xADi\\xADtory. After suc\\xADces\\xADfully build\\xADing the project, the job will ex\\xADe\\xADcute an An\\xADsi\\xADble \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"play\\xADbook\"), \" to de\\xADploy the new ap\\xADpli\\xADca\\xADtion ver\\xADsion to the hosts spec\\xADi\\xADfied within the An\\xADsi\\xADble con\\xADfig\\xADu\\xADra\\xADtion.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/continuous-delivery-jenkins-ansible/ansible-jenkins-overview.svg\",\n    \"alt\": \"Overview of the continous delivery process\"\n  }))), mdx(\"h2\", {\n    \"id\": \"creating-a-jenkins-build-job-using-job-dsl\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#creating-a-jenkins-build-job-using-job-dsl\"\n  })), \"Creating a Jenkins build job using Job DSL\"), mdx(\"p\", null, \"Jenk\\xADins has cre\\xADated a con\\xADve\\xADnient way to de\\xADfine build jobs using a DSL. While this op\\xADtion avoids the has\\xADsle of con\\xADfig\\xADur\\xADing build jobs man\\xADu\\xADally, it sup\\xADports all fea\\xADtures of the reg\\xADu\\xADlar in\\xADter\\xADface through its \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://jenkinsci.github.io/job-dsl-plugin/\"\n  }), \"API\"), \". It is pos\\xADsi\\xADble to use An\\xADsi\\xADble to\\xADgether with Jenk\\xADins with the help of the An\\xADsi\\xADble \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://wiki.jenkins-ci.org/display/JENKINS/Ansible+Plugin/\"\n  }), \"plugin\"), \", whose in\\xADstruc\\xADtions are also in\\xADcluded in the Job DSL \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/jenkinsci/ansible-plugin/blob/master/README.md\"\n  }), \"API\"), \". Al\\xADter\\xADna\\xADtively to the Job DSL Plu\\xADgin, An\\xADsi\\xADble can be used in\\xADside the de\\xADf\\xADi\\xADn\\xADi\\xADtion of Jenk\\xADins Pipeline, one of tool\\u2019s most re\\xADcent fea\\xADtures.\"), mdx(\"p\", null, \"Below is a sam\\xADple job de\\xADf\\xADi\\xADn\\xADi\\xADtion which can be used after cre\\xADat\\xADing a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"freestyle\"), \" job (seed job) and adding a new build step with the DSL script. In the script, there are a few things to no\\xADtice:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A name for the job cre\\xADated by the seed job is given.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Spe\\xADcific ver\\xADsions of JDK, Maven, and An\\xADsi\\xADble (avail\\xADable in the en\\xADvi\\xADron\\xADment) are used.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Git is se\\xADlected as the SCM plat\\xADform and the tar\\xADget repos\\xADi\\xADtory is de\\xADfined. Also, the build job is trig\\xADgered ac\\xADcord\\xADing to a spe\\xADcific in\\xADter\\xADval.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The Maven \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"pack\\xADage\"), \" goal is in\\xADvoked, which is in\\xADstructed to pack\\xADage the ap\\xADpli\\xADca\\xADtion into a fat jar.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Lastly, An\\xADsi\\xADble is used to call a play\\xADbook avail\\xADable in the filesys\\xADtem. The app will be de\\xADployed to the de\\xADfined tar\\xADget hosts and the cre\\xADden\\xADtials (con\\xADfig\\xADured in Jenk\\xADins) will be used to log into the tar\\xADget hosts. Ad\\xADdi\\xADtion\\xADally, en\\xADabling the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"colorizedOutput\"), \" op\\xADtion will re\\xADsult in a friend\\xADlier for\\xADmat\\xADting of the re\\xADsults in the con\\xADsole out\\xADput. The con\\xADtents of this play\\xADbook will be ad\\xADdressed in the next sec\\xADtion.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-groovy\"\n  }), \"job(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'vertx-microservices-workshop-job'\"), \") {\\n    jdk(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'JDK8'\"), \")\\n    scm {\\n        git(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'git://github.com/ricardohmon/vertx-microservices-workshop.git'\"), \")\\n    }\\n    triggers {\\n        scm(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'*/15 * * * *'\"), \")\\n    }\\n    steps {\\n\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"def\"), \" mvnInst = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'M3.3.9'\"), \"  \\n      maven {  \\n        goals(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'package'\"), \")  \\n        mavenInstallation(mvnInst)  \\n      }  \\n      ansiblePlaybook(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'/ansible/playbook.yml'\"), \") {  \\n        inventoryPath(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'/ansible/hosts'\"), \")  \\n        ansibleName(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'Ansible2.0'\"), \")  \\n        credentialsId(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'vagrant-key'\"), \")  \\n        colorizedOutput(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \")  \\n      }  \\n\\n    }  \\n}\\n\")), mdx(\"h2\", {\n    \"id\": \"deploying-vertx-app-using-ansible\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#deploying-vertx-app-using-ansible\"\n  })), \"Deploying Vert.x app using Ansible\"), mdx(\"p\", null, \"An An\\xADsi\\xADble Play\\xADbook re\\xADsults quite con\\xADve\\xADnient to de\\xADploy a Vert.x ap\\xADpli\\xADca\\xADtion to a num\\xADber of hosts while still tak\\xADing con\\xADsid\\xADer\\xADa\\xADtions for each of them. Below is a sam\\xADple play\\xADbook that de\\xADploys the re\\xADspec\\xADtive ap\\xADpli\\xADca\\xADtion to each of the hosts de\\xADscribed in an \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"in\\xADven\\xADtory\"), \" file. The play\\xADbook com\\xADprises the fol\\xADlow\\xADing tasks and takes the listed con\\xADsid\\xADer\\xADa\\xADtions:\"), mdx(\"p\", null, \"1) A task that tar\\xADgets only hosts with a data\\xADbase.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The tar\\xADget hosts is spec\\xADi\\xADfied with the name of the host (or hosts group) de\\xADfined in the in\\xADven\\xADtory file.\")), mdx(\"p\", null, \"2) Ac\\xADtual ap\\xADpli\\xADca\\xADtion de\\xADploy\\xADment task. Here, sev\\xADeral con\\xADsid\\xADer\\xADa\\xADtions are done:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The ap\\xADpli\\xADca\\xADtion may re\\xADquire that only one host is up\\xADdated at the time.\", mdx(\"br\", {\n    parentName: \"li\"\n  }), \"This can be achieved with the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"serial\"), \" op\\xADtion, while the order of the de\\xADploy\\xADment to hosts can be en\\xADforced in the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"hosts\"), \" op\\xADtion.\")), mdx(Alert, {\n    info: true,\n    title: \"Host processing order\",\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"Even though we could have de\\xADclared \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"all\"), \" hosts, An\\xADsi\\xADble does not pro\\xADvide an ex\\xADplicit way to spec\\xADify the order.\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Java is a sys\\xADtem re\\xADquire\\xADment for our Vert.x ap\\xADpli\\xADca\\xADtions.\", mdx(\"br\", {\n    parentName: \"li\"\n  }), \"Be\\xADsides in\\xADstalling it (keep read\\xADing), we need to de\\xADclare the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"JAVA_HOME\"), \" en\\xADvi\\xADron\\xADment vari\\xADable.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"A de\\xADploy\\xADment may just rep\\xADre\\xADsent an up\\xADdate to an al\\xADready run\\xADning ap\\xADpli\\xADca\\xADtion (\", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Con\\xADtin\\xADu\\xADous De\\xADploy\\xADment\"), \"), hence it is con\\xADve\\xADnient to stop the pre\\xADvi\\xADous ap\\xADpli\\xADca\\xADtion in\\xADside the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"pre_tasks\"), \" and take post-\\u200Bdeployment ac\\xADtions in the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"post_tasks\"), \".\\nVert.x ships with the con\\xADve\\xADnient \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"start\"), \"/\", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"stop\"), \"/\", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"list\"), \" com\\xADmands that re\\xADsult very help\\xADful here. We can use the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"list\"), \" com\\xADmand and ex\\xADtract (using regex) the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"id\"), \" of the run\\xADning ap\\xADpli\\xADca\\xADtion of its out\\xADput to stop it be\\xADfore de\\xADploy\\xADing a new ver\\xADsion.\")), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"If our so\\xADlu\\xADtion in\\xADcludes a load bal\\xADancer or proxy, we could deal with them at this step as de\\xADscribed in An\\xADsi\\xADble\\u2019s \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://docs.ansible.com/ansible/playbooks_delegation.html\"\n  }), \"best prac\\xADtices\"), \" for rolling up\\xADdates\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Call to a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"role\"), \" that makes the ac\\xADtual ap\\xADpli\\xADca\\xADtion de\\xADploy\\xADment. The Jenk\\xADins An\\xADsi\\xADble Plu\\xADgin in\\xADcludes, be\\xADtween oth\\xADers, a \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"WORKSPACE\"), \" en\\xADvi\\xADron\\xADment vari\\xADable, which may re\\xADsult very help\\xADful in the fol\\xADlow\\xADing tasks, as shown later.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-yaml\"\n  }), \"  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"# 1) Special task for the service with a db\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"hosts:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"audit-service\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"remote_user:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"vagrant\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"become:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"yes\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"roles:\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"db-setup\"), \"\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"# 2) Common tasks for all hosts\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"hosts:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"quote-generator:portfolio-service:compulsive-traders:audit-service:trader-dashboard\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"remote_user:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"vagrant\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"become:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"yes\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"serial:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"environment:\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"JAVA_HOME:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/usr/lib/jvm/jre-1.8.0-openjdk/\"), \"\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"pre_tasks:\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Check\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"if\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"the\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"exists\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"in\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"the\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"target\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"already\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"stat:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"path=/usr/share/vertx_app/app-fatjar.jar\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"register:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"st\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"List\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"running\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Vert.x\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"applications\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"command:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"java\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/usr/share/vertx_app/app-fatjar.jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"list\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"register:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"running_app_list\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"when:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"st.stat.exists\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"==\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"True\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Stop\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"if\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"it\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"is\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"already\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"running\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"(avoid\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"multiple\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"running\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"instances)\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"command:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"java\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/usr/share/vertx_app/app-fatjar.jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"stop\"), \" {\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"}{{ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"item\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"|\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"regex_replace('^(?P<V_id>.\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"8\"), \"]\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-.\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"4\"), \"]\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-.\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"4\"), \"]\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \".\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"4\"), \"]\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \".\"), \"[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"12\"), \"]\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \")\\\\t.*'\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'\\\\\\\\g<V_id>'\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \")\"), \" }}{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"}\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"with_items:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"{% raw %}\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-template-variable\"\n  }), \"{{ running_app_list.stdout_lines|default([]) }}\"), \"{% endraw %}\\\"\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"when:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"st.stat.exists\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"==\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"True\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"and\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"(item\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"|\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"regex_replace('.*\\\\t(.*)$',\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'\\\\\\\\1'\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \")\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"|\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"match('.*/app-fatjar.jar$'))\"), \"\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"# Main role\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"roles:\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"role:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"vertx-app-deployment\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"jenkins_job_workspace:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-template-variable\"\n  }), \"{{ lookup('env', 'WORKSPACE') }}\"), \"\\\"\"), \" }\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"post_tasks:\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"List\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"again\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"running\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Vert.x\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"applications\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"command:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"java\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/usr/share/vertx_app/app-fatjar.jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"list\"), \"\\n\")), mdx(\"p\", null, \"Once we took care of the ac\\xADtions shown be\\xADfore, the re\\xADmain\\xADing tasks (in\\xADcluded in the main de\\xADploy\\xADment role) re\\xADduce to the fol\\xADlow\\xADing:\"), mdx(\"p\", null, \"1) Pre\\xADpare the tar\\xADget ma\\xADchine with the proper en\\xADvi\\xADron\\xADment to run our ap\\xADpli\\xADca\\xADtion. This in\\xADcludes:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Set up Java (pretty con\\xADve\\xADnient to do it through a pack\\xADage man\\xADager).\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Copy the Vert.x ap\\xADpli\\xADca\\xADtion pack\\xADage to the ap\\xADpro\\xADpri\\xADate folder (quite sim\\xADple using a fat jar). The ac\\xADtual name and lo\\xADca\\xADtion of the jar pack\\xADage in the Jenk\\xADins en\\xADvi\\xADron\\xADment can be de\\xADfined using host-\\u200Bspecific \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"http://docs.ansible.com/ansible/playbooks_delegation.html\"\n  }), \"vari\\xADables\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"In case nec\\xADes\\xADsary, copy the re\\xADquired con\\xADfig files.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-yaml\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Install\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Java\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1.8\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"and\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"some\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"basic\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"dependencies\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"yum:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"name={%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}{{\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"item\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"}}{%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"state=present\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"with_items:\"), \"\\n   \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"java-1.8.0-openjdk\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Ensure\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"dir\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"exists\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"file:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"path=/usr/share/vertx_app/\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"recurse=yes\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"state=directory\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"mode=0744\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Copy\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"the\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Vert.x\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"application\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"package\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"copy:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"src={%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}{{\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app_jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"}}{%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"dest=/usr/share/vertx_app/app-fatjar.jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"mode=0755\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Ensure\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"config\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"dir\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"exists\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"file:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"path=/etc/vertx_app/\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"recurse=yes\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"state=directory\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"mode=0744\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Copy\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"the\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"application\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"config\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"file\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"if\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"needed\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"copy:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"src={%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}{{\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app_config\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"}}{%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%}\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"dest=/etc/vertx_app/config.json\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"mode=0755\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"when:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"app_config\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"is\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"defined\"), \"\\n\")), mdx(\"p\", null, \"2) Run the ap\\xADpli\\xADca\\xADtion as a ser\\xADvice in the host\\xADing ma\\xADchine.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Make sure to ig\\xADnore the hang up sig\\xADnal with the help of \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"nohup\"), \" com\\xADmand. Oth\\xADer\\xADwise, An\\xADsi\\xADble will be stuck at this step.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-yaml\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Run\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Vert.x\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"application\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"as\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"a\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"service,\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"ignore\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"the\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"SIGHUP\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"signal\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"shell:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"nohup\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"java\"), \" {\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"}{{ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"vertx_opts\"), \" }}{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"} \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"-jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/usr/share/vertx_app/app-fatjar.jar\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"start\"), \" {\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"raw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"}{{ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"launch_params\"), \" }}{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"endraw\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%\"), \"}\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"register:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"svc_run_out\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"Print\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"run\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"output\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"debug:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"var=svc_run_out.stdout_lines\"), \"\\n\")), mdx(Alert, {\n    info: true,\n    title: \"Launching the Vert.x app\",\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"This ex\\xADam\\xADple uses the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"start\"), \" com\\xADmand to launch the ap\\xADpli\\xADca\\xADtion as a ser\\xADvice. This method may re\\xADsult more com\\xADfort\\xADable than cre\\xADat\\xADing an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx.io/blog/vert-x-3-init-d-script/\"\n  }), \"init.d script\"), \" or call\\xADing Vert.x from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/vert-x3/vertx-examples/#running-at-the-command-line\"\n  }), \"com\\xADmand line\"), \", which would have re\\xADquired to in\\xADstall the Vert.x li\\xADbraries in an in\\xADde\\xADpen\\xADdent An\\xADsi\\xADble task.\")), mdx(\"p\", null, \"This de\\xADscribes all the con\\xADfig\\xADu\\xADra\\xADtion needed to be able to build from a repos\\xADi\\xADtory using Jenk\\xADins and de\\xADploy the re\\xADsults to our hosts with An\\xADsi\\xADble.\"), mdx(\"h2\", {\n    \"id\": \"sample-sources-and-demo\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#sample-sources-and-demo\"\n  })), \"Sample sources and demo\"), mdx(\"p\", null, \"The sam\\xADple con\\xADfig\\xADu\\xADra\\xADtions pre\\xADsented be\\xADfore are part of a com\\xADplete demo fo\\xADcused on the Vert.x mi\\xADcroser\\xADvices \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx-lab.dynamis-technologies.com/\"\n  }), \"work\\xADshop\"), \" to ex\\xADem\\xADplify a basic Con\\xADtin\\xADu\\xADous De\\xADliv\\xADery sce\\xADnario. This set up is avail\\xADable in a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/ricardohmon/vertx-ansible\"\n  }), \"repos\\xADi\\xADtory\"), \" and con\\xADtains, in ad\\xADdi\\xADtion, a pre-\\u200Bconfigured Jenkins-\\u200Bbased demo ready to host the build job de\\xADscribed the pre\\xADvi\\xADous sec\\xADtions. The demo sce\\xADnario re\\xADquires Va\\xADgrant and Vir\\xADtu\\xADal\\xADbox to be launched.\"), mdx(\"h3\", {\n    \"id\": \"launch-instructions\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#launch-instructions\"\n  })), \"Launch instructions\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Clone or down\\xADload this repos\\xADi\\xADtory, and launch the demo using \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vagrant up\"))), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-awk\"\n  }), \"git clone https:\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-regexp\"\n  }), \"//gi\"), \"thub.com\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-regexp\"\n  }), \"/ricardohmon/\"), \"vertx-ansible.git\\ncd demo\\nvagrant up\\n\")), mdx(\"p\", null, \"This com\\xADmand will launch a vir\\xADtual ma\\xADchine host\\xADing Jenk\\xADins with the re\\xADquired plu\\xADg\\xADins in\\xADstalled (tools names needed) and also launch five ad\\xADdi\\xADtional VMs that will host the mi\\xADcroser\\xADvices de\\xADployed by Jenk\\xADins.\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Cre\\xADate a Jenk\\xADins freestyle build job using the DSL job script (seed job) found in \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"deployment-jobs/microservices_workshop_dsl.groovy\"), \" and build it.\")), mdx(Alert, {\n    info: true,\n    title: \"Tool configuration assumption\",\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, \"The DSL Job as\\xADsumes the fol\\xADlow\\xADing tools (with names) have been con\\xADfig\\xADured in Jenk\\xADins: Java 8 (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"JDK8\"), \"), Maven (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"M3.3.9\"), \"), An\\xADsi\\xADble (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Ansible2.0\"), \")\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"After build\\xADing the seed job, a new job (\", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"vertx-microservices-workshop-job\"), \") will be cre\\xADated, which will be in charge of pulling re\\xADcent changes of the project, build\\xADing it, and de\\xADploy\\xADing it.\")), mdx(\"h3\", {\n    \"id\": \"demo\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#demo\"\n  })), \"Demo\"), mdx(\"p\", null, \"Watch the pre\\xADvi\\xADous demo in ac\\xADtion in the fol\\xADlow\\xADing screen\\xADcast:\"), mdx(\"div\", {\n    className: \"youtube-embed\"\n  }, mdx(\"iframe\", {\n    src: \"https://www.youtube.com/embed/GQd_Rfeu6Yo\",\n    frameBorder: \"0\",\n    allowFullScreen: true\n  })), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"Con\\xADtin\\xADu\\xADous De\\xADliv\\xADery ap\\xADproach is a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"must\"), \" in mod\\xADern soft\\xADware de\\xADvel\\xADop\\xADment life\\xADcy\\xADcles (in\\xADclud\\xADing Vert.x-\\u200Bbased ap\\xADpli\\xADca\\xADtions) and a step fur\\xADther to\\xADwards adopt\\xADing a De\\xADvOps cul\\xADture. There are a num\\xADber of tools that en\\xADable it and one ex\\xADam\\xADple is the com\\xADbi\\xADna\\xADtion of Jenk\\xADins + An\\xADsi\\xADble de\\xADscribed in this post.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"While Jenk\\xADins of\\xADfers the pos\\xADsi\\xADbil\\xADity to in\\xADte\\xADgrate re\\xADcent changes per\\xADceived in a code\\xADbase and build runnable ar\\xADti\\xADfacts, An\\xADsi\\xADble can help to de\\xADploy them to host\\xADing en\\xADvi\\xADron\\xADments. The usage of both tools can be cou\\xADpled eas\\xADily with the help of the Job DSL plug\\xADin, a fea\\xADture of Jenk\\xADins that al\\xADlows de\\xADscrib\\xADing a build job using a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"domain-\\u200Bspecific lan\\xADguage\"), \", which can help to in\\xADte\\xADgrate ad\\xADdi\\xADtional steps and tools to a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"CD\"), \" pipeline.\"), mdx(\"p\", null, \"Fur\\xADther en\\xADhance\\xADments can be done to this basic pipeline, such as, in\\xADte\\xADgrat\\xADing the re\\xADcent \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://wiki.jenkins-ci.org/display/JENKINS/Pipeline+Plugin\"\n  }), \"Pipeline plugin\"), \", a fea\\xADture that al\\xADlows a bet\\xADter or\\xADches\\xADtra\\xADtion of CD stages; in\\xADclu\\xADsion of no\\xADti\\xADfi\\xADca\\xADtion and alert\\xADing ser\\xADvices; and, ul\\xADti\\xADmately a zero-\\u200Bdowntime de\\xADploy\\xADment ap\\xADproach, which could be achieved with the help of a proxy; plus, tons of op\\xADtions avail\\xADable trough Jenk\\xADins plu\\xADg\\xADins.\"), mdx(\"p\", null, \"Thanks for read\\xADing!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>This blog entry de­scribes an ap­proach to adopt <em>Con­tin­u­ous De­liv­ery</em> for Vert.x ap­pli­ca­tions using Jenk­ins and An­si­ble by tak­ing ad­van­tage of the Jenk­ins Job DSL and An­si­ble plu­g­ins.</p><h2 id=\"preamble\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#preamble\"></a>Preamble</h2><p>This post was writ­ten in con­text of the project ti­tled “<a href=\"https://summerofcode.withgoogle.com/projects/#4858492141699072\">De­vOps tool­ing for Vert.x ap­pli­ca­tions</a>”, one of the projects at Vert.x tak­ing place dur­ing the 2016 edi­tion of <a href=\"https://summerofcode.withgoogle.com/about/\">Google Sum­mer of Code</a>, a pro­gram that aims to bring stu­dents to­gether with open source or­ga­ni­za­tions in order to help them to gain ex­po­sure to soft­ware de­vel­op­ment prac­tices and real-​world chal­lenges.</p><h2 id=\"introduction\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#introduction\"></a>Introduction</h2><p>Sys­tem con­fig­u­ra­tion man­age­ment (e.g., An­si­ble) has been re­ally hype in the re­cent years and there is a strong rea­son for that.\nCon­fig­u­ra­tion man­age­ment fa­cil­i­tates con­fig­ur­ing a new en­vi­ron­ment fol­low­ing a fixed <em>recipe</em> or slightly vary­ing it with the help of pa­ra­me­ters. This has not only the ad­van­tage of being able to do it more fre­quently but re­duces the chance of er­rors than doing it man­u­ally.<br/>\n<!-- -->Be­yond that, com­bin­ing it with <em>Con­tin­u­ous In­te­gra­tion</em> tools (e.g., Jenk­ins) al­lows mak­ing a de­ploy­ment as soon as a new code­base ver­sion is avail­able, which rep­re­sents the main build­ing block of a <em>Con­tin­u­ous De­liv­ery</em> pipeline, one of the ob­jec­tives of em­brac­ing a De­vOps cul­ture.</p><p>Given that Vert.x is a frame­work that con­sists in a few li­braries which can be shipped within a sin­gle <em>fat jar</em>, adopt­ing a De­vOps cul­ture while de­vel­op­ing a Vert.x-​based ap­pli­ca­tion is straight­for­ward.</p><h2 id=\"overview\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#overview\"></a>Overview</h2><p>As seen in the di­a­gram below, this post de­scribes a method to de­fine a Jenk­ins build job which will react to changes in a code repos­i­tory. After suc­ces­fully build­ing the project, the job will ex­e­cute an An­si­ble <em>play­book</em> to de­ploy the new ap­pli­ca­tion ver­sion to the hosts spec­i­fied within the An­si­ble con­fig­u­ra­tion.</p><p><img src=\"/images/blog/continuous-delivery-jenkins-ansible/ansible-jenkins-overview.svg\" alt=\"Overview of the continous delivery process\"/></p><h2 id=\"creating-a-jenkins-build-job-using-job-dsl\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#creating-a-jenkins-build-job-using-job-dsl\"></a>Creating a Jenkins build job using Job DSL</h2><p>Jenk­ins has cre­ated a con­ve­nient way to de­fine build jobs using a DSL. While this op­tion avoids the has­sle of con­fig­ur­ing build jobs man­u­ally, it sup­ports all fea­tures of the reg­u­lar in­ter­face through its <a href=\"https://jenkinsci.github.io/job-dsl-plugin/\">API</a>. It is pos­si­ble to use An­si­ble to­gether with Jenk­ins with the help of the An­si­ble <a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Ansible+Plugin/\">plugin</a>, whose in­struc­tions are also in­cluded in the Job DSL <a href=\"https://github.com/jenkinsci/ansible-plugin/blob/master/README.md\">API</a>. Al­ter­na­tively to the Job DSL Plu­gin, An­si­ble can be used in­side the de­f­i­n­i­tion of Jenk­ins Pipeline, one of tool’s most re­cent fea­tures.</p><p>Below is a sam­ple job de­f­i­n­i­tion which can be used after cre­at­ing a <em>freestyle</em> job (seed job) and adding a new build step with the DSL script. In the script, there are a few things to no­tice:</p><ul><li>A name for the job cre­ated by the seed job is given.</li><li>Spe­cific ver­sions of JDK, Maven, and An­si­ble (avail­able in the en­vi­ron­ment) are used.</li><li>Git is se­lected as the SCM plat­form and the tar­get repos­i­tory is de­fined. Also, the build job is trig­gered ac­cord­ing to a spe­cific in­ter­val.</li><li>The Maven <em>pack­age</em> goal is in­voked, which is in­structed to pack­age the ap­pli­ca­tion into a fat jar.</li><li>Lastly, An­si­ble is used to call a play­book avail­able in the filesys­tem. The app will be de­ployed to the de­fined tar­get hosts and the cre­den­tials (con­fig­ured in Jenk­ins) will be used to log into the tar­get hosts. Ad­di­tion­ally, en­abling the <code>colorizedOutput</code> op­tion will re­sult in a friend­lier for­mat­ting of the re­sults in the con­sole out­put. The con­tents of this play­book will be ad­dressed in the next sec­tion.</li></ul><pre><code class=\"hljs language-groovy\">job(<span class=\"hljs-string\">&#x27;vertx-microservices-workshop-job&#x27;</span>) {\n    jdk(<span class=\"hljs-string\">&#x27;JDK8&#x27;</span>)\n    scm {\n        git(<span class=\"hljs-string\">&#x27;git://github.com/ricardohmon/vertx-microservices-workshop.git&#x27;</span>)\n    }\n    triggers {\n        scm(<span class=\"hljs-string\">&#x27;*/15 * * * *&#x27;</span>)\n    }\n    steps {\n\n      <span class=\"hljs-keyword\">def</span> mvnInst = <span class=\"hljs-string\">&#x27;M3.3.9&#x27;</span>  \n      maven {  \n        goals(<span class=\"hljs-string\">&#x27;package&#x27;</span>)  \n        mavenInstallation(mvnInst)  \n      }  \n      ansiblePlaybook(<span class=\"hljs-string\">&#x27;/ansible/playbook.yml&#x27;</span>) {  \n        inventoryPath(<span class=\"hljs-string\">&#x27;/ansible/hosts&#x27;</span>)  \n        ansibleName(<span class=\"hljs-string\">&#x27;Ansible2.0&#x27;</span>)  \n        credentialsId(<span class=\"hljs-string\">&#x27;vagrant-key&#x27;</span>)  \n        colorizedOutput(<span class=\"hljs-literal\">true</span>)  \n      }  \n\n    }  \n}\n</code></pre><h2 id=\"deploying-vertx-app-using-ansible\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#deploying-vertx-app-using-ansible\"></a>Deploying Vert.x app using Ansible</h2><p>An An­si­ble Play­book re­sults quite con­ve­nient to de­ploy a Vert.x ap­pli­ca­tion to a num­ber of hosts while still tak­ing con­sid­er­a­tions for each of them. Below is a sam­ple play­book that de­ploys the re­spec­tive ap­pli­ca­tion to each of the hosts de­scribed in an <em>in­ven­tory</em> file. The play­book com­prises the fol­low­ing tasks and takes the listed con­sid­er­a­tions:</p><p>1) A task that tar­gets only hosts with a data­base.</p><ul><li>The tar­get hosts is spec­i­fied with the name of the host (or hosts group) de­fined in the in­ven­tory file.</li></ul><p>2) Ac­tual ap­pli­ca­tion de­ploy­ment task. Here, sev­eral con­sid­er­a­tions are done:</p><ul><li>The ap­pli­ca­tion may re­quire that only one host is up­dated at the time.<br/>This can be achieved with the <code>serial</code> op­tion, while the order of the de­ploy­ment to hosts can be en­forced in the <code>hosts</code> op­tion.</li></ul><div class=\"alert info\"><div class=\"alert-title\">Host processing order</div><p>Even though we could have de­clared <code>all</code> hosts, An­si­ble does not pro­vide an ex­plicit way to spec­ify the order.</p></div><ul><li>Java is a sys­tem re­quire­ment for our Vert.x ap­pli­ca­tions.<br/>Be­sides in­stalling it (keep read­ing), we need to de­clare the <code>JAVA_HOME</code> en­vi­ron­ment vari­able.</li><li>A de­ploy­ment may just rep­re­sent an up­date to an al­ready run­ning ap­pli­ca­tion (<em>Con­tin­u­ous De­ploy­ment</em>), hence it is con­ve­nient to stop the pre­vi­ous ap­pli­ca­tion in­side the <code>pre_tasks</code> and take post-​deployment ac­tions in the <code>post_tasks</code>.\nVert.x ships with the con­ve­nient <code>start</code>/<code>stop</code>/<code>list</code> com­mands that re­sult very help­ful here. We can use the <code>list</code> com­mand and ex­tract (using regex) the <code>id</code> of the run­ning ap­pli­ca­tion of its out­put to stop it be­fore de­ploy­ing a new ver­sion.</li></ul><div class=\"alert info\"><p>If our so­lu­tion in­cludes a load bal­ancer or proxy, we could deal with them at this step as de­scribed in An­si­ble’s <a href=\"http://docs.ansible.com/ansible/playbooks_delegation.html\">best prac­tices</a> for rolling up­dates</p></div><ul><li>Call to a <code>role</code> that makes the ac­tual ap­pli­ca­tion de­ploy­ment. The Jenk­ins An­si­ble Plu­gin in­cludes, be­tween oth­ers, a <code>WORKSPACE</code> en­vi­ron­ment vari­able, which may re­sult very help­ful in the fol­low­ing tasks, as shown later.</li></ul><pre><code class=\"hljs language-yaml\">  <span class=\"hljs-comment\"># 1) Special task for the service with a db</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">audit-service</span>\n  <span class=\"hljs-attr\">remote_user:</span> <span class=\"hljs-string\">vagrant</span>\n  <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">yes</span>\n  <span class=\"hljs-attr\">roles:</span>\n    <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">db-setup</span>\n\n  <span class=\"hljs-comment\"># 2) Common tasks for all hosts</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">hosts:</span> <span class=\"hljs-string\">quote-generator:portfolio-service:compulsive-traders:audit-service:trader-dashboard</span>\n  <span class=\"hljs-attr\">remote_user:</span> <span class=\"hljs-string\">vagrant</span>\n  <span class=\"hljs-attr\">become:</span> <span class=\"hljs-literal\">yes</span>\n  <span class=\"hljs-attr\">serial:</span> <span class=\"hljs-number\">1</span>\n  <span class=\"hljs-attr\">environment:</span>\n    <span class=\"hljs-attr\">JAVA_HOME:</span> <span class=\"hljs-string\">/usr/lib/jvm/jre-1.8.0-openjdk/</span>\n\n  <span class=\"hljs-attr\">pre_tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Check</span> <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">the</span> <span class=\"hljs-string\">app</span> <span class=\"hljs-string\">jar</span> <span class=\"hljs-string\">exists</span> <span class=\"hljs-string\">in</span> <span class=\"hljs-string\">the</span> <span class=\"hljs-string\">target</span> <span class=\"hljs-string\">already</span>\n    <span class=\"hljs-attr\">stat:</span> <span class=\"hljs-string\">path=/usr/share/vertx_app/app-fatjar.jar</span>\n    <span class=\"hljs-attr\">register:</span> <span class=\"hljs-string\">st</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">List</span> <span class=\"hljs-string\">running</span> <span class=\"hljs-string\">Vert.x</span> <span class=\"hljs-string\">applications</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">java</span> <span class=\"hljs-string\">-jar</span> <span class=\"hljs-string\">/usr/share/vertx_app/app-fatjar.jar</span> <span class=\"hljs-string\">list</span>\n    <span class=\"hljs-attr\">register:</span> <span class=\"hljs-string\">running_app_list</span>\n    <span class=\"hljs-attr\">when:</span> <span class=\"hljs-string\">st.stat.exists</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-literal\">True</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Stop</span> <span class=\"hljs-string\">app</span> <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">it</span> <span class=\"hljs-string\">is</span> <span class=\"hljs-string\">already</span> <span class=\"hljs-string\">running</span> <span class=\"hljs-string\">(avoid</span> <span class=\"hljs-string\">multiple</span> <span class=\"hljs-string\">running</span> <span class=\"hljs-string\">instances)</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">java</span> <span class=\"hljs-string\">-jar</span> <span class=\"hljs-string\">/usr/share/vertx_app/app-fatjar.jar</span> <span class=\"hljs-string\">stop</span> {<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%</span>}{{ <span class=\"hljs-string\">item</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">regex_replace(&#x27;^(?P&lt;V_id&gt;.</span>[<span class=\"hljs-number\">8</span>]<span class=\"hljs-string\">-.</span>[<span class=\"hljs-number\">4</span>]<span class=\"hljs-string\">-.</span>[<span class=\"hljs-number\">4</span>]<span class=\"hljs-string\">.</span>[<span class=\"hljs-number\">4</span>]<span class=\"hljs-string\">.</span>[<span class=\"hljs-number\">12</span>]<span class=\"hljs-string\">)\\t.*&#x27;</span>, <span class=\"hljs-string\">&#x27;\\\\g&lt;V_id&gt;&#x27;</span><span class=\"hljs-string\">)</span> }}{<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%</span>}\n    <span class=\"hljs-attr\">with_items:</span> <span class=\"hljs-string\">&quot;{% raw %}<span class=\"hljs-template-variable\">{{ running_app_list.stdout_lines|default([]) }}</span>{% endraw %}&quot;</span>\n    <span class=\"hljs-attr\">when:</span> <span class=\"hljs-string\">st.stat.exists</span> <span class=\"hljs-string\">==</span> <span class=\"hljs-literal\">True</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">(item</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">regex_replace(&#x27;.*\\t(.*)$&#x27;,</span> <span class=\"hljs-string\">&#x27;\\\\1&#x27;</span><span class=\"hljs-string\">)</span> <span class=\"hljs-string\">|</span> <span class=\"hljs-string\">match(&#x27;.*/app-fatjar.jar$&#x27;))</span>\n\n  <span class=\"hljs-comment\"># Main role</span>\n  <span class=\"hljs-attr\">roles:</span>\n    <span class=\"hljs-bullet\">-</span> { <span class=\"hljs-attr\">role:</span> <span class=\"hljs-string\">vertx-app-deployment</span>, <span class=\"hljs-attr\">jenkins_job_workspace:</span> <span class=\"hljs-string\">&quot;<span class=\"hljs-template-variable\">{{ lookup(&#x27;env&#x27;, &#x27;WORKSPACE&#x27;) }}</span>&quot;</span> }\n\n  <span class=\"hljs-attr\">post_tasks:</span>\n  <span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">List</span> <span class=\"hljs-string\">again</span> <span class=\"hljs-string\">running</span> <span class=\"hljs-string\">Vert.x</span> <span class=\"hljs-string\">applications</span>\n    <span class=\"hljs-attr\">command:</span> <span class=\"hljs-string\">java</span> <span class=\"hljs-string\">-jar</span> <span class=\"hljs-string\">/usr/share/vertx_app/app-fatjar.jar</span> <span class=\"hljs-string\">list</span>\n</code></pre><p>Once we took care of the ac­tions shown be­fore, the re­main­ing tasks (in­cluded in the main de­ploy­ment role) re­duce to the fol­low­ing:</p><p>1) Pre­pare the tar­get ma­chine with the proper en­vi­ron­ment to run our ap­pli­ca­tion. This in­cludes:</p><ul><li>Set up Java (pretty con­ve­nient to do it through a pack­age man­ager).</li><li>Copy the Vert.x ap­pli­ca­tion pack­age to the ap­pro­pri­ate folder (quite sim­ple using a fat jar). The ac­tual name and lo­ca­tion of the jar pack­age in the Jenk­ins en­vi­ron­ment can be de­fined using host-​specific <a href=\"http://docs.ansible.com/ansible/playbooks_delegation.html\">vari­ables</a>.</li><li>In case nec­es­sary, copy the re­quired con­fig files.</li></ul><pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Install</span> <span class=\"hljs-string\">Java</span> <span class=\"hljs-number\">1.8</span> <span class=\"hljs-string\">and</span> <span class=\"hljs-string\">some</span> <span class=\"hljs-string\">basic</span> <span class=\"hljs-string\">dependencies</span>\n  <span class=\"hljs-attr\">yum:</span> <span class=\"hljs-string\">name={%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%}{{</span> <span class=\"hljs-string\">item</span> <span class=\"hljs-string\">}}{%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%}</span> <span class=\"hljs-string\">state=present</span>\n  <span class=\"hljs-attr\">with_items:</span>\n   <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">java-1.8.0-openjdk</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ensure</span> <span class=\"hljs-string\">app</span> <span class=\"hljs-string\">dir</span> <span class=\"hljs-string\">exists</span>\n  <span class=\"hljs-attr\">file:</span> <span class=\"hljs-string\">path=/usr/share/vertx_app/</span> <span class=\"hljs-string\">recurse=yes</span> <span class=\"hljs-string\">state=directory</span> <span class=\"hljs-string\">mode=0744</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Copy</span> <span class=\"hljs-string\">the</span> <span class=\"hljs-string\">Vert.x</span> <span class=\"hljs-string\">application</span> <span class=\"hljs-string\">jar</span> <span class=\"hljs-string\">package</span>\n  <span class=\"hljs-attr\">copy:</span> <span class=\"hljs-string\">src={%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%}{{</span> <span class=\"hljs-string\">app_jar</span> <span class=\"hljs-string\">}}{%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%}</span> <span class=\"hljs-string\">dest=/usr/share/vertx_app/app-fatjar.jar</span> <span class=\"hljs-string\">mode=0755</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Ensure</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">dir</span> <span class=\"hljs-string\">exists</span>\n  <span class=\"hljs-attr\">file:</span> <span class=\"hljs-string\">path=/etc/vertx_app/</span> <span class=\"hljs-string\">recurse=yes</span> <span class=\"hljs-string\">state=directory</span> <span class=\"hljs-string\">mode=0744</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Copy</span> <span class=\"hljs-string\">the</span> <span class=\"hljs-string\">application</span> <span class=\"hljs-string\">config</span> <span class=\"hljs-string\">file</span> <span class=\"hljs-string\">if</span> <span class=\"hljs-string\">needed</span>\n  <span class=\"hljs-attr\">copy:</span> <span class=\"hljs-string\">src={%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%}{{</span> <span class=\"hljs-string\">app_config</span> <span class=\"hljs-string\">}}{%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%}</span> <span class=\"hljs-string\">dest=/etc/vertx_app/config.json</span> <span class=\"hljs-string\">mode=0755</span>\n  <span class=\"hljs-attr\">when:</span> <span class=\"hljs-string\">app_config</span> <span class=\"hljs-string\">is</span> <span class=\"hljs-string\">defined</span>\n</code></pre><p>2) Run the ap­pli­ca­tion as a ser­vice in the host­ing ma­chine.</p><ul><li>Make sure to ig­nore the hang up sig­nal with the help of <code>nohup</code> com­mand. Oth­er­wise, An­si­ble will be stuck at this step.</li></ul><pre><code class=\"hljs language-yaml\"><span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Run</span> <span class=\"hljs-string\">Vert.x</span> <span class=\"hljs-string\">application</span> <span class=\"hljs-string\">as</span> <span class=\"hljs-string\">a</span> <span class=\"hljs-string\">service,</span> <span class=\"hljs-string\">ignore</span> <span class=\"hljs-string\">the</span> <span class=\"hljs-string\">SIGHUP</span> <span class=\"hljs-string\">signal</span>\n  <span class=\"hljs-attr\">shell:</span> <span class=\"hljs-string\">nohup</span> <span class=\"hljs-string\">java</span> {<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%</span>}{{ <span class=\"hljs-string\">vertx_opts</span> }}{<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%</span>} <span class=\"hljs-string\">-jar</span> <span class=\"hljs-string\">/usr/share/vertx_app/app-fatjar.jar</span> <span class=\"hljs-string\">start</span> {<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">raw</span> <span class=\"hljs-string\">%</span>}{{ <span class=\"hljs-string\">launch_params</span> }}{<span class=\"hljs-string\">%</span> <span class=\"hljs-string\">endraw</span> <span class=\"hljs-string\">%</span>}\n  <span class=\"hljs-attr\">register:</span> <span class=\"hljs-string\">svc_run_out</span>\n<span class=\"hljs-bullet\">-</span> <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">Print</span> <span class=\"hljs-string\">run</span> <span class=\"hljs-string\">output</span>\n  <span class=\"hljs-attr\">debug:</span> <span class=\"hljs-string\">var=svc_run_out.stdout_lines</span>\n</code></pre><div class=\"alert info\"><div class=\"alert-title\">Launching the Vert.x app</div><p>This ex­am­ple uses the <code>start</code> com­mand to launch the ap­pli­ca­tion as a ser­vice. This method may re­sult more com­fort­able than cre­at­ing an <a href=\"http://vertx.io/blog/vert-x-3-init-d-script/\">init.d script</a> or call­ing Vert.x from <a href=\"https://github.com/vert-x3/vertx-examples/#running-at-the-command-line\">com­mand line</a>, which would have re­quired to in­stall the Vert.x li­braries in an in­de­pen­dent An­si­ble task.</p></div><p>This de­scribes all the con­fig­u­ra­tion needed to be able to build from a repos­i­tory using Jenk­ins and de­ploy the re­sults to our hosts with An­si­ble.</p><h2 id=\"sample-sources-and-demo\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#sample-sources-and-demo\"></a>Sample sources and demo</h2><p>The sam­ple con­fig­u­ra­tions pre­sented be­fore are part of a com­plete demo fo­cused on the Vert.x mi­croser­vices <a href=\"http://vertx-lab.dynamis-technologies.com/\">work­shop</a> to ex­em­plify a basic Con­tin­u­ous De­liv­ery sce­nario. This set up is avail­able in a <a href=\"https://github.com/ricardohmon/vertx-ansible\">repos­i­tory</a> and con­tains, in ad­di­tion, a pre-​configured Jenkins-​based demo ready to host the build job de­scribed the pre­vi­ous sec­tions. The demo sce­nario re­quires Va­grant and Vir­tu­al­box to be launched.</p><h3 id=\"launch-instructions\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#launch-instructions\"></a>Launch instructions</h3><ul><li>Clone or down­load this repos­i­tory, and launch the demo using <code>vagrant up</code></li></ul><pre><code class=\"hljs language-awk\">git clone https:<span class=\"hljs-regexp\">//gi</span>thub.com<span class=\"hljs-regexp\">/ricardohmon/</span>vertx-ansible.git\ncd demo\nvagrant up\n</code></pre><p>This com­mand will launch a vir­tual ma­chine host­ing Jenk­ins with the re­quired plu­g­ins in­stalled (tools names needed) and also launch five ad­di­tional VMs that will host the mi­croser­vices de­ployed by Jenk­ins.</p><ul><li>Cre­ate a Jenk­ins freestyle build job using the DSL job script (seed job) found in <code>deployment-jobs/microservices_workshop_dsl.groovy</code> and build it.</li></ul><div class=\"alert info\"><div class=\"alert-title\">Tool configuration assumption</div><p>The DSL Job as­sumes the fol­low­ing tools (with names) have been con­fig­ured in Jenk­ins: Java 8 (<code>JDK8</code>), Maven (<code>M3.3.9</code>), An­si­ble (<code>Ansible2.0</code>)</p></div><ul><li>After build­ing the seed job, a new job (<code>vertx-microservices-workshop-job</code>) will be cre­ated, which will be in charge of pulling re­cent changes of the project, build­ing it, and de­ploy­ing it.</li></ul><h3 id=\"demo\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#demo\"></a>Demo</h3><p>Watch the pre­vi­ous demo in ac­tion in the fol­low­ing screen­cast:</p><div class=\"youtube-embed\"><iframe src=\"https://www.youtube.com/embed/GQd_Rfeu6Yo\" frameBorder=\"0\" allowfullscreen=\"\"></iframe></div><h2 id=\"conclusion\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"></a>Conclusion</h2><p>Con­tin­u­ous De­liv­ery ap­proach is a <em>must</em> in mod­ern soft­ware de­vel­op­ment life­cy­cles (in­clud­ing Vert.x-​based ap­pli­ca­tions) and a step fur­ther to­wards adopt­ing a De­vOps cul­ture. There are a num­ber of tools that en­able it and one ex­am­ple is the com­bi­na­tion of Jenk­ins + An­si­ble de­scribed in this post.<br/>\n<!-- -->While Jenk­ins of­fers the pos­si­bil­ity to in­te­grate re­cent changes per­ceived in a code­base and build runnable ar­ti­facts, An­si­ble can help to de­ploy them to host­ing en­vi­ron­ments. The usage of both tools can be cou­pled eas­ily with the help of the Job DSL plug­in, a fea­ture of Jenk­ins that al­lows de­scrib­ing a build job using a <em>domain-​specific lan­guage</em>, which can help to in­te­grate ad­di­tional steps and tools to a <em>CD</em> pipeline.</p><p>Fur­ther en­hance­ments can be done to this basic pipeline, such as, in­te­grat­ing the re­cent <a href=\"https://wiki.jenkins-ci.org/display/JENKINS/Pipeline+Plugin\">Pipeline plugin</a>, a fea­ture that al­lows a bet­ter or­ches­tra­tion of CD stages; in­clu­sion of no­ti­fi­ca­tion and alert­ing ser­vices; and, ul­ti­mately a zero-​downtime de­ploy­ment ap­proach, which could be achieved with the help of a proxy; plus, tons of op­tions avail­able trough Jenk­ins plu­g­ins.</p><p>Thanks for read­ing!</p>","scope":{}},"tfIdfTerms":[{"term":"job","tf":24},{"term":"jenkin","tf":21},{"term":"ansibl","tf":21},{"term":"applic","tf":19},{"term":"us","tf":19},{"term":"host","tf":19},{"term":"build","tf":16},{"term":"will","tf":11},{"term":"help","tf":10},{"term":"configur","tf":10},{"term":"deploi","tf":10},{"term":"dsl","tf":9},{"term":"deploy","tf":9},{"term":"describ","tf":8},{"term":"plugin","tf":8},{"term":"tool","tf":8},{"term":"environ","tf":7},{"term":"creat","tf":7},{"term":"result","tf":7},{"term":"demo","tf":7},{"term":"continu","tf":6},{"term":"new","tf":6},{"term":"follow","tf":6},{"term":"defin","tf":6},{"term":"playbook","tf":6}]},{"filename":"blog/2016-09-08-centralized-logging-for-vert-x-applications-using-the-elk-stack.mdx","date":"2016-09-08","slug":"centralized-logging-for-vert-x-applications-using-the-elk-stack","meta":{"title":"Centralized logging for Vert.x applications using the ELK stack","category":"guides","authors":[{"name":"Ricardo Hernandez","github_id":"ricardohmon"}],"summary":"This post entry describes a solution to achieve centralized logging of Vert.x applications using the ELK stack (Logstash, Elasticsearch, and Kibana)."},"readingTime":{"text":"11 min read","minutes":10.45,"time":627000,"words":2090},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"This post entry de\\xADscribes a so\\xADlu\\xADtion to achieve cen\\xADtral\\xADized log\\xADging of Vert.x ap\\xADpli\\xADca\\xADtions using the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.elastic.co/webinars/introduction-elk-stack\"\n  }), \"ELK stack\"), \", a set of tools in\\xADclud\\xADing Logstash, Elas\\xADtic\\xADsearch, and Kibana that are well known to work to\\xADgether seam\\xADlessly.\"), mdx(\"h2\", {\n    \"id\": \"preamble\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#preamble\"\n  })), \"Preamble\"), mdx(\"p\", null, \"This post was writ\\xADten in con\\xADtext of the project ti\\xADtled \\u201C\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://summerofcode.withgoogle.com/projects/#4858492141699072\"\n  }), \"De\\xADvOps tool\\xADing for Vert.x ap\\xADpli\\xADca\\xADtions\"), \"\\u201D, one of the Vert.x projects tak\\xADing place dur\\xADing the 2016 edi\\xADtion of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://summerofcode.withgoogle.com/about/\"\n  }), \"Google Sum\\xADmer of Code\"), \", a pro\\xADgram that aims to bring to\\xADgether stu\\xADdents with open source or\\xADga\\xADni\\xADza\\xADtions, in order to help them to gain ex\\xADpo\\xADsure to soft\\xADware de\\xADvel\\xADop\\xADment prac\\xADtices and real-\\u200Bworld chal\\xADlenges.\"), mdx(\"h2\", {\n    \"id\": \"introduction\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#introduction\"\n  })), \"Introduction\"), mdx(\"p\", null, \"Cen\\xADtral\\xADized log\\xADging is an im\\xADpor\\xADtant topic while build\\xADing a Mi\\xADcroser\\xADvices ar\\xADchi\\xADtec\\xADture and it is a step for\\xADward to adopt\\xADing the De\\xADvOps cul\\xADture. Hav\\xADing an over\\xADall so\\xADlu\\xADtion par\\xADti\\xADtioned into a set of ser\\xADvices dis\\xADtrib\\xADuted across the In\\xADter\\xADnet can rep\\xADre\\xADsent a chal\\xADlenge when try\\xADing to mon\\xADi\\xADtor the log out\\xADput of each of them, hence, a tool that helps to ac\\xADcom\\xADplish this re\\xADsults very help\\xADful.\"), mdx(\"h2\", {\n    \"id\": \"overview\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#overview\"\n  })), \"Overview\"), mdx(\"p\", null, \"As shown in the di\\xADa\\xADgram below, the gen\\xADeral cen\\xADtral\\xADized log\\xADging so\\xADlu\\xADtion com\\xADprises two main el\\xADe\\xADments: the ap\\xADpli\\xADca\\xADtion server, which runs our Vert.x ap\\xADpli\\xADca\\xADtion; and a sep\\xADa\\xADrate server, host\\xADing the ELK stack. Both el\\xADe\\xADments are linked by File\\xADbeat, a highly con\\xADfig\\xADurable tool ca\\xADpa\\xADble of ship\\xADping our ap\\xADpli\\xADca\\xADtion logs to the Logstash in\\xADstance, i.e., our gate\\xADway to the ELK stack.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/centralized-logging-using-elk/elk-overview.svg\",\n    \"alt\": \"Overview of centralized logging with ELK\"\n  }))), mdx(\"h2\", {\n    \"id\": \"app-logging-configuration\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#app-logging-configuration\"\n  })), \"App logging configuration\"), mdx(\"p\", null, \"The ap\\xADproach de\\xADscribed here is based on a File\\xADbeat + Logstash con\\xADfig\\xADu\\xADra\\xADtion, that means first we need to make sure our app logs to a file, whose records will be shipped to Logstash by File\\xADbeat. Luck\\xADily, Vert.x pro\\xADvides the means to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://vertx.io/docs/vertx-core/java/#_logging\"\n  }), \"con\\xADfig\\xADure\"), \" al\\xADter\\xADna\\xADtive log\\xADging frame\\xADworks (e.g., Log4j, Log4j2 and SLF4J) be\\xADsides the de\\xADfault JUL log\\xADging. How\\xADever, we can use File\\xADbeat in\\xADde\\xADpen\\xADdently of the log\\xADging frame\\xADwork cho\\xADsen.\"), mdx(\"h3\", {\n    \"id\": \"log4j-logging\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#log4j-logging\"\n  })), \"Log4j Logging\"), mdx(\"p\", null, \"The demo that ac\\xADcom\\xADpa\\xADnies this post re\\xADlies on Log4j2 as the log\\xADging frame\\xADwork. We in\\xADstructed Vert.x to use this frame\\xADwork fol\\xADlow\\xADing the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://vertx.io/docs/vertx-core/java/#_logging\"\n  }), \"guide\\xADlines\"), \" and we made sure our log\\xADging calls are made asyn\\xADchro\\xADnous, since we don\\u2019t want them to block our ap\\xADpli\\xADca\\xADtion. For this pur\\xADpose, we opted for the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"AsyncAppender\"), \" and this was in\\xADcluded in the Log4J con\\xADfig\\xADu\\xADra\\xADtion to\\xADgether with the log out\\xADput for\\xADmat de\\xADscribed in a XML con\\xADfig\\xADu\\xADra\\xADtion avail\\xADable in the ap\\xADpli\\xADca\\xADtion\\u2019s \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Re\\xADsource\"), \" folder.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-xml\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Configuration\"), \">\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Appenders\"), \">\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"RollingFile\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx_logs\\\"\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"append\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"true\\\"\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"fileName\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/var/log/vertx.log\\\"\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"filePattern\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/var/log/vertx/$${date:yyyy-MM}/vertx-%d{MM-dd-yyyy}-%i.log.gz\\\"\"), \">\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"PatternLayout\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"pattern\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"%d{ISO8601} %-5p %c:%L - %m%n\\\"\"), \" />\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"RollingFile\"), \">\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Async\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"name\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx_async\\\"\"), \">\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"AppenderRef\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"ref\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx_logs\\\"\"), \"/>\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Async\"), \">\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Appenders\"), \">\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Loggers\"), \">\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Root\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"level\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"DEBUG\\\"\"), \">\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"<\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"AppenderRef\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"ref\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx_async\\\"\"), \" />\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Root\"), \">\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Loggers\"), \">\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"</\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"Configuration\"), \">\"), \"\\n\")), mdx(\"h3\", {\n    \"id\": \"filebeat-configuration\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#filebeat-configuration\"\n  })), \"Filebeat configuration\"), mdx(\"p\", null, \"Now that we have con\\xADfig\\xADured the log out\\xADput of our Vert.x ap\\xADpli\\xADca\\xADtion to be stored in the file sys\\xADtem, we del\\xADe\\xADgate to File\\xADbeat the task of for\\xADward\\xADing the logs to the Logstash in\\xADstance. File\\xADbeat can be con\\xADfig\\xADured through a YAML file con\\xADtain\\xADing the logs out\\xADput lo\\xADca\\xADtion and the pat\\xADtern to in\\xADter\\xADpret mul\\xADti\\xADline logs (i.e., stack traces). Also, the Logstash out\\xADput plug\\xADin is con\\xADfig\\xADured with the host lo\\xADca\\xADtion and a se\\xADcure con\\xADnec\\xADtion is en\\xADforced using the cer\\xADtifi\\xADcate from the ma\\xADchine host\\xADing Logstash. We set the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"document_type\"), \" to the type of in\\xADstance that this log be\\xADlongs to, which could later help us while in\\xADdex\\xADing our logs in\\xADside Elas\\xADtic\\xADsearch.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-yaml\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"filebeat:\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"prospectors:\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"document_type:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"trader_dashboard\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"paths:\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/var/log/vertx.log\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"multiline:\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"pattern:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"^[0-9]+\\\"\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"negate:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"match:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"after\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"output:\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"logstash:\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"enabled:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"hosts:\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"elk:5044\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"timeout:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"15\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"tls:\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"insecure:\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"certificate_authoritites:\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-bullet\"\n  }), \"-\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"/etc/pki/tls/certs/logstash-beats.crt\"), \"\\n\")), mdx(\"h2\", {\n    \"id\": \"elk-configuration\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#elk-configuration\"\n  })), \"ELK configuration\"), mdx(\"p\", null, \"To take fully ad\\xADvan\\xADtage of the ELK stack with re\\xADspect to Vert.x and our app logs, we need to con\\xADfig\\xADure each of its in\\xADdi\\xADvid\\xADual com\\xADpo\\xADnents, namely Logstash, Elas\\xADtic\\xADsearch and Kibana.\"), mdx(\"h3\", {\n    \"id\": \"logstash\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#logstash\"\n  })), \"Logstash\"), mdx(\"p\", null, \"Logstash is the com\\xADpo\\xADnent within the ELK stack that is in charge of ag\\xADgre\\xADgat\\xADing the logs from each of the sources and for\\xADward\\xADing them to the Elas\\xADtic\\xADsearch in\\xADstance.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Con\\xADfig\\xADur\\xADing Logstash is straight\\xADfor\\xADward with the help of the spe\\xADcific input and out\\xADput plu\\xADg\\xADins for Beats and Elas\\xADtic\\xADsearch, re\\xADspec\\xADtively.\\nIn the pre\\xADvi\\xADous sec\\xADtion we men\\xADtioned that File\\xADbeat could be eas\\xADily cou\\xADpled with Logstash. Now, we see that this can be done by just spec\\xADi\\xADfy\\xADing \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Beat\"), \" as the input plug\\xADin and set the pa\\xADra\\xADme\\xADters needed to be reached by our ship\\xADpers (lis\\xADten\\xADing port, ssl key and cer\\xADtifi\\xADcate lo\\xADca\\xADtion).\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"input {\\n  beats {\\n    port => 5044\\n    ssl => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \"\\n    ssl_certificate => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/etc/pki/tls/certs/logstash-beats.crt\\\"\"), \"\\n    ssl_key => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/etc/pki/tls/private/logstash-beats.key\\\"\"), \"\\n  }\\n}\\n\")), mdx(\"p\", null, \"Now that we are ready to re\\xADceive logs from the app, we can use Logstash fil\\xADter\\xADing ca\\xADpa\\xADbil\\xADi\\xADties to spec\\xADify the for\\xADmat of our logs and ex\\xADtract the fields so they can be in\\xADdexed more ef\\xADfi\\xADciently by Elas\\xADtic\\xADsearch.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"grok\"), \" fil\\xADter\\xADing plug\\xADin comes handy in this sit\\xADu\\xADa\\xADtion. This plug\\xADin al\\xADlows to de\\xADclare the logs for\\xADmat using pre\\xADde\\xADfined and cus\\xADtomized pat\\xADterns based in reg\\xADu\\xADlar ex\\xADpres\\xADsions al\\xADlow\\xADing to de\\xADclare new fields from the in\\xADfor\\xADma\\xADtion ex\\xADtracted from each log line. In the fol\\xADlow\\xADing block, we in\\xADstruct Logstash to rec\\xADog\\xADnize our Log4j pat\\xADtern in\\xADside a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"message\"), \" field, which con\\xADtains the log mes\\xADsage shipped by File\\xADbeat. After that, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"date\"), \" fil\\xADter\\xADing plug\\xADin parses the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"timestamp\"), \" field ex\\xADtracted in the pre\\xADvi\\xADous step and re\\xADplaces it for the one set by File\\xADbeat after read\\xADing the log out\\xADput file.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"filter {\\n  grok {\\n    break_on_match => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \"\\n    match =>  [ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"message\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"%{LOG4J}\\\"\"), \"]\\n  }\\n  date{\\n    match => [ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"timestamp_string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"ISO8601\\\"\"), \"]\\n    remove_field => [ \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"timestamp_string\\\"\"), \" ]\\n  }\\n}\\n\")), mdx(\"p\", null, \"The Log4j pat\\xADtern is not in\\xADcluded within the Logstash con\\xADfig\\xADu\\xADra\\xADtion, how\\xADever, we can spec\\xADify it using pre\\xADde\\xADfined data for\\xADmats shipped with Logstash and adapt it to the spe\\xADcific log for\\xADmats re\\xADquired in our ap\\xADpli\\xADca\\xADtion, as shown next.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-ruby\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"# Pattern to match our Log4j format\"), \"\\nSPACING (?\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-symbol\"\n  }), \":\"), \"[\\\\s]+)\\nLOGGER (?\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-symbol\"\n  }), \":\"), \"[a-zA-Z$_][a-zA-Z$_0-\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"9\"), \"]*\\\\.)*[a-zA-Z$_][a-zA-Z$_0-\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"9\"), \"]*\\nLINE \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{INT}\"), \"?\\nLOG4J \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{TIMESTAMP_ISO8601:timestamp_string}\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{LOGLEVEL:log_level}\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{SPACING}\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{LOGGER:logger_name}\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-symbol\"\n  }), \":\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{LINE:loc_line}\")), \" - \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"%{JAVALOGMESSAGE:log_message}\"), \"\\n\")), mdx(\"p\", null, \"Fi\\xADnally, we take a look at Logstash\\u2019s out\\xADput con\\xADfig\\xADu\\xADra\\xADtion. This sim\\xADply points to our elas\\xADtic\\xADsearch in\\xADstance, in\\xADstructs it to pro\\xADvide a list of all clus\\xADter nodes (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"sniffing\"), \"), de\\xADfines the name pat\\xADtern for our in\\xADdices, as\\xADsigns the doc\\xADu\\xADment type ac\\xADcord\\xADing to the meta\\xADdata com\\xADing from File\\xADbeat, and al\\xADlows to de\\xADfine a cus\\xADtom index tem\\xADplate for our data.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-puppet\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"output\"), \" {\\n  elasticsearch {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"hosts\"), \" => [\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"localhost\\\"\"), \"]\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"sniffing\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"true\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"manage_template\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"true\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"index\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"%{[@metadata][beat]}-%{+YYYY.MM.dd}\\\"\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"document_type\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"%{[@metadata][type]}\\\"\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"template\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/etc/filebeat/vertx_app_filebeat.json\\\"\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"template_overwrite\"), \" => \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"true\"), \"\\n  }\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"elasticsearch\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#elasticsearch\"\n  })), \"Elasticsearch\"), mdx(\"p\", null, \"Elas\\xADtic\\xADsearch is the cen\\xADtral com\\xADpo\\xADnent that en\\xADables the ef\\xADfi\\xADcient in\\xADdex\\xADing and real-\\u200Btime search ca\\xADpa\\xADbil\\xADi\\xADties of the stack. To take the most ad\\xADvan\\xADtage of Elas\\xADtic\\xADsearch, we can pro\\xADvide an in\\xADdex\\xADing tem\\xADplate of our in\\xADcom\\xADing logs, which can help to op\\xADti\\xADmize the data stor\\xADage and match the queries is\\xADsued by Kibana at a later point.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"In the ex\\xADam\\xADple below, we see an index tem\\xADplate that would be ap\\xADplied to any index match\\xADing the pat\\xADtern \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"filebeat-*\"), \". Ad\\xADdi\\xADtion\\xADally, we de\\xADclare our new log fields \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"type\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"host\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"log_level\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"logger_name\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"log_message\"), \", which are set as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"not_analyzed\"), \" ex\\xADcept for the last two that are set as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"analyzed\"), \" al\\xADlow\\xADing to per\\xADform queries based on reg\\xADu\\xADlar ex\\xADpres\\xADsions and not re\\xADstricted to query the full text.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"mappings\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"_default_\\\"\"), \": {\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"_all\\\"\"), \": {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"enabled\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \",\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"norms\\\"\"), \": {\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"enabled\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \"\\n        }\\n      },\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"dynamic_templates\\\"\"), \": [\\n        {\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"template1\\\"\"), \": {\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"mapping\\\"\"), \": {\\n              \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"doc_values\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \",\\n              \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"ignore_above\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1024\"), \",\\n              \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"not_analyzed\\\"\"), \",\\n              \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"{dynamic_type}\\\"\"), \"\\n            },\\n            \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"match\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"*\\\"\"), \"\\n          }\\n        }\\n      ],\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"properties\\\"\"), \": {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"@timestamp\\\"\"), \": {\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"date\\\"\"), \"\\n        },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"offset\\\"\"), \": {\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"long\\\"\"), \",\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"doc_values\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"true\\\"\"), \"\\n        },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"not_analyzed\\\"\"), \" },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"host\\\"\"), \": { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"not_analyzed\\\"\"), \" },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"log_level\\\"\"), \": { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"not_analyzed\\\"\"), \" },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"logger_name\\\"\"), \": { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"analyzed\\\"\"), \" },\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"log_message\\\"\"), \": { \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"type\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"string\\\"\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"analyzed\\\"\"), \" }\\n      }\\n    }\\n  },\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"settings\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"index.refresh_interval\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"5s\\\"\"), \"\\n  },\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"template\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"filebeat-*\\\"\"), \"\\n}\\n\")), mdx(\"h3\", {\n    \"id\": \"kibana\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#kibana\"\n  })), \"Kibana\"), mdx(\"p\", null, \"Al\\xADthough we could fetch all our logs from Elas\\xADtic\\xADsearch through its API, Kibana is a pow\\xADer\\xADful tool that al\\xADlows a more friendly query and vi\\xADsu\\xADal\\xADiza\\xADtion.\\nBe\\xADsides the op\\xADtion to query our data through the avail\\xADable in\\xADdexed field names and search boxes al\\xADlow\\xADing typ\\xADing spe\\xADcific queries, Kibana al\\xADlows cre\\xADat\\xADing our own \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Vi\\xADsu\\xADal\\xADiza\\xADtions\"), \" and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Dash\\xADboards\"), \". Com\\xADbined, they rep\\xADre\\xADsent a pow\\xADer\\xADful way to dis\\xADplay data and gain in\\xADsight in a cus\\xADtomized man\\xADner.\\nThe ac\\xADcom\\xADpa\\xADnied demo ships with a cou\\xADple of sam\\xADple dash\\xADboards and vi\\xADsu\\xADal\\xADiza\\xADtions that take ad\\xADvan\\xADtage of the log fields that we spec\\xADi\\xADfied in our index tem\\xADplate and throw valu\\xADable in\\xADsight. This in\\xADcludes: vi\\xADsu\\xADal\\xADiz\\xADing the num\\xADber of log mes\\xADsages re\\xADceived by ELK, ob\\xADserve the pro\\xADpor\\xADtion of mes\\xADsages that each log source pro\\xADduces, and di\\xADrectly find out the sources of error logs.\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/centralized-logging-using-elk/kibana-dashboard.png\",\n    \"alt\": \"Kibana Dashboard\\\" width=\\\"550\"\n  }))), mdx(\"h2\", {\n    \"id\": \"log-shipping-challenge\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#log-shipping-challenge\"\n  })), \"Log shipping challenge\"), mdx(\"p\", null, \"The so\\xADlu\\xADtion pre\\xADsented here re\\xADlied on File\\xADbeat to ship log data to Logstash. How\\xADever, if you are fa\\xADmil\\xADiar with the Log4j frame\\xADwork you may be aware that there ex\\xADists a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Sock\\xADe\\xADtAp\\xADpen\\xADder\"), \" that al\\xADlows to write log events di\\xADrectly to a re\\xADmote server using a TCP con\\xADnec\\xADtion. Al\\xADthough in\\xADclud\\xADing the File\\xADbeat + Logstash com\\xADbi\\xADna\\xADtion  may sound an un\\xADnec\\xADes\\xADsary over\\xADhead to the log\\xADging pipeline, they pro\\xADvide a num\\xADber of ben\\xADe\\xADfits in com\\xADpar\\xADi\\xADson to the Log4j socket al\\xADter\\xADna\\xADtive:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"The Sock\\xADe\\xADtAp\\xADpen\\xADder re\\xADlies on the spe\\xADcific se\\xADri\\xADal\\xADiza\\xADtion of Log4j\\u2019s \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"Lo\\xADgEvent\"), \" ob\\xADjects, which is no an in\\xADter\\xADchange\\xADable for\\xADmat as JSON, which is used by the Beats so\\xADlu\\xADtion. Al\\xADthough there are \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/majikthys/log4j2-logstash-jsonevent-layout\"\n  }), \"at\\xADtempts\"), \" to out\\xADput the logs in a JSON for\\xADmat for Logstash, it doesn\\u2019t sup\\xADport mul\\xADti\\xADline logs, which re\\xADsults in mes\\xADsages being split into dif\\xADfer\\xADent events by Logstash. On the other hand, there is no of\\xADfi\\xADcial nor sta\\xADble \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://www.elastic.co/guide/en/logstash/current/input-plugins.html\"\n  }), \"input plugin\"), \" for Log4j ver\\xADsion 2.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"While en\\xADabling Log4j\\u2019s async log\\xADging mode in an ap\\xADpli\\xADca\\xADtion del\\xADe\\xADgates log\\xADging op\\xADer\\xADa\\xADtions to sep\\xADa\\xADrate threads, given their co\\xADex\\xADis\\xADtence in the same JVM there is still the risk of data loss in case of a sud\\xADden JVM ter\\xADmi\\xADna\\xADtion with\\xADout proper log chan\\xADnel clos\\xADing.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"File\\xADbeat is a data ship\\xADper de\\xADsigned to deal with many con\\xADstraints that arise in dis\\xADtrib\\xADuted en\\xADvi\\xADron\\xADments in a re\\xADli\\xADable man\\xADner, there\\xADfore it pro\\xADvides op\\xADtions to tai\\xADlor and scale this op\\xADer\\xADa\\xADtion to our needs: the pos\\xADsi\\xADbil\\xADity to load bal\\xADance be\\xADtween mul\\xADti\\xADple Logstash in\\xADstances, spec\\xADify the num\\xADber of si\\xADmul\\xADta\\xADne\\xADous File\\xADbeat work\\xADers that ship log files, and spec\\xADify a com\\xADpres\\xADsion level in order to re\\xADduce the con\\xADsumed band\\xADwidth. Be\\xADsides that, logs can be shipped in spe\\xADcific batch sizes, with max\\xADi\\xADmum amount of re\\xADtries, and spec\\xADi\\xADfy\\xADing a con\\xADnec\\xADtion time\\xADout.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Lastly, al\\xADthough File\\xADbeat can for\\xADward logs di\\xADrectly to Elas\\xADtic\\xADsearch, using Logstash as an in\\xADter\\xADme\\xADdi\\xADary of\\xADfers the pos\\xADsi\\xADbil\\xADity to col\\xADlect logs from di\\xADverse sources (e.g., sys\\xADtem met\\xADrics).\")), mdx(\"h2\", {\n    \"id\": \"demo\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#demo\"\n  })), \"Demo\"), mdx(\"p\", null, \"This post is ac\\xADcom\\xADpa\\xADnied by a demo based on the Vert.x Mi\\xADcroser\\xADvices \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://vertx-lab.dynamis-technologies.com/\"\n  }), \"work\\xADshop\"), \", where each of them is shipped in a Docker con\\xADtainer sim\\xADu\\xADlat\\xADing a dis\\xADtrib\\xADuted sys\\xADtem com\\xADposed of in\\xADde\\xADpen\\xADdent ad\\xADdress\\xADable nodes.\", mdx(\"br\", {\n    parentName: \"p\"\n  }), \"\\n\", \"Also, the ELK stack is pro\\xADvi\\xADsioned using a pre\\xADcon\\xADfig\\xADured Docker image by \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/spujadas\"\n  }), \"S\\xE9bastien Pu\\xADjadas\"), \".\"), mdx(\"p\", null, \"Fol\\xADlow\\xADing the guide\\xADlines in this post, this demo con\\xADfig\\xADures each of the Mi\\xADcroser\\xADvices of the work\\xADshop, sets up a File\\xADbeat process on each of them to ship the logs to a cen\\xADtral con\\xADtainer host\\xADing the ELK stack.\"), mdx(\"h3\", {\n    \"id\": \"installation\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#installation\"\n  })), \"Installation\"), mdx(\"p\", null, \"In order to run this demo, it is nec\\xADes\\xADsary to have Docker in\\xADstalled, then pro\\xADceed with:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Cloning or down\\xADload\\xADing the demo \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/ricardohmon/vertx-elk\"\n  }), \"repos\\xADi\\xADtory\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Sep\\xADa\\xADrately, ob\\xADtain\\xADing the source code of the \", mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"https://github.com/ricardohmon/vertx-microservices-workshop/tree/elk-demo\"\n  }), \"branch\"), \" of the Mi\\xADcroser\\xADvices work\\xADshop adapted for this demo.\")), mdx(\"h3\", {\n    \"id\": \"building-the-example\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#building-the-example\"\n  })), \"Building the example\"), mdx(\"p\", null, \"The Docker im\\xADages be\\xADlong\\xADing to the Vert.x Mi\\xADcroser\\xADvices work\\xADshop need to be built sep\\xADa\\xADrately to this project be\\xADfore this project can be launched.\"), mdx(\"h3\", {\n    \"id\": \"building-the-vertx-microservices-workshop-docker-images\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#building-the-vertx-microservices-workshop-docker-images\"\n  })), \"Building the Vert.x Microservices workshop Docker images.\"), mdx(\"p\", null, \"Build the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"root\"), \" project and the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Trader Dash\\xADboard\"), \" fol\\xADlowed by each of the mod\\xADules con\\xADtained in the so\\xADlu\\xADtion folder. Issue the fol\\xADlow\\xADing com\\xADmands for this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"mvn clean install\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" trader-dashboard\\nmvn package docker:build\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" ../solution/audit-service\\nmvn package docker:build\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" ../compulsive-traders\\nmvn package docker:build\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" ../portfolio-service\\nmvn package docker:build\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"cd\"), \" ../quote-generator/\\nmvn package docker:build\\n\")), mdx(\"h3\", {\n    \"id\": \"running-the-example\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#running-the-example\"\n  })), \"Running the example\"), mdx(\"p\", null, \"After build\\xADing the pre\\xADvi\\xADous im\\xADages, build and run the ex\\xADam\\xADple in \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx-elk\"), \" using the fol\\xADlow\\xADing com\\xADmand:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-ebnf\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attribute\"\n  }), \"docker-compose up\"), \"\\n\")), mdx(\"h3\", {\n    \"id\": \"the-demo\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#the-demo\"\n  })), \"The demo\"), mdx(\"p\", null, \"You can watch the demo in ac\\xADtion in the fol\\xADlow\\xADing screen\\xADcast:\"), mdx(\"div\", {\n    className: \"youtube-embed\"\n  }, mdx(\"iframe\", {\n    src: \"https://www.youtube.com/embed/8P-MgXSujes\",\n    frameBorder: \"0\",\n    allowFullScreen: true\n  })), mdx(\"h2\", {\n    \"id\": \"conclusion\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#conclusion\"\n  })), \"Conclusion\"), mdx(\"p\", null, \"The ELK stack is a pow\\xADer\\xADful set of tools that ease the ag\\xADgre\\xADga\\xADtion of logs com\\xADing from dis\\xADtrib\\xADuted ser\\xADvices into a cen\\xADtral server. Its main pil\\xADlar, Elas\\xADtic\\xADsearch, pro\\xADvides the in\\xADdex\\xADing and search ca\\xADpa\\xADbil\\xADi\\xADties of our log data. Also, it is ac\\xADcom\\xADpa\\xADnied by the con\\xADve\\xADnient input/out\\xADput com\\xADpo\\xADnents: Logstash, which can be flex\\xADi\\xADbly con\\xADfig\\xADured to ac\\xADcept dif\\xADfer\\xADent data sources; and Kibana, which can be cus\\xADtomized to present the in\\xADfor\\xADma\\xADtion in the most con\\xADve\\xADnient way.\"), mdx(\"p\", null, \"Logstash has been de\\xADsigned to work seam\\xADlessly with File\\xADbeat, the log ship\\xADper which rep\\xADre\\xADsents a ro\\xADbust so\\xADlu\\xADtion that can be adapted to our ap\\xADpli\\xADca\\xADtions with\\xADout hav\\xADing to make \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"sig\\xADnif\\xADi\\xADcant\"), \" changes to our ar\\xADchi\\xADtec\\xADture. In ad\\xADdi\\xADtion, Logstash can ac\\xADcept var\\xADied types of sources, fil\\xADter the data, and process it be\\xADfore de\\xADliv\\xADer\\xADing to Elas\\xADtic\\xADsearch. This flex\\xADi\\xADbil\\xADity comes with the price of hav\\xADing extra el\\xADe\\xADments in our log ag\\xADgre\\xADga\\xADtion pipeline, which can rep\\xADre\\xADsent an in\\xADcrease of pro\\xADcess\\xADing over\\xADhead or a point-\\u200Bof-failure. This ad\\xADdi\\xADtional over\\xADhead could be avoided if an ap\\xADpli\\xADca\\xADtion would be ca\\xADpa\\xADble of de\\xADliv\\xADer\\xADing its log out\\xADput di\\xADrectly to Elas\\xADtic\\xADsearch.\"), mdx(\"p\", null, \"Happy log\\xADging!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>This post entry de­scribes a so­lu­tion to achieve cen­tral­ized log­ging of Vert.x ap­pli­ca­tions using the <a href=\"https://www.elastic.co/webinars/introduction-elk-stack\">ELK stack</a>, a set of tools in­clud­ing Logstash, Elas­tic­search, and Kibana that are well known to work to­gether seam­lessly.</p><h2 id=\"preamble\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#preamble\"></a>Preamble</h2><p>This post was writ­ten in con­text of the project ti­tled “<a href=\"https://summerofcode.withgoogle.com/projects/#4858492141699072\">De­vOps tool­ing for Vert.x ap­pli­ca­tions</a>”, one of the Vert.x projects tak­ing place dur­ing the 2016 edi­tion of <a href=\"https://summerofcode.withgoogle.com/about/\">Google Sum­mer of Code</a>, a pro­gram that aims to bring to­gether stu­dents with open source or­ga­ni­za­tions, in order to help them to gain ex­po­sure to soft­ware de­vel­op­ment prac­tices and real-​world chal­lenges.</p><h2 id=\"introduction\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#introduction\"></a>Introduction</h2><p>Cen­tral­ized log­ging is an im­por­tant topic while build­ing a Mi­croser­vices ar­chi­tec­ture and it is a step for­ward to adopt­ing the De­vOps cul­ture. Hav­ing an over­all so­lu­tion par­ti­tioned into a set of ser­vices dis­trib­uted across the In­ter­net can rep­re­sent a chal­lenge when try­ing to mon­i­tor the log out­put of each of them, hence, a tool that helps to ac­com­plish this re­sults very help­ful.</p><h2 id=\"overview\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#overview\"></a>Overview</h2><p>As shown in the di­a­gram below, the gen­eral cen­tral­ized log­ging so­lu­tion com­prises two main el­e­ments: the ap­pli­ca­tion server, which runs our Vert.x ap­pli­ca­tion; and a sep­a­rate server, host­ing the ELK stack. Both el­e­ments are linked by File­beat, a highly con­fig­urable tool ca­pa­ble of ship­ping our ap­pli­ca­tion logs to the Logstash in­stance, i.e., our gate­way to the ELK stack.</p><p><img src=\"/images/blog/centralized-logging-using-elk/elk-overview.svg\" alt=\"Overview of centralized logging with ELK\"/></p><h2 id=\"app-logging-configuration\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#app-logging-configuration\"></a>App logging configuration</h2><p>The ap­proach de­scribed here is based on a File­beat + Logstash con­fig­u­ra­tion, that means first we need to make sure our app logs to a file, whose records will be shipped to Logstash by File­beat. Luck­ily, Vert.x pro­vides the means to <a href=\"https://vertx.io/docs/vertx-core/java/#_logging\">con­fig­ure</a> al­ter­na­tive log­ging frame­works (e.g., Log4j, Log4j2 and SLF4J) be­sides the de­fault JUL log­ging. How­ever, we can use File­beat in­de­pen­dently of the log­ging frame­work cho­sen.</p><h3 id=\"log4j-logging\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#log4j-logging\"></a>Log4j Logging</h3><p>The demo that ac­com­pa­nies this post re­lies on Log4j2 as the log­ging frame­work. We in­structed Vert.x to use this frame­work fol­low­ing the <a href=\"https://vertx.io/docs/vertx-core/java/#_logging\">guide­lines</a> and we made sure our log­ging calls are made asyn­chro­nous, since we don’t want them to block our ap­pli­ca­tion. For this pur­pose, we opted for the <code>AsyncAppender</code> and this was in­cluded in the Log4J con­fig­u­ra­tion to­gether with the log out­put for­mat de­scribed in a XML con­fig­u­ra­tion avail­able in the ap­pli­ca­tion’s <em>Re­source</em> folder.</p><pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Configuration</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Appenders</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">RollingFile</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;vertx_logs&quot;</span> <span class=\"hljs-attr\">append</span>=<span class=\"hljs-string\">&quot;true&quot;</span> <span class=\"hljs-attr\">fileName</span>=<span class=\"hljs-string\">&quot;/var/log/vertx.log&quot;</span> <span class=\"hljs-attr\">filePattern</span>=<span class=\"hljs-string\">&quot;/var/log/vertx/$${date:yyyy-MM}/vertx-%d{MM-dd-yyyy}-%i.log.gz&quot;</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">PatternLayout</span> <span class=\"hljs-attr\">pattern</span>=<span class=\"hljs-string\">&quot;%d{ISO8601} %-5p %c:%L - %m%n&quot;</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">RollingFile</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Async</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">&quot;vertx_async&quot;</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">AppenderRef</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;vertx_logs&quot;</span>/&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Async</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Appenders</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Loggers</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Root</span> <span class=\"hljs-attr\">level</span>=<span class=\"hljs-string\">&quot;DEBUG&quot;</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">AppenderRef</span> <span class=\"hljs-attr\">ref</span>=<span class=\"hljs-string\">&quot;vertx_async&quot;</span> /&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Root</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Loggers</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Configuration</span>&gt;</span>\n</code></pre><h3 id=\"filebeat-configuration\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#filebeat-configuration\"></a>Filebeat configuration</h3><p>Now that we have con­fig­ured the log out­put of our Vert.x ap­pli­ca­tion to be stored in the file sys­tem, we del­e­gate to File­beat the task of for­ward­ing the logs to the Logstash in­stance. File­beat can be con­fig­ured through a YAML file con­tain­ing the logs out­put lo­ca­tion and the pat­tern to in­ter­pret mul­ti­line logs (i.e., stack traces). Also, the Logstash out­put plug­in is con­fig­ured with the host lo­ca­tion and a se­cure con­nec­tion is en­forced using the cer­tifi­cate from the ma­chine host­ing Logstash. We set the <code>document_type</code> to the type of in­stance that this log be­longs to, which could later help us while in­dex­ing our logs in­side Elas­tic­search.</p><pre><code class=\"hljs language-yaml\"><span class=\"hljs-attr\">filebeat:</span>\n  <span class=\"hljs-attr\">prospectors:</span>\n    <span class=\"hljs-bullet\">-</span>\n      <span class=\"hljs-attr\">document_type:</span> <span class=\"hljs-string\">trader_dashboard</span>\n      <span class=\"hljs-attr\">paths:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/var/log/vertx.log</span>\n      <span class=\"hljs-attr\">multiline:</span>\n        <span class=\"hljs-attr\">pattern:</span> <span class=\"hljs-string\">&quot;^[0-9]+&quot;</span>\n        <span class=\"hljs-attr\">negate:</span> <span class=\"hljs-literal\">true</span>\n        <span class=\"hljs-attr\">match:</span> <span class=\"hljs-string\">after</span>\n<span class=\"hljs-attr\">output:</span>\n  <span class=\"hljs-attr\">logstash:</span>\n    <span class=\"hljs-attr\">enabled:</span> <span class=\"hljs-literal\">true</span>\n    <span class=\"hljs-attr\">hosts:</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">elk:5044</span>\n    <span class=\"hljs-attr\">timeout:</span> <span class=\"hljs-number\">15</span>\n    <span class=\"hljs-attr\">tls:</span>\n      <span class=\"hljs-attr\">insecure:</span> <span class=\"hljs-literal\">false</span>\n      <span class=\"hljs-attr\">certificate_authoritites:</span>\n        <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/etc/pki/tls/certs/logstash-beats.crt</span>\n</code></pre><h2 id=\"elk-configuration\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#elk-configuration\"></a>ELK configuration</h2><p>To take fully ad­van­tage of the ELK stack with re­spect to Vert.x and our app logs, we need to con­fig­ure each of its in­di­vid­ual com­po­nents, namely Logstash, Elas­tic­search and Kibana.</p><h3 id=\"logstash\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#logstash\"></a>Logstash</h3><p>Logstash is the com­po­nent within the ELK stack that is in charge of ag­gre­gat­ing the logs from each of the sources and for­ward­ing them to the Elas­tic­search in­stance.<br/>\n<!-- -->Con­fig­ur­ing Logstash is straight­for­ward with the help of the spe­cific input and out­put plu­g­ins for Beats and Elas­tic­search, re­spec­tively.\nIn the pre­vi­ous sec­tion we men­tioned that File­beat could be eas­ily cou­pled with Logstash. Now, we see that this can be done by just spec­i­fy­ing <code>Beat</code> as the input plug­in and set the pa­ra­me­ters needed to be reached by our ship­pers (lis­ten­ing port, ssl key and cer­tifi­cate lo­ca­tion).</p><pre><code class=\"hljs language-bash\">input {\n  beats {\n    port =&gt; 5044\n    ssl =&gt; <span class=\"hljs-literal\">true</span>\n    ssl_certificate =&gt; <span class=\"hljs-string\">&quot;/etc/pki/tls/certs/logstash-beats.crt&quot;</span>\n    ssl_key =&gt; <span class=\"hljs-string\">&quot;/etc/pki/tls/private/logstash-beats.key&quot;</span>\n  }\n}\n</code></pre><p>Now that we are ready to re­ceive logs from the app, we can use Logstash fil­ter­ing ca­pa­bil­i­ties to spec­ify the for­mat of our logs and ex­tract the fields so they can be in­dexed more ef­fi­ciently by Elas­tic­search.<br/>\n<!-- -->The <code>grok</code> fil­ter­ing plug­in comes handy in this sit­u­a­tion. This plug­in al­lows to de­clare the logs for­mat using pre­de­fined and cus­tomized pat­terns based in reg­u­lar ex­pres­sions al­low­ing to de­clare new fields from the in­for­ma­tion ex­tracted from each log line. In the fol­low­ing block, we in­struct Logstash to rec­og­nize our Log4j pat­tern in­side a <code>message</code> field, which con­tains the log mes­sage shipped by File­beat. After that, the <code>date</code> fil­ter­ing plug­in parses the <code>timestamp</code> field ex­tracted in the pre­vi­ous step and re­places it for the one set by File­beat after read­ing the log out­put file.</p><pre><code class=\"hljs language-bash\">filter {\n  grok {\n    break_on_match =&gt; <span class=\"hljs-literal\">false</span>\n    match =&gt;  [ <span class=\"hljs-string\">&quot;message&quot;</span>, <span class=\"hljs-string\">&quot;%{LOG4J}&quot;</span>]\n  }\n  date{\n    match =&gt; [ <span class=\"hljs-string\">&quot;timestamp_string&quot;</span>, <span class=\"hljs-string\">&quot;ISO8601&quot;</span>]\n    remove_field =&gt; [ <span class=\"hljs-string\">&quot;timestamp_string&quot;</span> ]\n  }\n}\n</code></pre><p>The Log4j pat­tern is not in­cluded within the Logstash con­fig­u­ra­tion, how­ever, we can spec­ify it using pre­de­fined data for­mats shipped with Logstash and adapt it to the spe­cific log for­mats re­quired in our ap­pli­ca­tion, as shown next.</p><pre><code class=\"hljs language-ruby\"><span class=\"hljs-comment\"># Pattern to match our Log4j format</span>\nSPACING (?<span class=\"hljs-symbol\">:</span>[\\s]+)\nLOGGER (?<span class=\"hljs-symbol\">:</span>[a-zA-Z$_][a-zA-Z$_0-<span class=\"hljs-number\">9</span>]*\\.)*[a-zA-Z$_][a-zA-Z$_0-<span class=\"hljs-number\">9</span>]*\nLINE <span class=\"hljs-string\">%{INT}</span>?\nLOG4J <span class=\"hljs-string\">%{TIMESTAMP_ISO8601:timestamp_string}</span> <span class=\"hljs-string\">%{LOGLEVEL:log_level}</span><span class=\"hljs-string\">%{SPACING}</span><span class=\"hljs-string\">%{LOGGER:logger_name}</span><span class=\"hljs-symbol\">:<span class=\"hljs-string\">%{LINE:loc_line}</span></span> - <span class=\"hljs-string\">%{JAVALOGMESSAGE:log_message}</span>\n</code></pre><p>Fi­nally, we take a look at Logstash’s out­put con­fig­u­ra­tion. This sim­ply points to our elas­tic­search in­stance, in­structs it to pro­vide a list of all clus­ter nodes (<code>sniffing</code>), de­fines the name pat­tern for our in­dices, as­signs the doc­u­ment type ac­cord­ing to the meta­data com­ing from File­beat, and al­lows to de­fine a cus­tom index tem­plate for our data.</p><pre><code class=\"hljs language-puppet\"><span class=\"hljs-keyword\">output</span> {\n  elasticsearch {\n    <span class=\"hljs-attr\">hosts</span> =&gt; [<span class=\"hljs-string\">&quot;localhost&quot;</span>]\n    <span class=\"hljs-attr\">sniffing</span> =&gt; <span class=\"hljs-keyword\">true</span>\n    <span class=\"hljs-attr\">manage_template</span> =&gt; <span class=\"hljs-keyword\">true</span>\n    <span class=\"hljs-attr\">index</span> =&gt; <span class=\"hljs-string\">&quot;%{[@metadata][beat]}-%{+YYYY.MM.dd}&quot;</span>\n    <span class=\"hljs-attr\">document_type</span> =&gt; <span class=\"hljs-string\">&quot;%{[@metadata][type]}&quot;</span>\n    <span class=\"hljs-attr\">template</span> =&gt; <span class=\"hljs-string\">&quot;/etc/filebeat/vertx_app_filebeat.json&quot;</span>\n    <span class=\"hljs-attr\">template_overwrite</span> =&gt; <span class=\"hljs-keyword\">true</span>\n  }\n}\n</code></pre><h3 id=\"elasticsearch\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#elasticsearch\"></a>Elasticsearch</h3><p>Elas­tic­search is the cen­tral com­po­nent that en­ables the ef­fi­cient in­dex­ing and real-​time search ca­pa­bil­i­ties of the stack. To take the most ad­van­tage of Elas­tic­search, we can pro­vide an in­dex­ing tem­plate of our in­com­ing logs, which can help to op­ti­mize the data stor­age and match the queries is­sued by Kibana at a later point.<br/>\n<!-- -->In the ex­am­ple below, we see an index tem­plate that would be ap­plied to any index match­ing the pat­tern <code>filebeat-*</code>. Ad­di­tion­ally, we de­clare our new log fields <code>type</code>, <code>host</code>, <code>log_level</code>, <code>logger_name</code>, and <code>log_message</code>, which are set as <code>not_analyzed</code> ex­cept for the last two that are set as <code>analyzed</code> al­low­ing to per­form queries based on reg­u­lar ex­pres­sions and not re­stricted to query the full text.</p><pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">&quot;mappings&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;_default_&quot;</span>: {\n      <span class=\"hljs-attr\">&quot;_all&quot;</span>: {\n        <span class=\"hljs-attr\">&quot;enabled&quot;</span>: <span class=\"hljs-literal\">true</span>,\n        <span class=\"hljs-attr\">&quot;norms&quot;</span>: {\n          <span class=\"hljs-attr\">&quot;enabled&quot;</span>: <span class=\"hljs-literal\">false</span>\n        }\n      },\n      <span class=\"hljs-attr\">&quot;dynamic_templates&quot;</span>: [\n        {\n          <span class=\"hljs-attr\">&quot;template1&quot;</span>: {\n            <span class=\"hljs-attr\">&quot;mapping&quot;</span>: {\n              <span class=\"hljs-attr\">&quot;doc_values&quot;</span>: <span class=\"hljs-literal\">true</span>,\n              <span class=\"hljs-attr\">&quot;ignore_above&quot;</span>: <span class=\"hljs-number\">1024</span>,\n              <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;not_analyzed&quot;</span>,\n              <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;{dynamic_type}&quot;</span>\n            },\n            <span class=\"hljs-attr\">&quot;match&quot;</span>: <span class=\"hljs-string\">&quot;*&quot;</span>\n          }\n        }\n      ],\n      <span class=\"hljs-attr\">&quot;properties&quot;</span>: {\n        <span class=\"hljs-attr\">&quot;@timestamp&quot;</span>: {\n          <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;date&quot;</span>\n        },\n        <span class=\"hljs-attr\">&quot;offset&quot;</span>: {\n          <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;long&quot;</span>,\n          <span class=\"hljs-attr\">&quot;doc_values&quot;</span>: <span class=\"hljs-string\">&quot;true&quot;</span>\n        },\n        <span class=\"hljs-attr\">&quot;type&quot;</span>: { <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;string&quot;</span>, <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;not_analyzed&quot;</span> },\n        <span class=\"hljs-attr\">&quot;host&quot;</span>: { <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;string&quot;</span>, <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;not_analyzed&quot;</span> },\n        <span class=\"hljs-attr\">&quot;log_level&quot;</span>: { <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;string&quot;</span>, <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;not_analyzed&quot;</span> },\n        <span class=\"hljs-attr\">&quot;logger_name&quot;</span>: { <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;string&quot;</span>, <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;analyzed&quot;</span> },\n        <span class=\"hljs-attr\">&quot;log_message&quot;</span>: { <span class=\"hljs-attr\">&quot;type&quot;</span>: <span class=\"hljs-string\">&quot;string&quot;</span>, <span class=\"hljs-attr\">&quot;index&quot;</span>: <span class=\"hljs-string\">&quot;analyzed&quot;</span> }\n      }\n    }\n  },\n  <span class=\"hljs-attr\">&quot;settings&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;index.refresh_interval&quot;</span>: <span class=\"hljs-string\">&quot;5s&quot;</span>\n  },\n  <span class=\"hljs-attr\">&quot;template&quot;</span>: <span class=\"hljs-string\">&quot;filebeat-*&quot;</span>\n}\n</code></pre><h3 id=\"kibana\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#kibana\"></a>Kibana</h3><p>Al­though we could fetch all our logs from Elas­tic­search through its API, Kibana is a pow­er­ful tool that al­lows a more friendly query and vi­su­al­iza­tion.\nBe­sides the op­tion to query our data through the avail­able in­dexed field names and search boxes al­low­ing typ­ing spe­cific queries, Kibana al­lows cre­at­ing our own <em>Vi­su­al­iza­tions</em> and <em>Dash­boards</em>. Com­bined, they rep­re­sent a pow­er­ful way to dis­play data and gain in­sight in a cus­tomized man­ner.\nThe ac­com­pa­nied demo ships with a cou­ple of sam­ple dash­boards and vi­su­al­iza­tions that take ad­van­tage of the log fields that we spec­i­fied in our index tem­plate and throw valu­able in­sight. This in­cludes: vi­su­al­iz­ing the num­ber of log mes­sages re­ceived by ELK, ob­serve the pro­por­tion of mes­sages that each log source pro­duces, and di­rectly find out the sources of error logs.</p><p><img src=\"/images/blog/centralized-logging-using-elk/kibana-dashboard.png\" alt=\"Kibana Dashboard&quot; width=&quot;550\"/></p><h2 id=\"log-shipping-challenge\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#log-shipping-challenge\"></a>Log shipping challenge</h2><p>The so­lu­tion pre­sented here re­lied on File­beat to ship log data to Logstash. How­ever, if you are fa­mil­iar with the Log4j frame­work you may be aware that there ex­ists a <em>Sock­e­tAp­pen­der</em> that al­lows to write log events di­rectly to a re­mote server using a TCP con­nec­tion. Al­though in­clud­ing the File­beat + Logstash com­bi­na­tion  may sound an un­nec­es­sary over­head to the log­ging pipeline, they pro­vide a num­ber of ben­e­fits in com­par­i­son to the Log4j socket al­ter­na­tive:</p><ul><li>The Sock­e­tAp­pen­der re­lies on the spe­cific se­ri­al­iza­tion of Log4j’s <em>Lo­gEvent</em> ob­jects, which is no an in­ter­change­able for­mat as JSON, which is used by the Beats so­lu­tion. Al­though there are <a href=\"https://github.com/majikthys/log4j2-logstash-jsonevent-layout\">at­tempts</a> to out­put the logs in a JSON for­mat for Logstash, it doesn’t sup­port mul­ti­line logs, which re­sults in mes­sages being split into dif­fer­ent events by Logstash. On the other hand, there is no of­fi­cial nor sta­ble <a href=\"https://www.elastic.co/guide/en/logstash/current/input-plugins.html\">input plugin</a> for Log4j ver­sion 2.</li><li>While en­abling Log4j’s async log­ging mode in an ap­pli­ca­tion del­e­gates log­ging op­er­a­tions to sep­a­rate threads, given their co­ex­is­tence in the same JVM there is still the risk of data loss in case of a sud­den JVM ter­mi­na­tion with­out proper log chan­nel clos­ing.</li><li>File­beat is a data ship­per de­signed to deal with many con­straints that arise in dis­trib­uted en­vi­ron­ments in a re­li­able man­ner, there­fore it pro­vides op­tions to tai­lor and scale this op­er­a­tion to our needs: the pos­si­bil­ity to load bal­ance be­tween mul­ti­ple Logstash in­stances, spec­ify the num­ber of si­mul­ta­ne­ous File­beat work­ers that ship log files, and spec­ify a com­pres­sion level in order to re­duce the con­sumed band­width. Be­sides that, logs can be shipped in spe­cific batch sizes, with max­i­mum amount of re­tries, and spec­i­fy­ing a con­nec­tion time­out.</li><li>Lastly, al­though File­beat can for­ward logs di­rectly to Elas­tic­search, using Logstash as an in­ter­me­di­ary of­fers the pos­si­bil­ity to col­lect logs from di­verse sources (e.g., sys­tem met­rics).</li></ul><h2 id=\"demo\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#demo\"></a>Demo</h2><p>This post is ac­com­pa­nied by a demo based on the Vert.x Mi­croser­vices <a href=\"http://vertx-lab.dynamis-technologies.com/\">work­shop</a>, where each of them is shipped in a Docker con­tainer sim­u­lat­ing a dis­trib­uted sys­tem com­posed of in­de­pen­dent ad­dress­able nodes.<br/>\n<!-- -->Also, the ELK stack is pro­vi­sioned using a pre­con­fig­ured Docker image by <a href=\"https://github.com/spujadas\">Sébastien Pu­jadas</a>.</p><p>Fol­low­ing the guide­lines in this post, this demo con­fig­ures each of the Mi­croser­vices of the work­shop, sets up a File­beat process on each of them to ship the logs to a cen­tral con­tainer host­ing the ELK stack.</p><h3 id=\"installation\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#installation\"></a>Installation</h3><p>In order to run this demo, it is nec­es­sary to have Docker in­stalled, then pro­ceed with:</p><ul><li>Cloning or down­load­ing the demo <a href=\"https://github.com/ricardohmon/vertx-elk\">repos­i­tory</a>.</li><li>Sep­a­rately, ob­tain­ing the source code of the <a href=\"https://github.com/ricardohmon/vertx-microservices-workshop/tree/elk-demo\">branch</a> of the Mi­croser­vices work­shop adapted for this demo.</li></ul><h3 id=\"building-the-example\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#building-the-example\"></a>Building the example</h3><p>The Docker im­ages be­long­ing to the Vert.x Mi­croser­vices work­shop need to be built sep­a­rately to this project be­fore this project can be launched.</p><h3 id=\"building-the-vertx-microservices-workshop-docker-images\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#building-the-vertx-microservices-workshop-docker-images\"></a>Building the Vert.x Microservices workshop Docker images.</h3><p>Build the <em>root</em> project and the <em>Trader Dash­board</em> fol­lowed by each of the mod­ules con­tained in the so­lu­tion folder. Issue the fol­low­ing com­mands for this:</p><pre><code class=\"hljs language-bash\">mvn clean install\n<span class=\"hljs-built_in\">cd</span> trader-dashboard\nmvn package docker:build\n<span class=\"hljs-built_in\">cd</span> ../solution/audit-service\nmvn package docker:build\n<span class=\"hljs-built_in\">cd</span> ../compulsive-traders\nmvn package docker:build\n<span class=\"hljs-built_in\">cd</span> ../portfolio-service\nmvn package docker:build\n<span class=\"hljs-built_in\">cd</span> ../quote-generator/\nmvn package docker:build\n</code></pre><h3 id=\"running-the-example\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#running-the-example\"></a>Running the example</h3><p>After build­ing the pre­vi­ous im­ages, build and run the ex­am­ple in <code>vertx-elk</code> using the fol­low­ing com­mand:</p><pre><code class=\"hljs language-ebnf\"><span class=\"hljs-attribute\">docker-compose up</span>\n</code></pre><h3 id=\"the-demo\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#the-demo\"></a>The demo</h3><p>You can watch the demo in ac­tion in the fol­low­ing screen­cast:</p><div class=\"youtube-embed\"><iframe src=\"https://www.youtube.com/embed/8P-MgXSujes\" frameBorder=\"0\" allowfullscreen=\"\"></iframe></div><h2 id=\"conclusion\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#conclusion\"></a>Conclusion</h2><p>The ELK stack is a pow­er­ful set of tools that ease the ag­gre­ga­tion of logs com­ing from dis­trib­uted ser­vices into a cen­tral server. Its main pil­lar, Elas­tic­search, pro­vides the in­dex­ing and search ca­pa­bil­i­ties of our log data. Also, it is ac­com­pa­nied by the con­ve­nient input/out­put com­po­nents: Logstash, which can be flex­i­bly con­fig­ured to ac­cept dif­fer­ent data sources; and Kibana, which can be cus­tomized to present the in­for­ma­tion in the most con­ve­nient way.</p><p>Logstash has been de­signed to work seam­lessly with File­beat, the log ship­per which rep­re­sents a ro­bust so­lu­tion that can be adapted to our ap­pli­ca­tions with­out hav­ing to make <em>sig­nif­i­cant</em> changes to our ar­chi­tec­ture. In ad­di­tion, Logstash can ac­cept var­ied types of sources, fil­ter the data, and process it be­fore de­liv­er­ing to Elas­tic­search. This flex­i­bil­ity comes with the price of hav­ing extra el­e­ments in our log ag­gre­ga­tion pipeline, which can rep­re­sent an in­crease of pro­cess­ing over­head or a point-​of-failure. This ad­di­tional over­head could be avoided if an ap­pli­ca­tion would be ca­pa­ble of de­liv­er­ing its log out­put di­rectly to Elas­tic­search.</p><p>Happy log­ging!</p>","scope":{}},"tfIdfTerms":[{"term":"log","tf":56},{"term":"logstash","tf":26},{"term":"filebeat","tf":18},{"term":"configur","tf":17},{"term":"elasticsearch","tf":15},{"term":"us","tf":13},{"term":"applic","tf":12},{"term":"output","tf":11},{"term":"ship","tf":11},{"term":"data","tf":11},{"term":"elk","tf":10},{"term":"stack","tf":10},{"term":"log4j","tf":10},{"term":"demo","tf":10},{"term":"index","tf":10},{"term":"set","tf":9},{"term":"sourc","tf":8},{"term":"allow","tf":8},{"term":"solut","tf":7},{"term":"kibana","tf":7},{"term":"follow","tf":7},{"term":"format","tf":7},{"term":"plugin","tf":7},{"term":"specifi","tf":7},{"term":"field","tf":7}]}],"numPages":9},"__N_SSG":true}