{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"Eclipse Vert.x meets GraphQL","category":"guides","authors":[{"name":"Johannes Schüth","github_id":"jotschi"}],"summary":"In this blog post, we will look at an example application written in Vert.x that uses the new GraphQL API of Gentics Mesh."},"date":"2017-11-14","slug":"eclipse-vert-x-meets-graphql","readingTime":{"text":"7 min read","minutes":6.31,"time":378599.99999999994,"words":1262},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"I re\\xADcently added GraphQL sup\\xADport to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gentics/mesh\"\n  }), \"Gen\\xADtics Mesh\"), \" and I thought it would be a good idea to boil down the essence of my im\\xADple\\xADmen\\xADta\\xADtion in ex\\xADam\\xADple so that I could share it in a sim\\xADpler form.\\nThe ex\\xADam\\xADple I\\u2019m about to show will not cover all as\\xADpects that I have added to the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://getmesh.io/docs/beta/graphql.html\"\n  }), \"Gen\\xADtics Mesh API\"), \" (e.g. pag\\xADing, search and error han\\xADdling) but it will give you a basic overview of the parts that I put to\\xADgether.\\nGraphQL does not re\\xADquire a GraphDB even if the name might sug\\xADgest it.\"), mdx(\"p\", null, \"Using a graphdb in com\\xADbi\\xADna\\xADtion with GraphQL does nev\\xADer\\xADthe\\xADless pro\\xADvide you with some ad\\xADvan\\xADtages which I will high\\xADlight later on.\"), mdx(\"h2\", {\n    \"id\": \"what-is-graphql-what-is-it-good-for\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#what-is-graphql-what-is-it-good-for\"\n  })), \"What is GraphQL? What is it good for?\"), mdx(\"p\", null, \"GraphQL as the name sug\\xADgests is a new query lan\\xADguage which can be used to load ex\\xADactly the amount of data which you ask for. \"), mdx(\"p\", null, \"The query is de\\xADfined in way that the query fields cor\\xADre\\xADlate to the JSON data that is being re\\xADtrieved.\\nIn our Star\\xADWars Demo do\\xADmain model this query will load the name of human 1001 which is Darth Vader.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-css\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attribute\"\n  }), \"vader\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"human\"), \"(id: \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"1001\"), \") {\\n    name\\n  }\\n}\\n\")), mdx(\"p\", null, \"Would re\\xADsult in:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-json\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"data\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"vader\\\"\"), \": {\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"\\\"name\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Darth Vader\\\"\"), \"\\n    }\\n  }\\n}\\n\")), mdx(\"h2\", {\n    \"id\": \"the-demo-app\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#the-demo-app\"\n  })), \"The Demo App\"), mdx(\"p\", null, \"The demo ap\\xADpli\\xADca\\xADtion I build makes use of the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/graphql-java/graphql-java\"\n  }), \"graphql-\\u200Bjava\"), \" li\\xADbrary. The data is being stored in a graph data\\xADbase.\\nI use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://orientdb.com/orientdb/\"\n  }), \"Ori\\xADentDB\"), \" in com\\xADbi\\xADna\\xADtion with the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Syncleus/Ferma\"\n  }), \"OGM Ferma\"), \" to pro\\xADvide a data ac\\xADcess layer.\\nGraphQL does not nec\\xADes\\xADsar\\xADily re\\xADquire a graph data\\xADbase but in this ex\\xADam\\xADple I will make use of one and high\\xADlight the ben\\xADe\\xADfits of using a GraphDB for my use\\xADcase.\"), mdx(\"p\", null, \"You can find the sources here: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example\"\n  }), \"https://github.com/Jotschi/vertx-\\u200Bgraphql-example\")), mdx(\"h3\", {\n    \"id\": \"data\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#data\"\n  })), \"Data\"), mdx(\"p\", null, \"The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/data/StarWarsData.java\"\n  }), \"Star\\xADWars\\xADData\"), \" class cre\\xADates a Graph which con\\xADtains the Star Wars Movies and Char\\xADac\\xADters, Plan\\xADets and their re\\xADla\\xADtions.\\nThe model is fairly sim\\xADple. There is a sin\\xADgle Star\\xADWars\\xADRoot ver\\xADtex which acts as a start el\\xADe\\xADment for var\\xADi\\xADous ag\\xADgre\\xADga\\xADtion ver\\xADtices: Movies are stored in Movie\\xADRoot, Plan\\xADets in Plan\\xADet\\xADs\\xADRoot, Char\\xADac\\xADters are stored in Hu\\xADman\\xADs\\xADRoot and Droid\\xADs\\xADRoot.\"), mdx(\"p\", null, \"The model classes are used for wrap\\xADpers of the spe\\xADcific graph ver\\xADtices. The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://syncleus.com/Ferma/\"\n  }), \"Ferma OGM\"), \" is used to pro\\xADvide these wrap\\xADpers. Each class con\\xADtains meth\\xADods which can be used to tra\\xADverse the graph to lo\\xADcate the needed ver\\xADtices.\\nThe found ver\\xADtices are in turn again wrapped and can be used to lo\\xADcate other graph el\\xADe\\xADments.\"), mdx(\"h3\", {\n    \"id\": \"schema\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#schema\"\n  })), \"Schema\"), mdx(\"p\", null, \"The next thing we need is the GraphQL schema. The schema de\\xADscribes each el\\xADe\\xADment which can be re\\xADtrieved. It also de\\xADscribes the prop\\xADer\\xADties and re\\xADla\\xADtion\\xADships for these el\\xADe\\xADments.\"), mdx(\"p\", null, \"The graphql-\\u200Bjava li\\xADbrary pro\\xADvides an API to cre\\xADate the ob\\xADject types and schema in\\xADfor\\xADma\\xADtion.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-clojure\"\n  }), \"private GraphQLObjectType createMovieType() {\\n  return newObject().name(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Movie\\\"\"), \")\\n    .description(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"One of the films in the Star Wars universe.\\\"\"), \")\\n\\n    // .title\\n    .field(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"newFieldDefinition\"), \"().name(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"title\\\"\"), \")\\n        .description(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Title of the episode.\\\"\"), \")\\n        .type(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"GraphQLString\"), \")\\n        .dataFetcher((\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"env\"), \") -> {\\n          Movie movie = env.getSource()\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \";\"), \"\\n          return movie.getName()\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \";\"), \"\\n        }))\\n\\n    // .description\\n    .field(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"newFieldDefinition\"), \"().name(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"description\\\"\"), \")\\n        .description(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"Description of the episode.\\\"\"), \")\\n        .type(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"GraphQLString\"), \"))\\n\\n    .build()\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \";\"), \"\\n}\\n\")), mdx(\"p\", null, \"A type can be ref\\xADer\\xADenced via a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQLTypeReference\"), \" once it has been cre\\xADated and added to the schema. This is es\\xADpe\\xADcially im\\xADpor\\xADtant if you need to add fields which ref\\xADer\\xADence other types.\\nData fetch\\xADers are used to ac\\xADcess the con\\xADtext, tra\\xADverse the graph and re\\xADtrieve prop\\xADer\\xADties from graph el\\xADe\\xADments.\"), mdx(\"p\", null, \"An\\xADother great source to learn more about the schema op\\xADtions is the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/graphql-java/graphql-java/blob/master/src/test/groovy/graphql/GarfieldSchema.java\"\n  }), \"Garfield\\xADSchema\"), \" ex\\xADam\\xADple.\"), mdx(\"p\", null, \"Fi\\xADnally all the cre\\xADated types must be ref\\xADer\\xADenced by a cen\\xADtral ob\\xADject type \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/data/StarWarsSchema.java#L204\"\n  }), \"Query\\xADType\"), \".\\nThe query type ob\\xADject is ba\\xADsi\\xADcally the root ob\\xADject for the query.\\nIt de\\xADfines what query op\\xADtions are ini\\xADtially pos\\xADsi\\xADble. In our case it is pos\\xADsi\\xADble to load the hero of the sage, spe\\xADcific movies, hu\\xADmans or droids.\"), mdx(\"h3\", {\n    \"id\": \"verticle\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#verticle\"\n  })), \"Verticle\"), mdx(\"p\", null, \"The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/GraphQLVerticle.java\"\n  }), \"GraphQLVer\\xADti\\xADcle\"), \" is used to ac\\xADcept the GraphQL re\\xADquest and process it.\"), mdx(\"p\", null, \"The ver\\xADti\\xADcle also con\\xADtains a Sta\\xADticHan\\xADdler to pro\\xADvide the Graphiql Browser web in\\xADter\\xADface. This in\\xADter\\xADface will allow you to quickly dis\\xADcover and ex\\xADper\\xADi\\xADment with GraphQL.\"), mdx(\"p\", null, \"The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/GraphQLVerticle.java#L77\"\n  }), \"query han\\xADdler\"), \" ac\\xADcepts the query JSON data. \"), mdx(\"p\", null, \"An Ori\\xADentDB trans\\xADac\\xADtion is being opened and the query is ex\\xADe\\xADcuted:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"demoData.getGraph().asyncTx((tx) -> {\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Invoke the query and handle the resulting JSON\"), \"\\n  GraphQL graphQL = newGraphQL(schema).build();\\n  ExecutionInput input = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" ExecutionInput(query, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"null\"), \", queryJson, demoData.getRoot(), extractVariables(queryJson));\\n  tx.complete(graphQL.execute(input));\\n}, (AsyncResult<ExecutionResult> rh) -> {\\n  ...\\n});\\n\")), mdx(\"p\", null, \"The ex\\xADe\\xADcute method ini\\xADtially needs a con\\xADtext vari\\xADable. This con\\xADtext passed along with the query.\\nIn our case the con\\xADtext is the root el\\xADe\\xADment of the graph \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"demoData.getRoot()\"), \".\\nThis con\\xADtext el\\xADe\\xADment also serves as the ini\\xADtial source for our data fetch\\xADers.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \".dataFetcher((env) -> {\\n  StarWarsRoot root = env.getSource();\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" root.getHero();\\n}))\\n\")), mdx(\"p\", null, \"The data fetch\\xADers for the hero type on the other hand will be able to ac\\xADcess the hero el\\xADe\\xADment since the fetcher above re\\xADturned the el\\xADe\\xADment.\\nUsing this mech\\xADa\\xADnism it is pos\\xADsi\\xADble to tra\\xADverse the graph. It is im\\xADpor\\xADtant to note that each in\\xADvo\\xADca\\xADtion on the do\\xADmain model meth\\xADods will di\\xADrectly ac\\xADcess the graph data\\xADbase.\\nThis way it is pos\\xADsi\\xADble to in\\xADflu\\xADence the graph data\\xADbase query down to the low\\xADest level. When omit\\xADting a prop\\xADerty from the graphql query it will not be loaded from the graph.\\nThus there is no need to write an ad\\xADdi\\xADtional data ac\\xADcess layer. All op\\xADer\\xADa\\xADtions are di\\xADrectly mapped to graph data\\xADbase.\"), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"StarWarsRoot\"), \" Ferma class \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"getHero()\"), \" method in turn de\\xADfines a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://tinkerpop.apache.org/docs/3.3.0/tutorials/getting-started/#_graph_traversal_staying_simple\"\n  }), \"Tin\\xADker\\xADPop Grem\\xADlin tra\\xADver\\xADsal\"), \" which is used to load the Ver\\xADtex which rep\\xADre\\xADsents the hero of the Star Wars saga.\"), mdx(Alert, {\n    info: true,\n    mdxType: \"Alert\"\n  }, mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://tinkerpop.apache.org/\"\n  }), \"Apache Tin\\xADker\\xADPop\"), \" is an open source, vendor-\\u200Bagnostic, graph frame\\xADwork / API which is sup\\xADported by many graph data\\xADbase ven\\xADdors.\\nOne part of Tin\\xADker\\xADPop is the Grem\\xADlin tra\\xADver\\xADsal lan\\xADguage which is great to query graph data\\xADbases.\")), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"...\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"public\"), \" Droid \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"getHero\"), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"()\"), \" \"), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Follow the HAS_ROOT edge and return the first found Vertex which could be found. \"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Wrap the Vertex explicitly in the Droid Ferma class.  \"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" traverse((g) -> g.out(HAS_HERO)).nextOrDefaultExplicit(Droid.class, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"null\"), \");\\n}\\n...\\n\")), mdx(\"p\", null, \"Once the query has been ex\\xADe\\xADcuted the re\\xADsult han\\xADdler is being in\\xADvoked. It con\\xADtains some code to process the re\\xADsult data and po\\xADten\\xADtial er\\xADrors.\\nIt is im\\xADpor\\xADtant to note that a GraphQL query will al\\xADways be an\\xADswered with a 2xx HTTP sta\\xADtus code.\\nIf an el\\xADe\\xADment which is being ref\\xADer\\xADenced in the query can\\u2019t be loaded an error will be added to the re\\xADsponse JSON ob\\xADject.\"), mdx(\"h3\", {\n    \"id\": \"testing\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#testing\"\n  })), \"Testing\"), mdx(\"p\", null, \"Test\\xADing is fairly straight for\\xADward. Al\\xADthough there are mul\\xADti\\xADple ap\\xADproaches. One ap\\xADproach is to use unit test\\xADing di\\xADrectly on the GraphQL types.\\nAn\\xADother op\\xADtion is to run queries against the end\\xADpoint.  \"), mdx(\"p\", null, \"The \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/test/java/de/jotschi/vertx/GraphQLTest.java\"\n  }), \"GraphQL\\xADTest class\"), \" I wrote will run mul\\xADti\\xADple queries against the end\\xADpoint.\\nA Pa\\xADra\\xADme\\xADter\\xADized JUnit test is used it\\xADer\\xADate over the queries.\"), mdx(\"p\", null, \"A \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/test/resources/graphql/full-query\"\n  }), \"typ\\xADi\\xADcal query\"), \" does not only con\\xADtain the query data.\\nThe as\\xADser\\xADtions on the re\\xADsponse JSON are di\\xADrectly in\\xADcluded in query using plain com\\xADments.\"), mdx(\"p\", null, \"I build an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://joel-costigliola.github.io/assertj/\"\n  }), \"As\\xADsertJ\"), \" as\\xADser\\xADtion to check the com\\xADments of a query and ver\\xADify that the as\\xADser\\xADtion matches the re\\xADsponse.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-java\"\n  }), \"  assertThat(response).compliesToAssertions(queryName);\\n\")), mdx(\"h2\", {\n    \"id\": \"run-the-example\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#run-the-example\"\n  })), \"Run the example\"), mdx(\"p\", null, \"You can run the ex\\xADam\\xADple by ex\\xADe\\xADcut\\xADing the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"GraphQLServer\"), \" class and ac\\xADcess the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://localhost:3000/browser/?query=%7B%0A%20%20movies%20%7B%0A%20%20%20%20title%0A%20%20%7D%0A%20%20hero%20%7B%0A%20%20%20%20name%0A%20%20%7D%0A%7D%0A\"\n  }), \"Graphiql browser on http://lo\\xADcal\\xADhost:3000/browser/\")), mdx(\"h2\", {\n    \"id\": \"where-to-go-from-here\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#where-to-go-from-here\"\n  })), \"Where to go from here?\"), mdx(\"p\", null, \"The ex\\xADam\\xADple is read-\\u200Bonly. GraphQL also sup\\xADports data mu\\xADta\\xADtion which can be used to ac\\xADtu\\xADally mod\\xADify and store data.\\nI have not yet ex\\xADplored that part of GraphQL but I as\\xADsume it might not be that hard to add mu\\xADta\\xADtion sup\\xADport to the ex\\xADam\\xADple.\"), mdx(\"p\", null, \"Ad\\xADdi\\xADtion\\xADally it does not cover how to ac\\xADtu\\xADally make use of such API. I re\\xADcently \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/gentics/mesh-vertx-example/\"\n  }), \"up\\xADdated my Vert.x ex\\xADam\\xADple\"), \" which shows how to use Vert.x tem\\xADplate han\\xADdlers to build a small server which ren\\xADders some pages using data which was loaded via GraphQL.\"), mdx(\"p\", null, \"Thanks for read\\xADing. If you have any fur\\xADther ques\\xADtions or feed\\xADback don\\u2019t hes\\xADi\\xADtate to send me a tweet to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/Jotschi/\"\n  }), \"@Jotschi\"), \" or \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/genticsmesh/\"\n  }), \"@gen\\xADtic\\xADsmesh\"), \".\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"<p>I re­cently added GraphQL sup­port to <a href=\"https://github.com/gentics/mesh\">Gen­tics Mesh</a> and I thought it would be a good idea to boil down the essence of my im­ple­men­ta­tion in ex­am­ple so that I could share it in a sim­pler form.\nThe ex­am­ple I’m about to show will not cover all as­pects that I have added to the <a href=\"https://getmesh.io/docs/beta/graphql.html\">Gen­tics Mesh API</a> (e.g. pag­ing, search and error han­dling) but it will give you a basic overview of the parts that I put to­gether.\nGraphQL does not re­quire a GraphDB even if the name might sug­gest it.</p><p>Using a graphdb in com­bi­na­tion with GraphQL does nev­er­the­less pro­vide you with some ad­van­tages which I will high­light later on.</p><h2 id=\"what-is-graphql-what-is-it-good-for\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#what-is-graphql-what-is-it-good-for\"></a>What is GraphQL? What is it good for?</h2><p>GraphQL as the name sug­gests is a new query lan­guage which can be used to load ex­actly the amount of data which you ask for. </p><p>The query is de­fined in way that the query fields cor­re­late to the JSON data that is being re­trieved.\nIn our Star­Wars Demo do­main model this query will load the name of human 1001 which is Darth Vader.</p><pre><code class=\"hljs language-css\">{\n  <span class=\"hljs-attribute\">vader</span>: <span class=\"hljs-built_in\">human</span>(id: <span class=\"hljs-number\">1001</span>) {\n    name\n  }\n}\n</code></pre><p>Would re­sult in:</p><pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">&quot;data&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;vader&quot;</span>: {\n      <span class=\"hljs-attr\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;Darth Vader&quot;</span>\n    }\n  }\n}\n</code></pre><h2 id=\"the-demo-app\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#the-demo-app\"></a>The Demo App</h2><p>The demo ap­pli­ca­tion I build makes use of the <a href=\"https://github.com/graphql-java/graphql-java\">graphql-​java</a> li­brary. The data is being stored in a graph data­base.\nI use <a href=\"http://orientdb.com/orientdb/\">Ori­entDB</a> in com­bi­na­tion with the <a href=\"https://github.com/Syncleus/Ferma\">OGM Ferma</a> to pro­vide a data ac­cess layer.\nGraphQL does not nec­es­sar­ily re­quire a graph data­base but in this ex­am­ple I will make use of one and high­light the ben­e­fits of using a GraphDB for my use­case.</p><p>You can find the sources here: <a href=\"https://github.com/Jotschi/vertx-graphql-example\">https://github.com/Jotschi/vertx-​graphql-example</a></p><h3 id=\"data\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#data\"></a>Data</h3><p>The <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/data/StarWarsData.java\">Star­Wars­Data</a> class cre­ates a Graph which con­tains the Star Wars Movies and Char­ac­ters, Plan­ets and their re­la­tions.\nThe model is fairly sim­ple. There is a sin­gle Star­Wars­Root ver­tex which acts as a start el­e­ment for var­i­ous ag­gre­ga­tion ver­tices: Movies are stored in Movie­Root, Plan­ets in Plan­et­s­Root, Char­ac­ters are stored in Hu­man­s­Root and Droid­s­Root.</p><p>The model classes are used for wrap­pers of the spe­cific graph ver­tices. The <a href=\"http://syncleus.com/Ferma/\">Ferma OGM</a> is used to pro­vide these wrap­pers. Each class con­tains meth­ods which can be used to tra­verse the graph to lo­cate the needed ver­tices.\nThe found ver­tices are in turn again wrapped and can be used to lo­cate other graph el­e­ments.</p><h3 id=\"schema\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#schema\"></a>Schema</h3><p>The next thing we need is the GraphQL schema. The schema de­scribes each el­e­ment which can be re­trieved. It also de­scribes the prop­er­ties and re­la­tion­ships for these el­e­ments.</p><p>The graphql-​java li­brary pro­vides an API to cre­ate the ob­ject types and schema in­for­ma­tion.</p><pre><code class=\"hljs language-clojure\">private GraphQLObjectType createMovieType() {\n  return newObject().name(<span class=\"hljs-string\">&quot;Movie&quot;</span>)\n    .description(<span class=\"hljs-string\">&quot;One of the films in the Star Wars universe.&quot;</span>)\n\n    // .title\n    .field(<span class=\"hljs-name\">newFieldDefinition</span>().name(<span class=\"hljs-string\">&quot;title&quot;</span>)\n        .description(<span class=\"hljs-string\">&quot;Title of the episode.&quot;</span>)\n        .type(<span class=\"hljs-name\">GraphQLString</span>)\n        .dataFetcher((<span class=\"hljs-name\">env</span>) -&gt; {\n          Movie movie = env.getSource()<span class=\"hljs-comment\">;</span>\n          return movie.getName()<span class=\"hljs-comment\">;</span>\n        }))\n\n    // .description\n    .field(<span class=\"hljs-name\">newFieldDefinition</span>().name(<span class=\"hljs-string\">&quot;description&quot;</span>)\n        .description(<span class=\"hljs-string\">&quot;Description of the episode.&quot;</span>)\n        .type(<span class=\"hljs-name\">GraphQLString</span>))\n\n    .build()<span class=\"hljs-comment\">;</span>\n}\n</code></pre><p>A type can be ref­er­enced via a <code>GraphQLTypeReference</code> once it has been cre­ated and added to the schema. This is es­pe­cially im­por­tant if you need to add fields which ref­er­ence other types.\nData fetch­ers are used to ac­cess the con­text, tra­verse the graph and re­trieve prop­er­ties from graph el­e­ments.</p><p>An­other great source to learn more about the schema op­tions is the <a href=\"https://github.com/graphql-java/graphql-java/blob/master/src/test/groovy/graphql/GarfieldSchema.java\">Garfield­Schema</a> ex­am­ple.</p><p>Fi­nally all the cre­ated types must be ref­er­enced by a cen­tral ob­ject type <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/data/StarWarsSchema.java#L204\">Query­Type</a>.\nThe query type ob­ject is ba­si­cally the root ob­ject for the query.\nIt de­fines what query op­tions are ini­tially pos­si­ble. In our case it is pos­si­ble to load the hero of the sage, spe­cific movies, hu­mans or droids.</p><h3 id=\"verticle\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#verticle\"></a>Verticle</h3><p>The <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/GraphQLVerticle.java\">GraphQLVer­ti­cle</a> is used to ac­cept the GraphQL re­quest and process it.</p><p>The ver­ti­cle also con­tains a Sta­ticHan­dler to pro­vide the Graphiql Browser web in­ter­face. This in­ter­face will allow you to quickly dis­cover and ex­per­i­ment with GraphQL.</p><p>The <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/main/java/de/jotschi/vertx/GraphQLVerticle.java#L77\">query han­dler</a> ac­cepts the query JSON data. </p><p>An Ori­entDB trans­ac­tion is being opened and the query is ex­e­cuted:</p><pre><code class=\"hljs language-java\">demoData.getGraph().asyncTx((tx) -&gt; {\n  <span class=\"hljs-comment\">// Invoke the query and handle the resulting JSON</span>\n  GraphQL graphQL = newGraphQL(schema).build();\n  ExecutionInput input = <span class=\"hljs-keyword\">new</span> ExecutionInput(query, <span class=\"hljs-keyword\">null</span>, queryJson, demoData.getRoot(), extractVariables(queryJson));\n  tx.complete(graphQL.execute(input));\n}, (AsyncResult&lt;ExecutionResult&gt; rh) -&gt; {\n  ...\n});\n</code></pre><p>The ex­e­cute method ini­tially needs a con­text vari­able. This con­text passed along with the query.\nIn our case the con­text is the root el­e­ment of the graph <code>demoData.getRoot()</code>.\nThis con­text el­e­ment also serves as the ini­tial source for our data fetch­ers.</p><pre><code class=\"hljs language-java\">.dataFetcher((env) -&gt; {\n  StarWarsRoot root = env.getSource();\n  <span class=\"hljs-keyword\">return</span> root.getHero();\n}))\n</code></pre><p>The data fetch­ers for the hero type on the other hand will be able to ac­cess the hero el­e­ment since the fetcher above re­turned the el­e­ment.\nUsing this mech­a­nism it is pos­si­ble to tra­verse the graph. It is im­por­tant to note that each in­vo­ca­tion on the do­main model meth­ods will di­rectly ac­cess the graph data­base.\nThis way it is pos­si­ble to in­flu­ence the graph data­base query down to the low­est level. When omit­ting a prop­erty from the graphql query it will not be loaded from the graph.\nThus there is no need to write an ad­di­tional data ac­cess layer. All op­er­a­tions are di­rectly mapped to graph data­base.</p><p>The <code>StarWarsRoot</code> Ferma class <code>getHero()</code> method in turn de­fines a <a href=\"http://tinkerpop.apache.org/docs/3.3.0/tutorials/getting-started/#_graph_traversal_staying_simple\">Tin­ker­Pop Grem­lin tra­ver­sal</a> which is used to load the Ver­tex which rep­re­sents the hero of the Star Wars saga.</p><div class=\"alert info\"><p><a href=\"http://tinkerpop.apache.org/\">Apache Tin­ker­Pop</a> is an open source, vendor-​agnostic, graph frame­work / API which is sup­ported by many graph data­base ven­dors.\nOne part of Tin­ker­Pop is the Grem­lin tra­ver­sal lan­guage which is great to query graph data­bases.</p></div><pre><code class=\"hljs language-java\">...\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Droid <span class=\"hljs-title\">getHero</span><span class=\"hljs-params\">()</span> </span>{\n  <span class=\"hljs-comment\">// Follow the HAS_ROOT edge and return the first found Vertex which could be found. </span>\n  <span class=\"hljs-comment\">// Wrap the Vertex explicitly in the Droid Ferma class.  </span>\n  <span class=\"hljs-keyword\">return</span> traverse((g) -&gt; g.out(HAS_HERO)).nextOrDefaultExplicit(Droid.class, <span class=\"hljs-keyword\">null</span>);\n}\n...\n</code></pre><p>Once the query has been ex­e­cuted the re­sult han­dler is being in­voked. It con­tains some code to process the re­sult data and po­ten­tial er­rors.\nIt is im­por­tant to note that a GraphQL query will al­ways be an­swered with a 2xx HTTP sta­tus code.\nIf an el­e­ment which is being ref­er­enced in the query can’t be loaded an error will be added to the re­sponse JSON ob­ject.</p><h3 id=\"testing\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#testing\"></a>Testing</h3><p>Test­ing is fairly straight for­ward. Al­though there are mul­ti­ple ap­proaches. One ap­proach is to use unit test­ing di­rectly on the GraphQL types.\nAn­other op­tion is to run queries against the end­point.  </p><p>The <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/test/java/de/jotschi/vertx/GraphQLTest.java\">GraphQL­Test class</a> I wrote will run mul­ti­ple queries against the end­point.\nA Pa­ra­me­ter­ized JUnit test is used it­er­ate over the queries.</p><p>A <a href=\"https://github.com/Jotschi/vertx-graphql-example/blob/master/src/test/resources/graphql/full-query\">typ­i­cal query</a> does not only con­tain the query data.\nThe as­ser­tions on the re­sponse JSON are di­rectly in­cluded in query using plain com­ments.</p><p>I build an <a href=\"http://joel-costigliola.github.io/assertj/\">As­sertJ</a> as­ser­tion to check the com­ments of a query and ver­ify that the as­ser­tion matches the re­sponse.</p><pre><code class=\"hljs language-java\">  assertThat(response).compliesToAssertions(queryName);\n</code></pre><h2 id=\"run-the-example\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#run-the-example\"></a>Run the example</h2><p>You can run the ex­am­ple by ex­e­cut­ing the <code>GraphQLServer</code> class and ac­cess the <a href=\"http://localhost:3000/browser/?query=%7B%0A%20%20movies%20%7B%0A%20%20%20%20title%0A%20%20%7D%0A%20%20hero%20%7B%0A%20%20%20%20name%0A%20%20%7D%0A%7D%0A\">Graphiql browser on http://lo­cal­host:3000/browser/</a></p><h2 id=\"where-to-go-from-here\"><a aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#where-to-go-from-here\"></a>Where to go from here?</h2><p>The ex­am­ple is read-​only. GraphQL also sup­ports data mu­ta­tion which can be used to ac­tu­ally mod­ify and store data.\nI have not yet ex­plored that part of GraphQL but I as­sume it might not be that hard to add mu­ta­tion sup­port to the ex­am­ple.</p><p>Ad­di­tion­ally it does not cover how to ac­tu­ally make use of such API. I re­cently <a href=\"https://github.com/gentics/mesh-vertx-example/\">up­dated my Vert.x ex­am­ple</a> which shows how to use Vert.x tem­plate han­dlers to build a small server which ren­ders some pages using data which was loaded via GraphQL.</p><p>Thanks for read­ing. If you have any fur­ther ques­tions or feed­back don’t hes­i­tate to send me a tweet to <a href=\"https://twitter.com/Jotschi/\">@Jotschi</a> or <a href=\"https://twitter.com/genticsmesh/\">@gen­tic­smesh</a>.</p>","scope":{}}},"prevPost":{"meta":{"title":"TCP Client using Eclipse Vert.x, Kotlin and Gradle build","category":"guides","authors":[{"name":"Usman Saleem","github_id":"usmansaleem"}],"summary":"In this blog post, I demonstrate how to write a very simple TCP client that keeps a connection open to a custom-written server in cloud."},"date":"2017-12-20","slug":"tcp-client-using-eclipse-vert-x-kotlin-and-gradle-build"},"nextPost":{"meta":{"title":"Eclipse Vert.x 3.5.0 released!","category":"releases","authors":[{"name":"Julien Viet","github_id":"vietj"}],"summary":"The Vert.x team is pleased to announce the release of Eclipse Vert.x 3.5.0."},"date":"2017-10-20","slug":"eclipse-vert-x-3-5-0-released"},"relatedPosts":[{"meta":{"title":"An Introduction to the Vert.x Context Object","category":"guides","authors":[{"name":"Jez Prime","github_id":"millross"}],"summary":"Under the hood, the vert.x Context class plays a critical part in maintaining the thread-safety guarantees of verticles. Most of the time, vert.x coders don't need to make use of Context objects directly."},"date":"2017-01-31","slug":"an-introduction-to-the-vert-x-context-object"},{"meta":{"title":"JWT Authorization for Vert.x with Keycloak","category":"guides","authors":[{"name":"Thomas Darimont","github_id":"thomasdarimont"}],"summary":"In this blog post, you'll learn about JWT foundations, protect routes with JWT Authorization, JWT encoded tokens, and RBAC with Keycloak"},"date":"2020-10-01","slug":"jwt-authorization-for-vert-x-with-keycloak"},{"meta":{"title":"Combine vert.x and mongo to build a giant","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This blog post is part of the introduction to Vert.x series. We are now going to replace this JDBC client by the vertx-mongo-client, and thus connect to a Mongo database."},"date":"2015-11-30","slug":"combine-vert-x-and-mongo-to-build-a-giant"}]},"__N_SSG":true}