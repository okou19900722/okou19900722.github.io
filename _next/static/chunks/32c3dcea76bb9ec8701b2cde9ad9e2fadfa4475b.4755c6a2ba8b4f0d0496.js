(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"+aIQ":function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Easy SSO for Vert.x with Keycloak",category:"guides",authors:[{name:"Thomas Darimont",github_id:"thomasdarimont"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Easy SSO for Vert.x with Keycloak"),Object(o.a)("h2",null,"TL;DR"),Object(o.a)("p",null,"In this blog post you\u2019ll learn:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"How to im\xadple\xadment Sin\xadgle Sign-\u200bon with OpenID Con\xadnect"),Object(o.a)("li",{parentName:"ul"},"How to use Key\xadcloak\u2019s OpenID Dis\xadcov\xadery to infer OpenID provider con\xadfig\xadu\xadra\xadtion"),Object(o.a)("li",{parentName:"ul"},"How to ob\xadtain user in\xadfor\xadma\xadtion"),Object(o.a)("li",{parentName:"ul"},"How to check for au\xadtho\xadriza\xadtion"),Object(o.a)("li",{parentName:"ul"},"How to call a Bearer pro\xadtected ser\xadvice with an Ac\xadcess Token"),Object(o.a)("li",{parentName:"ul"},"How to im\xadple\xadment a form based lo\xadgout")),Object(o.a)("h2",null,"Hello Blog"),Object(o.a)("p",null,"This is my first post in the Vert.x Blog and I must admit that up until now I have never used Vert.x in a real project.\n\u201cWhy are you here?\u201d, you might ask\u2026 Well I cur\xadrently have two main hob\xadbies, learn\xading new things and se\xadcur\xading apps with ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://www.keycloak.org/"}),"Key\xadcloak"),".\nSo a few days ago, I stum\xadbled upon the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://www.youtube.com/watch?v=LsaXy7SRXMY&list=PLkeCJDaCC2ZsnySdg04Aq9D9FpAZY6K5D"}),"In\xadtro\xadduc\xadtion to Vert.x video se\xadries on youtube")," by ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://twitter.com/infosec812"}),"Deven Phillips")," and I was im\xadme\xaddi\xadately hooked. Vert.x was a new thing for me, so the next log\xadi\xadcal step was to fig\xadure out how to se\xadcure a Vert.x app with Key\xadcloak."),Object(o.a)("p",null,"For this ex\xadam\xadple I build a small web app with Vert.x that shows how to im\xadple\xadment Sin\xadgle Sign-\u200bon (SSO) with Key\xadcloak\nand OpenID Con\xadnect, ob\xadtain in\xadfor\xadma\xadtion about the cur\xadrent user, check for roles, call bearer pro\xadtected ser\xadvices and prop\xaderly han\xaddling lo\xadgout."),Object(o.a)("h2",null,"Keycloak"),Object(o.a)("p",null,Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://www.keycloak.org/"}),"Key\xadcloak")," is a Open Source Iden\xadtity and Ac\xadcess Man\xadage\xadment so\xadlu\xadtion which pro\xadvides sup\xadport for OpenID Con\xadnect\nbased Singe-\u200bSign on, among many other things. I briefly looked for ways to se\xadcur\xading a Vert.x app with Key\xadcloak\nand quickly found an ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/blog/vertx-3-and-keycloak-tutorial/"}),"older Vert.x Key\xadcloak in\xadte\xadgra\xadtion ex\xadam\xadple")," in this very blog.\nWhilst this is a good start for be\xadgin\xadners, the ex\xadam\xadple con\xadtains a few is\xadsues, e.g.:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"It uses hard\xadcoded OpenID provider con\xadfig\xadu\xadra\xadtion"),Object(o.a)("li",{parentName:"ul"},"Fea\xadtures a very sim\xadplis\xadtic in\xadte\xadgra\xadtion (for the sake of sim\xadplic\xadity)"),Object(o.a)("li",{parentName:"ul"},"No user in\xadfor\xadma\xadtion used"),Object(o.a)("li",{parentName:"ul"},"No lo\xadgout func\xadtion\xadal\xadity is shown")),Object(o.a)("p",null,"That some\xadhow nerd\xadsniped me a bit and so it came that, after a long day of con\xadsult\xading work, I sat down to cre\xadate an ex\xadam\xadple for a com\xadplete Key\xadcloak in\xadte\xadgra\xadtion based on ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-auth-oauth2/java/"}),"Vert.x OpenID Con\xadnect / OAuth2 Sup\xadport"),"."),Object(o.a)("p",null,"So let\u2019s get started!"),Object(o.a)("h3",null,"Keycloak Setup"),Object(o.a)("p",null,"To se\xadcure a Vert.x app with Key\xadcloak we of course need a Key\xadcloak in\xadstance. Al\xadthough ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://www.keycloak.org/docs/latest/getting_started/"}),"Key\xadcloak has a great get\xadting started guide")," I wanted to make it a bit eas\xadier to put every\xadthing to\xadgether, there\xadfore I pre\xadpared a local Key\xadcloak docker con\xadtainer ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/thomasdarimont/vertx-playground/tree/master/keycloak-vertx#start-keycloak-with-the-vertx-realm"}),"as de\xadscribed here")," that you can start eas\xadily, which comes with all the re\xadquired con\xadfig\xadu\xadra\xadtion in place."),Object(o.a)("p",null,"The pre\xadcon\xadfig\xadured Key\xadcloak realm named ",Object(o.a)("inlineCode",{parentName:"p"},"vertx")," con\xadtains a ",Object(o.a)("inlineCode",{parentName:"p"},"demo-client")," for our Vert.x web app and a set\nof users for test\xading."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-haml"}),"docker run \\\n  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"it \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"-name vertx-keycloak \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"-rm \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"e KEYCLOAK_USER=admin \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"e KEYCLOAK_PASSWORD=admin \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"e KEYCLOAK_IMPORT=",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-regexp"}),"/tmp/vertx"),"-realm.json \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"v $PWD/vertx-realm.",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-symbol"}),"json:"),"/tmp/vertx-realm.json \\\n"),"  -",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"ruby"}),"p ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-number"}),"8080"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-symbol"}),":"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-number"}),"8080")," \\\n"),"  quay.io/keycloak/keycloak:9.0.0\n")),Object(o.a)("h2",null,"Vert.x Web App"),Object(o.a)("p",null,"The sim\xadple web app con\xadsists of a sin\xadgle ",Object(o.a)("inlineCode",{parentName:"p"},"Verticle"),", runs on ",Object(o.a)("inlineCode",{parentName:"p"},"http://localhost:8090")," and pro\xadvides a few routes with pro\xadtected re\xadsources. ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/thomasdarimont/vertx-playground/blob/master/keycloak-vertx/src/main/java/demo/MainVerticle.java"}),"You can find the com\xadplete ex\xadam\xadple here"),"."),Object(o.a)("p",null,"The web app con\xadtains the fol\xadlow\xading routes with han\xaddlers:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/")," - The un\xadpro\xadtected index page"),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/protected")," - The pro\xadtected page, which shows a greet\xading mes\xadsage, users need to login to ac\xadcess pages be\xadneath this path."),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/protected/user")," - The pro\xadtected user page, which shows some in\xadfor\xadma\xadtion about the user."),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/protected/admin")," - The pro\xadtected admin page, which shows some in\xadfor\xadma\xadtion about the admin, only users with role ",Object(o.a)("inlineCode",{parentName:"li"},"admin")," can ac\xadcess this page."),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/protected/userinfo")," - The pro\xadtected user\xadinfo page, ob\xadtains user in\xadfor\xadma\xadtion from the bearer token pro\xadtected user\xadinfo end\xadpoint in Key\xadcloak."),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"/logout")," - The pro\xadtected lo\xadgout re\xadsource, which trig\xadgers the user lo\xadgout.")),Object(o.a)("h3",null,"Running the app"),Object(o.a)("p",null,"To run the app, we need to build our app via:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-ada"}),"cd keycloak-vertx\nmvn clean ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"package"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-title"})))),Object(o.a)("p",null,"This cre\xadates a runnable jar, which we can run via:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-mipsasm"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"java "),"-",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"jar "),"target",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"/*.jar\n"))),Object(o.a)("p",null,"Note, that you need to start Key\xadcloak, since our app will try to fetch con\xadfig\xadu\xadra\xadtion from Key\xadcloak."),Object(o.a)("p",null,"If the ap\xadpli\xadca\xadtion is run\xadning, just browse to: ",Object(o.a)("inlineCode",{parentName:"p"},"http://localhost:8090/"),"."),Object(o.a)("p",null,"An ex\xadam\xadple in\xadter\xadac\xadtion with the app can be seen in the fol\xadlow\xading gif:\n","![Vert.x Keycloak Integration Demo]","({{ site_url }}as\xadsets/blog/vertx-\u200bkeycloak-integration/2020-03-07-\u200bvertx-keycloak-integration.gif)"),Object(o.a)("h3",null,"Router, SessionStore and CSRF Protection"),Object(o.a)("p",null,"We start the con\xadfig\xadu\xadra\xadtion of our web app by cre\xadat\xading a ",Object(o.a)("inlineCode",{parentName:"p"},"Router")," where we can add cus\xadtom han\xaddler func\xadtions for our routes.\nTo prop\xaderly han\xaddle the au\xadthen\xadti\xadca\xadtion state we need to cre\xadate a ",Object(o.a)("inlineCode",{parentName:"p"},"SessionStore")," and at\xadtach it to the ",Object(o.a)("inlineCode",{parentName:"p"},"Router"),".\nThe ",Object(o.a)("inlineCode",{parentName:"p"},"SessionStore")," is used by our OAuth2/OpenID Con\xadnect in\xadfra\xadstruc\xadture to as\xadso\xadciate au\xadthen\xadti\xadca\xadtion in\xadfor\xadma\xadtion with a ses\xadsion.\nBy the way, the ",Object(o.a)("inlineCode",{parentName:"p"},"SessionStore")," can also be clus\xadtered if you need to dis\xadtrib\xadute the server-\u200bside state."),Object(o.a)("p",null,"Note that if you want to keep your server state\xadless but still want to sup\xadport clus\xadter\xading,\nthen you could pro\xadvide your own im\xadple\xadmen\xadta\xadtion of a ",Object(o.a)("inlineCode",{parentName:"p"},"SessionStore")," which stores the ses\xadsion in\xadfor\xadma\xadtion\nas an en\xadcrypted cookie on the Client."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"Router router = Router.router(vertx);\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Store session information on the server side"),"\nSessionStore sessionStore = LocalSessionStore.create(vertx);\nSessionHandler sessionHandler = SessionHandler.create(sessionStore);\nrouter.route().handler(sessionHandler);\n")),Object(o.a)("p",null,"In order to pro\xadtected against CSRF at\xadtacks it is good prac\xadtice to pro\xadtect HTML forms with a CSRF token.\nWe need this for our lo\xadgout form that we\u2019ll see later."),Object(o.a)("p",null,"To do this we con\xadfig\xadure a ",Object(o.a)("inlineCode",{parentName:"p"},"CSRFHandler")," and add it to our ",Object(o.a)("inlineCode",{parentName:"p"},"Router"),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// CSRF handler setup required for logout form"),"\nString csrfSecret = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"zwiebelfische"'),";\nCSRFHandler csrfHandler = CSRFHandler.create(csrfSecret);\nrouter.route().handler(ctx -> {\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Ensures that the csrf token request parameter is available for the CsrfHandler"),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// after the logout form was submitted."),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),'// See "Handling HTML forms" https://vertx.io/docs/vertx-core/java/#_handling_requests'),"\n            ctx.request().setExpectMultipart(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"true"),");\n            ctx.request().endHandler(v -> csrfHandler.handle(ctx));\n        }\n);\n")),Object(o.a)("h3",null,"Keycloak Setup via OpenID Connect Discovery"),Object(o.a)("p",null,"Our app is reg\xadis\xadtered as a con\xadfi\xadden\xadtial OpenID Con\xadnect client with Au\xadtho\xadriza\xadtion Code Flow in Key\xadcloak,\nthus we need to con\xadfig\xadure ",Object(o.a)("inlineCode",{parentName:"p"},"client_id")," and ",Object(o.a)("inlineCode",{parentName:"p"},"client_secret"),". Con\xadfi\xadden\xadtial clients are typ\xadi\xadcally used\nfor server-\u200bside web ap\xadpli\xadca\xadtions, where one can se\xadcurely store the ",Object(o.a)("inlineCode",{parentName:"p"},"client_secret"),". You can find out more\nabout",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://www.keycloak.org/docs/latest/server_admin/index.html#_access-type"}),"The dif\xadfer\xadent Client Ac\xadcess Types")," in the Key\xadcloak doc\xadu\xadmen\xadta\xadtion."),Object(o.a)("p",null,"Since we don\u2019t want to con\xadfig\xadure things like OAuth2 / OpenID Con\xadnect End\xadpoints our\xadselves, we use Key\xadcloak\u2019s OpenID Con\xadnect dis\xadcov\xadery end\xadpoint to infer the nec\xades\xadsary Oauth2 / OpenID Con\xadnect end\xadpoint URLs."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"String hostname = System.getProperty(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"http.host"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"localhost"'),");\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"int")," port = Integer.getInteger(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"http.port"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"8090"),");\nString baseUrl = String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"http://%s:%d"'),", hostname, port);\nString oauthCallbackPath = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/callback"'),";\n\nOAuth2ClientOptions clientOptions = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," OAuth2ClientOptions()\n    .setFlow(OAuth2FlowType.AUTH_CODE)\n    .setSite(System.getProperty(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"oauth2.issuer"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"http://localhost:8080/auth/realms/vertx"'),"))\n    .setClientID(System.getProperty(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"oauth2.client_id"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"demo-client"'),"))\n    .setClientSecret(System.getProperty(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"oauth2.client_secret"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"1f88bd14-7e7f-45e7-be27-d680da6e48d8"'),"));\n\nKeycloakAuth.discover(vertx, clientOptions, asyncResult -> {\n\n    OAuth2Auth oauth2Auth = asyncResult.result();\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (oauth2Auth == ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"null"),") {\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"throw")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," RuntimeException(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Could not configure Keycloak integration via OpenID Connect Discovery Endpoint. Is Keycloak running?"'),");\n    }\n\n    AuthHandler oauth2 = OAuth2AuthHandler.create(oauth2Auth, baseUrl + oauthCallbackPath)\n        .setupCallback(router.get(oauthCallbackPath))\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Additional scopes: openid for OpenID Connect"),"\n        .addAuthority(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"openid"'),");\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// session handler needs access to the authenticated user, otherwise we get an infinite redirect loop"),"\n    sessionHandler.setAuthProvider(oauth2Auth);\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// protect resources beneath /protected/* with oauth2 handler"),"\n    router.route(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/protected/*"'),").handler(oauth2);\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// configure route handlers"),"\n    configureRoutes(router, webClient, oauth2Auth);\n});\n\ngetVertx().createHttpServer().requestHandler(router).listen(port);\n")),Object(o.a)("h3",null,"Route handlers"),Object(o.a)("p",null,"We con\xadfig\xadure our route han\xaddlers via ",Object(o.a)("inlineCode",{parentName:"p"},"configureRoutes"),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"configureRoutes"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(Router router, WebClient webClient, OAuth2Auth oauth2Auth)")," "),"{\n\n    router.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/"'),").handler(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),"::handleIndex);\n\n    router.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/protected"'),").handler(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),"::handleGreet);\n    router.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/protected/user"'),").handler(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),"::handleUserPage);\n    router.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/protected/admin"'),").handler(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),"::handleAdminPage);\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// extract discovered userinfo endpoint url"),"\n    String userInfoUrl =  ((OAuth2AuthProviderImpl)oauth2Auth).getConfig().getUserInfoPath();\n    router.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/protected/userinfo"'),").handler(createUserInfoHandler(webClient, userInfoUrl));\n\n    router.post(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/logout"'),").handler(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),"::handleLogout);\n}\n")),Object(o.a)("p",null,"The index han\xaddler ex\xadposes an un\xadpro\xadtected re\xadsource:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"handleIndex"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n    respondWithOk(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>Welcome to Vert.x Keycloak Example</h1><br><a href=\\"/protected\\">Protected</a>"'),");\n}\n")),Object(o.a)("h3",null,"Extract User Information from the OpenID Connect ID Token"),Object(o.a)("p",null,"Our app ex\xadposes a sim\xadple greet\xading page which shows some in\xadfor\xadma\xadtion about the user and pro\xadvides links to other pages."),Object(o.a)("p",null,"The user greet\xading han\xaddler is pro\xadtected by the Key\xadcloak OAuth2 / OpenID Con\xadnect in\xadte\xadgra\xadtion. To show in\xadfor\xadma\xadtion about\nthe cur\xadrent user, we first need to call the ",Object(o.a)("inlineCode",{parentName:"p"},"ctx.user()")," method to get an user ob\xadject we can work with.\nTo ac\xadcess the OAuth2 token in\xadfor\xadma\xadtion, we need to cast it to ",Object(o.a)("inlineCode",{parentName:"p"},"OAuth2TokenImpl"),"."),Object(o.a)("p",null,"We can ex\xadtract the user in\xadfor\xadma\xadtion like the user\xadname from the ",Object(o.a)("inlineCode",{parentName:"p"},"IDToken")," ex\xadposed by the user ob\xadject via ",Object(o.a)("inlineCode",{parentName:"p"},'user.idToken().getString("preferred_username")'),".\nNote, there are many more claims like (name, email, give\xadnanme, fam\xadi\xadly\xadname etc.) avail\xadable. The ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://openid.net/specs/openid-connect-core-1_0.html#Claims"}),"OpenID Con\xadnect Core Spec\xadi\xadfi\xadca\xadtion")," con\xadtains a list of avail\xadable claims."),Object(o.a)("p",null,"We also gen\xader\xadate a list with links to the other pages which are sup\xadported:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"handleGreet"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n\n    OAuth2TokenImpl oAuth2Token = (OAuth2TokenImpl) ctx.user();\n\n    String username = oAuth2Token.idToken().getString(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"preferred_username"'),");\n\n    String greeting = String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>Hi %s @%s</h1><ul>"')," +\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<li><a href=\\"/protected/user\\">User Area</a></li>"')," +\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<li><a href=\\"/protected/admin\\">Admin Area</a></li>"')," +\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<li><a href=\\"/protected/userinfo\\">User Info (Remote Call)</a></li>"')," +\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"</ul>"'),", username, Instant.now());\n\n    String logoutForm = createLogoutForm(ctx);\n\n    respondWithOk(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", greeting + logoutForm);\n}\n")),Object(o.a)("p",null,"The user page han\xaddler shows in\xadfor\xadma\xadtion about the cur\xadrent user:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"handleUserPage"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n\n    OAuth2TokenImpl user = (OAuth2TokenImpl) ctx.user();\n\n    String username = user.idToken().getString(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"preferred_username"'),");\n    String displayName = oAuth2Token.idToken().getString(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"name"'),");\n\n    String content = String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>User Page: %s (%s) @%s</h1><a href=\\"/protected\\">Protected Area</a>"'),",\n                                   username, displayName, Instant.now());\n    respondWithOk(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", content);\n}\n")),Object(o.a)("h3",null,"Authorization: Checking for Required Roles"),Object(o.a)("p",null,"Our app ex\xadposes a sim\xadple admin page which shows some in\xadfor\xadma\xadtion for ad\xadmins, which should only be vis\xadi\xadble for ad\xadmins. Thus we re\xadquire that users must have the ",Object(o.a)("inlineCode",{parentName:"p"},"admin")," realm role in Key\xadcloak to be able to ac\xadcess the admin page."),Object(o.a)("p",null,"This is done via a call to ",Object(o.a)("inlineCode",{parentName:"p"},'user.isAuthorized("realm:admin", cb)'),". The han\xaddler func\xadtion ",Object(o.a)("inlineCode",{parentName:"p"},"cb")," ex\xadposes\nthe re\xadsult of the au\xadtho\xadriza\xadtion check via the ",Object(o.a)("inlineCode",{parentName:"p"},"AsyncResult<Boolean> res"),". If the cur\xadrent user has the\n",Object(o.a)("inlineCode",{parentName:"p"},"admin")," role then the re\xadsult is ",Object(o.a)("inlineCode",{parentName:"p"},"true")," oth\xader\xadwise ",Object(o.a)("inlineCode",{parentName:"p"},"false"),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"handleAdminPage"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n\n    OAuth2TokenImpl user = (OAuth2TokenImpl) ctx.user();\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),'// check for realm-role "admin"'),"\n    user.isAuthorized(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"realm:admin"'),", res -> {\n\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (!res.succeeded() || !res.result()) {\n            respondWith(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"403"),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>Forbidden</h1>"'),");\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return"),";\n        }\n\n        String username = user.idToken().getString(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"preferred_username"'),");\n\n        String content = String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>Admin Page: %s @%s</h1><a href=\\"/protected\\">Protected Area</a>"'),",\n                                        username, Instant.now());\n        respondWithOk(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", content);\n    });\n}\n")),Object(o.a)("h4",null,"Call Services protected with Bearer Token"),Object(o.a)("p",null,"Often we need to call other ser\xadvices from our web app that are pro\xadtected via Bearer Au\xadthen\xadti\xadca\xadtion. This means\nthat we need a valid ",Object(o.a)("inlineCode",{parentName:"p"},"access token")," to ac\xadcess a re\xadsource pro\xadvided on an\xadother server."),Object(o.a)("p",null,"To demon\xadstrate this we use Key\xadcloak\u2019s ",Object(o.a)("inlineCode",{parentName:"p"},"/userinfo")," end\xadpoint as a straw man to demon\xadstrate back\xadend calls with a bearer token."),Object(o.a)("p",null,"We can ob\xadtain the cur\xadrent valid ",Object(o.a)("inlineCode",{parentName:"p"},"access token")," via ",Object(o.a)("inlineCode",{parentName:"p"},"user.opaqueAccessToken()"),".\nSince we use a ",Object(o.a)("inlineCode",{parentName:"p"},"WebClient")," to call the pro\xadtected end\xadpoint, we need to pass the ",Object(o.a)("inlineCode",{parentName:"p"},"access token"),"\nvia the ",Object(o.a)("inlineCode",{parentName:"p"},"Authorization")," header by call\xading ",Object(o.a)("inlineCode",{parentName:"p"},"bearerTokenAuthentication(user.opaqueAccessToken())"),"\nin the cur\xadrent ",Object(o.a)("inlineCode",{parentName:"p"},"HttpRequest")," ob\xadject:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," Handler<RoutingContext> ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"createUserInfoHandler"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(WebClient webClient, String userInfoUrl)")," "),"{\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return")," (RoutingContext ctx) -> {\n\n        OAuth2TokenImpl user = (OAuth2TokenImpl) ctx.user();\n\n        URI userInfoEndpointUri = URI.create(userInfoUrl);\n        webClient\n            .get(userInfoEndpointUri.getPort(), userInfoEndpointUri.getHost(), userInfoEndpointUri.getPath())\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// use the access token for calls to other services protected via JWT Bearer authentication"),"\n            .bearerTokenAuthentication(user.opaqueAccessToken())\n            .as(BodyCodec.jsonObject())\n            .send(ar -> {\n\n                ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (!ar.succeeded()) {\n                    respondWith(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"500"),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"application/json"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"{}"'),");\n                    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return"),";\n                }\n\n                JsonObject body = ar.result().body();\n                respondWithOk(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"application/json"'),", body.encode());\n            });\n    };\n}\n")),Object(o.a)("h3",null,"Handle logout"),Object(o.a)("p",null,"Now that we got a work\xading SSO login with au\xadtho\xadriza\xadtion, it would be great if we would allow users to lo\xadgout again.\nTo do this we can lever\xadage the built-\u200bin OpenID Con\xadnect lo\xadgout func\xadtion\xadal\xadity which can be called via ",Object(o.a)("inlineCode",{parentName:"p"},"oAuth2Token.logout(cb)"),"."),Object(o.a)("p",null,"The han\xaddler func\xadtion ",Object(o.a)("inlineCode",{parentName:"p"},"cb")," ex\xadposes the re\xadsult of the lo\xadgout ac\xadtion via the ",Object(o.a)("inlineCode",{parentName:"p"},"AsyncResult<Void> res"),".\nIf the lo\xadgout was suc\xadcess\xadfull we destory our ses\xadsion via ",Object(o.a)("inlineCode",{parentName:"p"},"ctx.session().destroy()")," and redi\xadrect the user to the index page."),Object(o.a)("p",null,"The lo\xadgout form is gen\xader\xadated via the ",Object(o.a)("inlineCode",{parentName:"p"},"createLogoutForm")," method."),Object(o.a)("p",null,"As men\xadtioned ear\xadlier, we need to pro\xadtect our lo\xadgout form with a CSRF token to pre\xadvent ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://owasp.org/www-community/attacks/csrf"}),"CSRF at\xadtacks"),"."),Object(o.a)("p",null,"Note: If we had end\xadpoints that would ac\xadcept data sent to the server, then we\u2019d need to guard those end\xadpoints with an CSRF token as well."),Object(o.a)("p",null,"We need to ob\xadtain the gen\xader\xadated ",Object(o.a)("inlineCode",{parentName:"p"},"CSRFToken")," and ren\xadder it into a hid\xadden form input field that\u2019s trans\xadfered via HTTP POST when the lo\xadgout form is sub\xadmit\xadted:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"handleLogout"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n\n    OAuth2TokenImpl oAuth2Token = (OAuth2TokenImpl) ctx.user();\n    oAuth2Token.logout(res -> {\n\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (!res.succeeded()) {\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// the user might not have been logged out, to know why:"),"\n            respondWith(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"500"),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"text/html"'),", String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<h1>Logout failed %s</h1>"'),", res.cause()));\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return"),";\n        }\n\n        ctx.session().destroy();\n        ctx.response().putHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"location"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/?logout=true"'),").setStatusCode(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"302"),").end();\n    });\n}\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," String ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"createLogoutForm"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx)")," "),"{\n\n    String csrfToken = ctx.get(CSRFHandler.DEFAULT_HEADER_NAME);\n\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<form action=\\"/logout\\" method=\\"post\\">"'),"\n            + String.format(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<input type=\\"hidden\\" name=\\"%s\\" value=\\"%s\\">"'),", CSRFHandler.DEFAULT_HEADER_NAME, csrfToken)\n            + ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"<button>Logout</button></form>"'),";\n}\n")),Object(o.a)("p",null,"Some ad\xaddi\xadtional plumb\xading:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"respondWithOk"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx, String contentType, String content)")," "),"{\n    respondWith(ctx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"200"),", contentType, content);\n}\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"private")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"respondWith"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(RoutingContext ctx, ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"int")," statusCode, String contentType, String content)")," "),"{\n    ctx.request().response() ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"//"),"\n            .putHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"content-type"'),", contentType) ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"//"),"\n            .setStatusCode(statusCode)\n            .end(content);\n}\n")),Object(o.a)("h2",null,"More examples"),Object(o.a)("p",null,"This con\xadcludes the Key\xadcloak in\xadte\xadgra\xadtion ex\xadam\xadple."),Object(o.a)("p",null,"Check out the com\xadplete ex\xadam\xadple in ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/thomasdarimont/vertx-playground/tree/master/keycloak-vertx"}),"keycloak-\u200bvertx Ex\xadam\xadples Repo"),"."),Object(o.a)("p",null,"Thank you for your time, stay tuned for more up\xaddates! If you want to learn more about Key\xadcloak, feel free to reach out to me. You can find me via ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://twitter.com/thomasdarimont"}),"thomas\xadda\xadri\xadmont on twit\xadter"),"."),Object(o.a)("p",null,"Happy Hack\xading!"))}j.isMDXComponent=!0},"05nU":function(e,a,t){},"1T1L":function(e,a,t){"use strict";var n=t("Suba").keys().map((function(e){var a=e.match(/.\/([0-9]+-[0-9]+-[0-9]+)-(.*)\.mdx/);if(a[2].indexOf(".")>=0)throw"Invalid blog post filename: ".concat(e,". Dots '.' are not allowed.");return{filename:e.substring(2),date:a[1],slug:a[2]}}));n.sort((function(e,a){return new Date(a.date)-new Date(e.date)})),a.a=n},"7ljp":function(e,a,t){"use strict";t.d(a,"a",(function(){return O}));var n=t("q1tI"),s=t.n(n);function c(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function o(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){c(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},c=Object.keys(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}var p=s.a.createContext({}),i=function(e){var a=s.a.useContext(p),t=a;return e&&(t="function"===typeof e?e(a):o({},a,{},e)),t},j="mdxType",m={inlineCode:"code",wrapper:function(e){var a=e.children;return s.a.createElement(s.a.Fragment,{},a)}},b=Object(n.forwardRef)((function(e,a){var t=e.components,n=e.mdxType,c=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),j=i(t),b=n,O=j["".concat(r,".").concat(b)]||j[b]||m[b]||c;return t?s.a.createElement(O,o({ref:a},p,{components:t})):s.a.createElement(O,o({ref:a},p))}));function O(e,a){var t=arguments,n=a&&a.mdxType;if("string"===typeof e||n){var c=t.length,r=new Array(c);r[0]=b;var o={};for(var l in a)hasOwnProperty.call(a,l)&&(o[l]=a[l]);o.originalType=e,o[j]="string"===typeof e?e:n,r[1]=o;for(var p=2;p<c;p++)r[p]=t[p];return s.a.createElement.apply(null,r)}return s.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"},BSOW:function(e,a,t){"use strict";var n=t("q1tI"),s=t.n(n),c=t("YFqc"),r=t.n(c),o=(t("ZKd4"),s.a.createElement);a.a=function(){return o("div",{className:"blog-navbar"},o("h2",null,"Blog"),o("ul",null,o("li",null,o(r.a,{href:"/blog/"},o("a",null,"All posts"))),o("li",null,o("a",{href:"#"},"Releases")),o("li",null,o("a",{href:"#"},"Guides")),o("li",null,o("a",{href:"#"},"User stories"))))}},CGsS:function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Eclipse Vert.x for Scala next steps",category:"guides",authors:[{name:"Jochen Mader",github_id:"codepitbull"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Scala for Eclipse Vert.x: The next steps"),Object(o.a)("h2",null,"TL;DR"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"No Scala 2.13 in Eclipse Vert.x 3.x due to in\xadcreased sup\xadport bur\xadden"),Object(o.a)("li",{parentName:"ul"},"New value classes based ap\xadproach for Vert.x 4")),Object(o.a)("h2",null,"Retrospective"),Object(o.a)("p",null,"It\u2019s been more than two years since the in\xadcep\xadtion of ",Object(o.a)("inlineCode",{parentName:"p"},"vert-lang-scala")," to the Vert.x ecosys\xadtem. And al\xadmost as long since I wrote my first ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/blog/scala-is-here/"}),"blog post")," about it."),Object(o.a)("p",null,"A lot has hap\xadpened since March 2017:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"vertx-lang-scala")," kept up with new ver\xadsions of Scala"),Object(o.a)("li",{parentName:"ul"},"all Vert.x-\u200bmodules are sup\xadported (35 so far)"),Object(o.a)("li",{parentName:"ul"},"a Giter8 based ",Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vert-x3/vertx-scala.g8"}),"tem\xadplate")," was added for eas\xadily boot\xadstrap\xadping a Vert.x-\u200bScala-project"),Object(o.a)("li",{parentName:"ul"},"Bugs were squashed")),Object(o.a)("p",null,"And most re\xadcently we re\xadceived a great con\xadtri\xadbu\xadtion by ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/NikolajLeischner"}),"Niko\xadlaj Leis\xadchner")," who was kind enough to port the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/TechEmpower/FrameworkBenchmarks/tree/master/frameworks/Scala/vertx-web-scala"}),"techempow\xadered")," bench\xadmark to vert-\u200blang-scala. Which will be part of the next steps."),Object(o.a)("p",null,"The num\xadbers pro\xadduced by this bench\xadmark were very promis\xading and and ad\xaddi\xadtional mo\xadti\xadva\xadtion to move to the next phase of Scala sup\xadport for Vert.x."),Object(o.a)("h2",null,"Old idea"),Object(o.a)("p",null,"Be\xadfore get\xadting to the new ideas I want to take a look at the \u201cold\u201d one."),Object(o.a)("p",null,"The cur\xadrent ver\xadsion of vert-\u200blang-scala is based around the idea of wrap\xadping the Vert.x-API with a ded\xadi\xadcated Scala-\u200blayer. That layer is cre\xadated using a Freemarker-\u200bbased code gen\xader\xada\xadtor. I took this idea from the first try by Tim Fox for build\xading that sup\xadport."),Object(o.a)("p",null,"Wrap\xadping the ex\xadist\xading Java-\u200bAPI was rather painful but gave me great flex\xadi\xadbil\xadity to cre\xadate an id\xadiomatic Scala-\u200bAPI."),Object(o.a)("p",null,"But an ap\xadproach like that comes with a price:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"There are a lot of in\xadter\xadme\xaddi\xadate ob\xadjects being cre\xadated."),Object(o.a)("li",{parentName:"ul"},"Many un\xadnec\xadces\xadsary con\xadver\xadsions be\xadtween Java/Scala types")),Object(o.a)("p",null,"Both in\xadcreased mem\xadory con\xadsump\xadtion and garbage col\xadlec\xadtion ac\xadtiv\xadity quite a bit and has been bug\xadging me from the be\xadgin\xadning."),Object(o.a)("h2",null,"New idea"),Object(o.a)("p",null,"With Vert.x 4 ap\xadproach\xading I was fi\xadnally able to in\xadvest time into the re\xadwork I had wanted to do for quite a while."),Object(o.a)("p",null,"The core idea is to re\xadplace the cur\xadrent wrap\xadping based ap\xadproach with some\xadthing more light\xadweight but na\xadtive to the Scala-\u200bworld."),Object(o.a)("p",null,"And that\u2019s where ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://docs.scala-lang.org/overviews/core/value-classes.html"}),"value classes")," come in."),Object(o.a)("p",null,"Value classes allow the ex\xadten\xadsion of ex\xadist\xading classes with ad\xaddi\xadtional meth\xadods. They make it easy to con\xadtrol ",Object(o.a)("strong",{parentName:"p"},"when")," meth\xadods be\xadcome vis\xadi\xadble and do that with a min\xadi\xadmum of over\xadhead. To be pre\xadcise: A wrap\xadping class is nor\xadmally ever only in\xadstan\xadti\xadated ",Object(o.a)("strong",{parentName:"p"},"once"),"."),Object(o.a)("p",null,"A good ex\xadam\xadple is the ad\xaddi\xadtion of meth\xadods for wrap\xadping the Vert.x ap\xadproach of Promises with Scala-\u200bFutures. Each method re\xadturn\xading a Vert.x-\u200bPromise needs to re\xadceive an al\xadter\xadna\xadtive ver\xadsion which re\xadturns a Scala-\u200bFuture."),Object(o.a)("p",null,"In Vert.x 3 I achieved that by adding meth\xadods to the wrap\xadper and giv\xading them a dis\xadtinct name. A method called ",Object(o.a)("strong",{parentName:"p"},"lis\xadten")," re\xadturn\xading a Promise would re\xadceive a com\xadpan\xadion called ",Object(o.a)("strong",{parentName:"p"},"lis\xadten\xadFu\xadture")," in the Scala layer."),Object(o.a)("p",null,"Let\u2019s look at how this looks in the new ap\xadproach:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-scala"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"package")," io.vertx.scala\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"package")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"object")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"core")),"{\n   ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"implicit")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"class")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"HttpServerScala"),"(",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"val asJava: io.vertx.core.http.",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-type"}),"HttpServer")),") ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"extends")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"AnyVal")," "),"{\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"def")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"listenFuture")),"(port: java.lang.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Integer"),"): scala.concurrent.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Future"),"[io.vertx.core.http.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"HttpServer"),"] = {..}\n      ..\n}\n")),Object(o.a)("p",null,"The code above does the fol\xadlow\xading things:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"It cre\xadates a pack\xadage ob\xadject for ",Object(o.a)("strong",{parentName:"li"},"io.vertx.scala.core")),Object(o.a)("li",{parentName:"ul"},"it adds an im\xadplict class ",Object(o.a)("strong",{parentName:"li"},"HttpServer\xadScala")," to wrpa ",Object(o.a)("strong",{parentName:"li"},"HttpServer")),Object(o.a)("li",{parentName:"ul"},"it adds a ",Object(o.a)("strong",{parentName:"li"},"lis\xadten\xadFu\xadture")," method")),Object(o.a)("p",null,"Using this method in code looks like this:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-scala"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"package")," io.vertx.scala.demo\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," io.vertx.lang.scala.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"VertxExecutionContext"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," io.vertx.scala.core._\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," scala.util.{",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Failure"),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Success"),"}\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"object")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"Main")," "),"{\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"def")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"main")),"(args: ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Array"),"[",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"String"),"]): ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Unit")," = {\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"val")," vertx = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Vertx"),".vertx()\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"implicit")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"val")," ec = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"VertxExecutionContext"),"(vertx.getOrCreateContext())\n    vertx\n      .createHttpServer()\n      .requestHandler(r => {\n        r.response().end(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"bye"'),")\n      })\n      .listenFuture(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"6667"),")\n      .onComplete {\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"case")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Success"),"(_) => println(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Started"'),")\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"case")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-type"}),"Failure"),"(exception) => println(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Failure"'),")\n      }\n  }\n}\n")),Object(o.a)("p",null,"Im\xadport\xading the pack\xadage ob\xadject using ",Object(o.a)("strong",{parentName:"p"},"im\xadport io.vertx.scala.core._")," brings the ex\xadten\xadsion method into scope and makes them avail\xadable on all in\xadstances of ",Object(o.a)("strong",{parentName:"p"},"HttpServer"),". In the ex\xadam\xadple above ",Object(o.a)("strong",{parentName:"p"},"cre\xadate\xadHttpServer()")," re\xadturn such an in\xadstance and we can now use the id\xadiomatic Scala way of han\xaddling a Fu\xadture."),Object(o.a)("h3",null,"Even more"),Object(o.a)("p",null,"Ex\xadtend\xading classes with Future-\u200bmethods is only one of the new things to come. On top of that the sup\xadport for DataOb\xadjects will be con\xadsid\xader\xadably im\xadproved, both through ex\xadtend\xading them and by pro\xadvid\xading type aliases."),Object(o.a)("p",null,"I also switched from doing all con\xadver\xadsions for col\xadlec\xadtions au\xadto\xadmat\xadi\xadcally to hand\xading the con\xadtrol back to the user. Some\xadthing which gets even more im\xadpor\xadtant for Scala 2.13 and the new col\xadlec\xadtion API."),Object(o.a)("h3",null,"The downside"),Object(o.a)("p",null,"The clear down\xadside of this ap\xadproach is that the Java-\u200bmethods will stay vis\xadi\xadble since the java-\u200bclasses won\u2019t be wrapped but ex\xadtended. This might lead to some con\xadfu\xadsion but I am pretty sure the ben\xade\xadfits out\xadweight this down\xadside."),Object(o.a)("p",null,"The big\xadger change will be the re\xadmoval of au\xadto\xadmatic von\xadver\xadsion be\xadtween Scala types (Long/Int/String and  Col\xadlec\xadtions) and their Java coun\xadter\xadparts. I spent con\xadsid\xader\xadable time try\xading to tune that part in the cur\xadrent ver\xadsion bbut al\xadways ended up hit\xadting some edge\xadcase. For now I\u2019ve de\xadcided to have the user pick the right time to con\xadvert."),Object(o.a)("p",null,"I might still add this fea\xadture in a later ver\xadsion if user feed\xadback points into that di\xadrec\xadtion."),Object(o.a)("h2",null,"When will I get it?"),Object(o.a)("p",null,"First for the good news: There is al\xadready a ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/vertx-lang-scala/tree/4.0"}),"branch")," with a full im\xadple\xadmen\xadta\xadtion."),Object(o.a)("p",null,"The bad news: It will break until Vert.x 4.0 is fi\xadnally re\xadleased."),Object(o.a)("p",null,"Vert.x 4 is in ac\xadtive de\xadvel\xadop\xadment with most APIs al\xadready fi\xadnal\xadized but break\xading changes still hap\xadpen. So use at your own risk!"),Object(o.a)("h2",null,"What about Scala 2.13?"),Object(o.a)("p",null,"Scala 2.13 has been re\xadleased re\xadcently which prompted ques\xadtions from the com\xadmu\xadnity about when it will be sup\xadported by Vert.x."),Object(o.a)("p",null,"I haven\u2019t done a good job pro\xadvid\xading the re\xadsults of our in\xadter\xadnal dis\xadcus\xadsions on that topic to the com\xadmu\xadnity. So here we go:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"Vert.x 3 will stay on 2.12 for the fol\xadlow\xading rea\xadsons:",Object(o.a)("ul",{parentName:"li"},Object(o.a)("li",{parentName:"ul"},"Both are still ac\xadtively sup\xadported"),Object(o.a)("li",{parentName:"ul"},"Scala ecosys\xadtems takes some time to do the switch to 2.13"),Object(o.a)("li",{parentName:"ul"},"We sim\xadply don\u2019t have the ca\xadpac\xadity to sup\xadport both ver\xadsions ",Object(o.a)("strong",{parentName:"li"},"AND")," the up\xadcom\xading new ver\xadsion"))),Object(o.a)("li",{parentName:"ul"},"Vert.x 4 will re\xadceive 2.13 sup\xadport",Object(o.a)("ul",{parentName:"li"},Object(o.a)("li",{parentName:"ul"},"Scala ecosys\xadtem will have moved closer to 2.13 adop\xadtion when Vert.x 4 comes out")))),Object(o.a)("h2",null,"For the adventure seaker"),Object(o.a)("p",null,"I ac\xadtu\xadally did a port of vertx-\u200blang-scala 3.8 to Scala 2.13 and you can grab the work in this ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/vertx-lang-scala/tree/3.8_2.13"}),"branch"),"."),Object(o.a)("p",null,"Don\u2019t ex\xadpect ",Object(o.a)("strong",{parentName:"p"},"ANY")," sup\xadport for this branch. This was only an ex\xadper\xadi\xadment to see how much I had to change for ini\xadtial 2.13 sup\xadport."),Object(o.a)("h2",null,"Summary"),Object(o.a)("p",null,"Vert.x 4 will be an evo\xadlu\xadtion\xadary step for vertx-\u200blang-scala. Value classes promise to re\xadduce both com\xadplex\xadity and al\xadlo\xadca\xadtion rate, two things which have been bug\xadging me quite a bit with the cur\xadrent ap\xadproach."),Object(o.a)("p",null,"I am eager to hear from you all what you think about this new di\xadrec\xadtion."))}j.isMDXComponent=!0},Ff2n:function(e,a,t){"use strict";function n(e,a){if(null==e)return{};var t,n,s=function(e,a){if(null==e)return{};var t,n,s={},c=Object.keys(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||(s[t]=e[t]);return s}(e,a);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)t=c[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(s[t]=e[t])}return s}t.d(a,"a",(function(){return n}))},"M+IC":function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Eclipse Vert.x 3.8.5",category:"releases",authors:[{name:"Julien Viet",github_id:"vietj"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Eclipse Vert.x 3.8.5"),Object(o.a)("p",null,"We have just re\xadleased Vert.x 3.8.5, a bug fix re\xadlease of Vert.x 3.8.x."),Object(o.a)("p",null,"Since the re\xadlease of Vert.x 3.8.5, quite a few bugs have been re\xadported. We would like to thank you all for re\xadport\xading these is\xadsues."),Object(o.a)("p",null,"Vert.x 3.8.5 dep\xadre\xadca\xadtions and break\xading changes"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vert-x3/wiki/wiki/3.8.5-Deprecations-and-breaking-changes"}),"https://github.com/vert-\u200bx3/wiki/wiki/3.8.5-\u200bDeprecations-and-breaking-changes"))),Object(o.a)("p",null,"Vert.x 3.8.5 re\xadlease notes"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vert-x3/wiki/wiki/3.8.5-Release-Notes"}),"https://github.com/vert-\u200bx3/wiki/wiki/3.8.5-\u200bRelease-Notes"))),Object(o.a)("p",null,"The ar\xadti\xadfacts have been de\xadployed to ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vertx%22%20AND%20v%3A%223.8.%22"}),"Maven Cen\xadtral")," and you can get the dis\xadtri\xadb\xadu\xadtion on ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://bintray.com/vertx/downloads/distribution/3.8.4/view"}),"Bin\xadtray"),"."),Object(o.a)("p",null,"You can boot\xadstrap a Vert.x 3.8.5 project using ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://start.vertx.io"}),"https://start.vertx.io"),"."),Object(o.a)("p",null,"The event bus client using the SockJS bridge are avail\xadable from NPM, Bower and as a We\xadb\xadJar:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://www.npmjs.com/package/vertx3-eventbus-client"}),"https://www.npmjs.com/pack\xadage/vertx3-\u200beventbus-client")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vert-x3/vertx-bus-bower"}),"https://github.com/vert-\u200bx3/vertx-\u200bbus-bower")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"http://www.webjars.org/"}),"http://www.we\xadb\xadjars.org/"))),Object(o.a)("p",null,"Docker im\xadages are also avail\xadable on the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/u/vertx/"}),"Docker Hub"),". The Vert.x dis\xadtri\xadb\xadu\xadtion is also avail\xadable from ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://sdkman.io/index.html"}),"SD\xadKMan")," and ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://brew.sh/"}),"Home\xadBrew"),"."),Object(o.a)("p",null,"Happy cod\xading and see you soon on our user or dev ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/community"}),"chan\xadnels"),"."))}j.isMDXComponent=!0},Suba:function(e,a,t){var n={"./2018-12-13-vertx-web-api-service.mdx":"ZJXT","./2019-08-30-eclipse-vertx-for-scala-next-steps.mdx":"CGsS","./2019-10-22-vertx-junit5-web-client.mdx":"aMnG","./2020-01-24-vertx-3-8-5-release.mdx":"M+IC","./2020-03-16-easy-sso-for-vertx-with-keycloak.mdx":"+aIQ","./2020-04-02-vertx-3-9-0-release.mdx":"yb6C"};function s(e){var a=c(e);return t(a)}function c(e){if(!t.o(n,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=c,e.exports=s,s.id="Suba"},UMc4:function(e,a,t){"use strict";var n=t("q1tI"),s=t.n(n),c=t("TSYQ"),r=t.n(c),o=t("Cgje"),l=t("naWs"),p=(t("05nU"),s.a.createElement);a.a=function(e){var a=e.meta,t=void 0===a?{}:a,n=e.narrow,s=e.children;return p("main",{className:"page"},p(o.a,{title:t.title}),p("div",{className:"page-content"},p("div",{className:r()("container",{"container-narrow":n})},s)),p(l.a,null))}},YUBE:function(e,a,t){"use strict";var n=t("q1tI"),s=t.n(n),c=s.a.createElement;a.a=function(e){var a=e.date,t=new Intl.DateTimeFormat("en",{year:"numeric",month:"long",day:"numeric"}).formatToParts(new Date(a)),n=t.find((function(e){return"day"===e.type})).value+" "+t.find((function(e){return"month"===e.type})).value+" "+t.find((function(e){return"year"===e.type})).value;return c(s.a.Fragment,null,n)}},ZJXT:function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Vert.x Web API Service Introduction",category:"guides",authors:[{name:"Francesco Guardiani",github_id:"slinkydeveloper"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Vert.x Web API Service"),Object(o.a)("p",null,"Vert.x 3.6 in\xadtro\xadduces a new mod\xadule called ",Object(o.a)("inlineCode",{parentName:"p"},"vertx-web-api-service"),". With the new Web API Ser\xadvices you can eas\xadily com\xadbine the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-web/java/"}),"Vert.x Web Router")," and the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-web-api-contract/java/"}),"Vert.x Ope\xadnAPI Router Fac\xadtory")," fea\xadtures with ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-service-proxy/java/"}),"Vert.x Ser\xadvices on Event Bus"),"."),Object(o.a)("h2",null,"Small recap on OpenAPI and Vert.x Web API Contract"),Object(o.a)("p",null,"Let\u2019s start from this Ope\xadnAPI de\xadf\xadi\xadn\xadi\xadtion:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-yaml"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"openapi:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"3.0"),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),".0"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"paths:"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"/api/transactions:"),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"get:"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"operationId:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"getTransactionsList"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"description:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"Get")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactions")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"list")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"filtered")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"by")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"sender"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"x-vertx-event-bus:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactions_manager.myapp"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"parameters:"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-bullet"}),"-")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"name:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"from"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"in:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"query"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"description:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"Matches")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"exactly")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"the")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"email")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"from"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"style:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"form"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"explode:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-literal"}),"false"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"schema:"),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"type:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"array"),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"items:"),"\n              ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"type:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"string"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"responses:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"post:"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"operationId:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"addTransaction"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"x-vertx-event-bus:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactions_manager.myapp"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"requestBody:"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"required:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-literal"}),"true"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"content:"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"application/json:"),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"schema:"),"\n              ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"$ref:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"#/components/schemas/Transaction"'),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"responses:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"/api/transactions/{transactionId}:"),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"parameters:"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-bullet"}),"-")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"name:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactionId"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"in:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"path"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"required:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-literal"}),"true"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"schema:"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"type:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"string"),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"put:"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"operationId:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"updateTransaction"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"x-vertx-event-bus:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactions_manager.myapp"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"requestBody:"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"required:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-literal"}),"true"),"\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"content:"),"\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"application/json:"),"\n            ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"schema:"),"\n              ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"$ref:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"#/components/schemas/Transaction"'),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"responses:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"delete:"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"operationId:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"removeTransaction"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"x-vertx-event-bus:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"transactions_manager.myapp"),"\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"responses:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"components:"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"schemas:"),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"Transaction:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-attr"}),"Error:")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),"..."),"\n")),Object(o.a)("p",null,"We de\xadfined ",Object(o.a)("inlineCode",{parentName:"p"},"getTransactionsList"),", ",Object(o.a)("inlineCode",{parentName:"p"},"addTransaction"),", ",Object(o.a)("inlineCode",{parentName:"p"},"updateTransaction")," and ",Object(o.a)("inlineCode",{parentName:"p"},"removeTransaction")," op\xader\xada\xadtions. Now with ",Object(o.a)("inlineCode",{parentName:"p"},"OpenAPI3RouterFactory")," we cre\xadate a ",Object(o.a)("inlineCode",{parentName:"p"},"Router")," that ac\xadcepts this var\xadi\xadous op\xader\xada\xadtion re\xadquests:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"OpenAPI3RouterFactory.create(vertx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"src/main/resources/petstore.yaml"'),", ar -> {\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (ar.succeeded()) {\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Spec loaded with success"),"\n    OpenAPI3RouterFactory routerFactory = ar.result();\n    routerFactory.addHandlerByOperationId(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"getTransactionsList"'),", routingContext -> {\n      RequestParameters params = routingContext.get(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"parsedParameters"'),");\n      RequestParameter from = params.queryParameter(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"from"'),");\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// getTransactionsList business logic"),"\n    });\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// add handlers for addTransaction, updateTransaction and removeTransaction"),"\n    Router router = routerFactory.getRouter();\n  } ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"else")," {\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Something went wrong during router factory initialization"),"\n    Throwable exception = ar.cause();\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Log exception, fail verticle deployment ... etc"),"\n  }\n});\n")),Object(o.a)("p",null,"The ",Object(o.a)("inlineCode",{parentName:"p"},"OpenAPI3RouterFactory")," pro\xadvides an easy way to cre\xadate a spec\xadi\xadfi\xadca\xadtion com\xadpli\xadant ",Object(o.a)("inlineCode",{parentName:"p"},"Router"),", but it doesn\u2019t pro\xadvide a mech\xada\xadnism to de\xadcou\xadple the busi\xadness logic from your op\xader\xada\xadtion han\xaddlers."),Object(o.a)("p",null,"In a typ\xadi\xadcal Vert.x ap\xadpli\xadca\xadtion, when you re\xadceive a re\xadquest to your router, you would for\xadward it to an event bus end\xadpoint that per\xadforms some ac\xadtions and sends the re\xadsult back to the op\xader\xada\xadtion han\xaddler."),Object(o.a)("p",null,"Vert.x Web API Ser\xadvice sim\xadpli\xadfies that in\xadte\xadgra\xadtion be\xadtween ",Object(o.a)("inlineCode",{parentName:"p"},"RouterFactory")," and ",Object(o.a)("inlineCode",{parentName:"p"},"EventBus")," with a new code gen\xader\xada\xadtor. The final re\xadsult is a ",Object(o.a)("em",{parentName:"p"},"loose cou\xadpling")," be\xadtween the Web Router logic and your busi\xadness logic."),Object(o.a)("h2",null,"Let\u2019s get started with Vert.x Web Api Services!"),Object(o.a)("p",null,"To use ",Object(o.a)("inlineCode",{parentName:"p"},"vertx-web-api-service")," you need to add a cou\xadple of de\xadpen\xadden\xadcies to your project. In a Maven POM file that would be:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-xml"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"dependency"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"groupId"),">"),"io.vertx",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"groupId"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"artifactId"),">"),"vertx-codegen",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"artifactId"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"version"),">"),"3.6.0",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"version"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"classifier"),">"),"processor",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"classifier"),">"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"dependency"),">"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"dependency"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"groupId"),">"),"io.vertx",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"groupId"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"artifactId"),">"),"vertx-web-api-service",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"artifactId"),">"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"<",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"version"),">"),"3.6.0",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"version"),">"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-tag"}),"</",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-name"}),"dependency"),">"),"\n")),Object(o.a)("p",null,"We will pro\xadceed in this order:"),Object(o.a)("ol",null,Object(o.a)("li",{parentName:"ol"},"Model the ser\xadvice in\xadter\xadface"),Object(o.a)("li",{parentName:"ol"},"Rewrite it to work with Web Api Ser\xadvices"),Object(o.a)("li",{parentName:"ol"},"Im\xadple\xadment the ser\xadvice"),Object(o.a)("li",{parentName:"ol"},"Mount the ser\xadvice on the event bus"),Object(o.a)("li",{parentName:"ol"},"Use the router fac\xadtory to build a router with han\xaddlers that con\xadnects to our event bus ser\xadvices")),Object(o.a)("h2",null,"Model your service"),Object(o.a)("p",null,"Let\u2019s say that we want to model a ser\xadvice that man\xadages all op\xader\xada\xadtions re\xadgard\xading CRUD trans\xadac\xadtions. An ex\xadam\xadple in\xadter\xadface for this asyn\xadchro\xadnous ser\xadvice could be:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"interface")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"TransactionsManagerService")," "),"{\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"getTransactionsList"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(List<String> from, Handler<AsyncResult<List<Transaction>>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"addTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(Transaction transaction, Handler<AsyncResult<Transaction>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"updateTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(String transactionId, Transaction transaction, Handler<AsyncResult<Transaction>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"removeTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(String transactionId, Handler<AsyncResult<Integer>> resultHandler)")),";\n}\n")),Object(o.a)("p",null,"For each op\xader\xada\xadtion, we have some pa\xadra\xadme\xadters, de\xadpend\xading on the op\xader\xada\xadtion, and a call\xadback (",Object(o.a)("inlineCode",{parentName:"p"},"resultHandler"),") that should be called when the op\xader\xada\xadtion suc\xadceeds or fails."),Object(o.a)("p",null,"With ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-service-proxy/java/"}),"Vert.x Ser\xadvice Proxy"),", you can de\xadfine an event bus ser\xadvice with a Java in\xadter\xadface sim\xadi\xadlar to the one we just saw and then an\xadno\xadtate it with ",Object(o.a)("inlineCode",{parentName:"p"},"@ProxyGen"),". This an\xadno\xadta\xadtion will gen\xader\xadate a ",Object(o.a)("em",{parentName:"p"},"ser\xadvice han\xaddler")," for the de\xadfined ser\xadvice that can be plugged to the event bus with ",Object(o.a)("inlineCode",{parentName:"p"},"ServiceBinder"),". ",Object(o.a)("inlineCode",{parentName:"p"},"vertx-web-api-service")," works in a very sim\xadi\xadlar way: you need to an\xadno\xadtate the Java in\xadter\xadface with ",Object(o.a)("inlineCode",{parentName:"p"},"@WebApiServiceGen")," and it will gen\xader\xadate the ser\xadvice han\xaddler for the event bus."),Object(o.a)("p",null,"Let\u2019s rewrite the ",Object(o.a)("inlineCode",{parentName:"p"},"TransactionsManagerService")," to work with Web API Ser\xadvice:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," io.vertx.ext.web.api.*;\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," io.vertx.ext.web.api.generator.WebApiServiceGen;\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-meta"}),"@WebApiServiceGen"),"\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"interface")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"TransactionsManagerService")," "),"{\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"getTransactionsList"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(List<String> from, OperationRequest context, Handler<AsyncResult<OperationResponse>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"addTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(Transaction body, OperationRequest context, Handler<AsyncResult<OperationResponse>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"updateTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(String transactionId, Transaction body, OperationRequest context, Handler<AsyncResult<OperationResponse>> resultHandler)")),";\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"removeTransaction"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(String transactionId, OperationRequest context, Handler<AsyncResult<OperationResponse>> resultHandler)")),";\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Factory method to instantiate the implementation"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"static")," TransactionsManagerService ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"create"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(Vertx vertx)")," "),"{\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"return")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," TransactionsManagerServiceImpl(vertx);\n  }\n}\n\n")),Object(o.a)("p",null,"First of all, look at the an\xadno\xadta\xadtion ",Object(o.a)("inlineCode",{parentName:"p"},"@WebApiServiceGen"),". This an\xadno\xadta\xadtion will trig\xadger the code gen\xader\xada\xadtor that gen\xader\xadates the event bus han\xaddler for this ser\xadvice. Each method has the same two last pa\xadra\xadme\xadters:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"OperationRequest context"),": this data ob\xadject con\xadtains the head\xaders and the pa\xadra\xadme\xadters of the HTTP re\xadquest"),Object(o.a)("li",{parentName:"ul"},Object(o.a)("inlineCode",{parentName:"li"},"Handler<AsyncResult<OperationResponse>> resultHandler"),": this call\xadback ac\xadcepts an ",Object(o.a)("inlineCode",{parentName:"li"},"OperationResponse")," data ob\xadject that will en\xadcap\xadsu\xadlate the body of the re\xadsult, the sta\xadtus code, the sta\xadtus mes\xadsage and the head\xaders")),Object(o.a)("p",null,"The gen\xader\xadated han\xaddler re\xadceives only the ",Object(o.a)("inlineCode",{parentName:"p"},"OperationRequest")," data ob\xadject and ex\xadtracts from it all op\xader\xada\xadtion pa\xadra\xadme\xadters. For ex\xadam\xadple, when the router re\xadceives a re\xadquest at ",Object(o.a)("inlineCode",{parentName:"p"},"getTransactionsList"),", it sends to ",Object(o.a)("inlineCode",{parentName:"p"},"TransactionsManagerService")," the ",Object(o.a)("inlineCode",{parentName:"p"},"OperationRequest")," con\xadtain\xading the ",Object(o.a)("inlineCode",{parentName:"p"},"RequestParameters")," map. From this map, the ser\xadvice gen\xader\xadated han\xaddler ex\xadtracts the ",Object(o.a)("inlineCode",{parentName:"p"},"from")," pa\xadra\xadme\xadter. "),Object(o.a)("p",null,"There\xadfore ",Object(o.a)("strong",{parentName:"p"},"op\xader\xada\xadtion pa\xadra\xadme\xadters names should match method pa\xadra\xadme\xadter names"),"."),Object(o.a)("p",null,"When you want to ex\xadtract the body you must use ",Object(o.a)("inlineCode",{parentName:"p"},"body")," key\xadword. For more de\xadtails, please refer to the ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-web-api-service/java/"}),"doc\xadu\xadmen\xadta\xadtion"),"."),Object(o.a)("h2",null,"Implement the service"),Object(o.a)("p",null,"Now that you have your in\xadter\xadface, you can im\xadple\xadment the ser\xadvice:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"class")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"TransactionsManagerServiceImpl")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"implements")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"TransactionsManagerService")," "),"{\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"private")," Vertx vertx;\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"TransactionsManagerServiceImpl"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(Vertx vertx)")," "),"{  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),".vertx = vertx;  }\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-meta"}),"@Override"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"getTransactionsList"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(List<String> from, OperationRequest context, Handler<AsyncResult<OperationResponse>> resultHandler)")),"{\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Write your business logic here"),"\n    resultHandler.handle(Future.succeededFuture(OperationResult.completedWithJson(resultJson)));\n  }\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Implement other operations"),"\n\n}\n")),Object(o.a)("p",null,"Check the ",Object(o.a)("inlineCode",{parentName:"p"},"OperationResult")," doc\xadu\xadmen\xadta\xadtion to look at var\xadi\xadous handy meth\xadods to cre\xadate a com\xadplete re\xadsponse."),Object(o.a)("h2",null,"Mount the Service"),Object(o.a)("p",null,"Now that you have your ser\xadvice in\xadter\xadface and im\xadple\xadmen\xadta\xadtion, you can mount your ser\xadvice with ",Object(o.a)("inlineCode",{parentName:"p"},"ServiceBinder"),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"ServiceBinder serviceBinder = ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," ServiceBinder(vertx);\n\nTransactionsManagerService transactionsManagerService = TransactionsManagerService.create(vertx);\nregisteredConsumers.add(\n  serviceBinder\n    .setAddress(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"transactions_manager.myapp"'),")\n    .register(TransactionsManagerService",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),".",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"class"),", ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"transactionsManagerService"),")\n)"),";\n")),Object(o.a)("h2",null,"And the Router Factory?"),Object(o.a)("p",null,"The ser\xadvice is up and run\xadning, but we need to con\xadnect it to the ",Object(o.a)("inlineCode",{parentName:"p"},"Router")," built by ",Object(o.a)("inlineCode",{parentName:"p"},"OpenAPI3RouterFactory"),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"OpenAPI3RouterFactory.create(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"this"),".vertx, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"my_spec.yaml"'),", openAPI3RouterFactoryAsyncResult -> {\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (openAPI3RouterFactoryAsyncResult.succeeded()) {\n    OpenAPI3RouterFactory routerFactory = openAPI3RouterFactoryAsyncResult.result();\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Mount services on event bus based on extensions"),"\n    routerFactory.mountServicesFromExtensions(); ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// <- Pure magic happens!"),"\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Generate the router"),"\n    Router router = routerFactory.getRouter();\n    server = vertx.createHttpServer(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," HttpServerOptions().setPort(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"8080"),"));\n    server.requestHandler(router).listen();\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Initialization completed"),"\n  } ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"else")," {\n    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Something went wrong during router factory initialization"),"\n  }\n});\n")),Object(o.a)("p",null,"In our spec ex\xadam\xadple we added an ex\xadten\xadsion ",Object(o.a)("inlineCode",{parentName:"p"},"x-vertx-event-bus")," to each op\xader\xada\xadtion that spec\xadi\xadfies the ad\xaddress of the ser\xadvice. Using this ex\xadten\xadsion, you only need to call ",Object(o.a)("inlineCode",{parentName:"p"},"OpenAPI3RouterFactory.mountServicesFromExtensions()")," to trig\xadger a scan of all op\xader\xada\xadtions and mount all found ser\xadvice ad\xaddresses. For each op\xader\xada\xadtion that con\xadtains ",Object(o.a)("inlineCode",{parentName:"p"},"x-vertx-event-bus"),", the Router Fac\xadtory in\xadstan\xadti\xadates an han\xaddler that routes the in\xadcom\xading re\xadquests to the ad\xaddress you spec\xadi\xadfied."),Object(o.a)("p",null,"This is one of the meth\xadods you can use to match ser\xadvices with router op\xader\xada\xadtion han\xaddlers. Check the doc\xadu\xadmen\xadta\xadtion for all de\xadtails."),Object(o.a)("h2",null,"More examples"),Object(o.a)("p",null,"Check out the com\xadplete ex\xadam\xadple in ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/vertx-examples/tree/master/web-api-service-example"}),"vertx-\u200bexamples repo"),"."),Object(o.a)("p",null,"Thanks you for your time, stay tuned for more up\xaddates! And please pro\xadvide feed\xadback about this new pack\xadage!"))}j.isMDXComponent=!0},ZKd4:function(e,a,t){},aMnG:function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Send web requests and assert results with vertx-junit5-web-client",category:"guides",authors:[{name:"Francesco Guardiani",github_id:"slinkydeveloper"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Send web requests and assert results with vertx-junit5-web-client"),Object(o.a)("p",null,"In last Vert.x 3.8 re\xadlease we added a new mod\xadule called ",Object(o.a)("inlineCode",{parentName:"p"},"vertx-junit5-web-client"),", that brings ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-web-client/java/"}),"Vert.x Web Client")," in\xadjec\xadtion\ninto tests and pro\xadvides an API called ",Object(o.a)("inlineCode",{parentName:"p"},"TestRequest")," to sim\xadplify the cre\xadation and as\xadser\xadtions on ",Object(o.a)("inlineCode",{parentName:"p"},"WebClient")," re\xadquests:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-d"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"static")," io.vertx.junit5.web.TestRequest.*;\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"@ExtendWith"),"({\n  VertxExtension.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"class"),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// VertxExtension MUST be configured before VertxWebClientExtension"),"\n  VertxWebClientExtension.",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"class"),"\n})\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"class")," TestRequestExample {\n\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"@Test"),"\n  ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"void")," test1(WebClient client, VertxTestContext testContext) {\n    testRequest(client, HttpMethod.GET, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/hello"'),") ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Build the request"),"\n      .",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"with"),"(\n        queryParam(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"name"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"francesco"'),"), ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Add query param"),"\n        requestHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"foo"'),") ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Add request header"),"\n      )\n      .expect(\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Assert that response is a JSON with a specific body"),"\n        jsonBodyResponse(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," JsonObject().put(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"value"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Hello Francesco!"'),")),\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Assert that response contains a particular header"),"\n        responseHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"bar"'),")\n      )\n      .send(testContext); ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Complete (or fail) the VertxTestContext"),"\n  }\n\n}\n")),Object(o.a)("p",null,Object(o.a)("inlineCode",{parentName:"p"},"testRequest()")," will use Vert.x Web Client to send the re\xadquest. When the re\xadsponse is re\xadceived, It suc\xadceds the test or it cor\xadrectly prop\xada\xadgates as\xadser\xadtion fail\xadures, if any."),Object(o.a)("p",null,"You can also send mul\xadti\xadple re\xadquests using ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/apidocs/io/vertx/junit5/Checkpoint.html"}),Object(o.a)("inlineCode",{parentName:"a"},"Checkpoint")),":"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-arduino"}),Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"import")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"static")," io.vertx.junit5.web.TestRequest.*;\n\n@ExtendWith({\n  VertxExtension.class, ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// VertxExtension MUST be configured before VertxWebClientExtension"),"\n  VertxWebClientExtension.class\n})\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-class"}),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"class")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"MultiTestRequestExample")," {"),"\n\n  @",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-function"}),"Test\n  ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"public")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-keyword"}),"void")," ",Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-title"}),"test2"),Object(o.a)("span",Object(n.a)({parentName:"span"},{className:"hljs-params"}),"(WebClient client, VertxTestContext testContext)")," "),"{\n    Checkpoint checkpoint = testContext.checkpoint(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-number"}),"2"),"); ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Create the Checkpoint to flag when request succeds"),"\n\n    testRequest(\n        client    ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Create the test request using WebClient APIs"),"\n          .",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-built_in"}),"get"),"(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/hello"'),")\n          .addQueryParam(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"name"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"francesco"'),")\n          .putHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"foo"'),")\n      )\n      .expect(\n        jsonBodyResponse(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," JsonObject().",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-built_in"}),"put"),"(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"value"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Hello Francesco!"'),")),\n        responseHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"bar"'),")\n      )\n      .send(testContext, checkpoint); ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Pass the checkpoint to flag"),"\n\n    testRequest(\n        client\n          .",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-built_in"}),"get"),"(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"/hello"'),")\n          .addQueryParam(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"name"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"julien"'),")\n          .putHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"foo"'),")\n      )\n      .expect(\n        jsonBodyResponse(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," JsonObject().",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-built_in"}),"put"),"(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"value"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"Hello Julien!"'),")),\n        responseHeader(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"x-my"'),", ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"bar"'),")\n      )\n      .send(testContext, checkpoint);\n  }\n\n}\n")),Object(o.a)("p",null,"Look at ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/docs/vertx-junit5-web-client/java/"}),"Vert.x JUnit 5 Web Client doc\xadu\xadmen\xadta\xadtion")," for more de\xadtails"))}j.isMDXComponent=!0},beur:function(e,a,t){},prWI:function(e,a,t){"use strict";var n=t("q1tI"),s=t.n(n),c=t("YFqc"),r=t.n(c),o=t("YUBE"),l=(t("beur"),s.a.createElement);a.a=function(e){var a=e.post,n=t("uYRw")("./".concat(a.filename)),s=n.meta.authors.map((function(e){return l("li",{key:e.github_id},l("img",{src:"https://github.com/".concat(e.github_id,".png?size=50")}),l("a",{href:"https://github.com/".concat(e.github_id),target:"_blank",rel:"noopener noreferrer"},e.name))}));return l("div",{className:"blog-entry"},l("div",{className:"blog-entry-meta"},l("span",{className:"blog-entry-date"},l(o.a,{date:a.date}))," ",l("span",{className:"blog-entry-category"},n.meta.category)),l("h3",null,l(r.a,{href:"/blog/[slug]",as:"/blog/".concat(a.slug,"/")},l("a",null,n.meta.title))),l("span",{className:"blog-entry-authors"},l("ul",null,s)),l("p",{className:"blog-entry-excerpt"},"Lorem ipsum dolor sit amet, con\xadsectetuer adip\xadisc\xading elit, sed diam non\xadummy nibh eu\xadis\xadmod tin\xadcidunt ut laoreet do\xadlore magna ali\xadquam erat vo\xadlut\xadpat. Ut wisi enim ad."),l("span",{className:"blog-entry-read-more-link"},l(r.a,{href:"/blog/[slug]",as:"/blog/".concat(a.slug,"/")},l("a",null,"Read more"))))}},uYRw:function(e,a,t){var n={"./2018-12-13-vertx-web-api-service.mdx":"ZJXT","./2019-08-30-eclipse-vertx-for-scala-next-steps.mdx":"CGsS","./2019-10-22-vertx-junit5-web-client.mdx":"aMnG","./2020-01-24-vertx-3-8-5-release.mdx":"M+IC","./2020-03-16-easy-sso-for-vertx-with-keycloak.mdx":"+aIQ","./2020-04-02-vertx-3-9-0-release.mdx":"yb6C"};function s(e){var a=c(e);return t(a)}function c(e){if(!t.o(n,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=c,e.exports=s,s.id="uYRw"},wx14:function(e,a,t){"use strict";function n(){return(n=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}t.d(a,"a",(function(){return n}))},yb6C:function(e,a,t){"use strict";t.r(a),t.d(a,"meta",(function(){return l})),t.d(a,"default",(function(){return j}));var n=t("wx14"),s=t("Ff2n"),c=t("q1tI"),r=t.n(c),o=t("7ljp"),l=(r.a.createElement,{title:"Eclipse Vert.x 3.9.0 released!",category:"releases",authors:[{name:"Julien Viet",github_id:"vietj"}]}),p={meta:l},i="wrapper";function j(e){var a=e.components,t=Object(s.a)(e,["components"]);return Object(o.a)(i,Object(n.a)({},p,t,{components:a,mdxType:"MDXLayout"}),Object(o.a)("h1",null,"Eclipse Vert.x 3.9.0 released!"),Object(o.a)("p",null,"We are ex\xadtremely pleased to an\xadnounce that the Eclipse Vert.x ver\xadsion 3.9.0 has been re\xadleased."),Object(o.a)("h4",null,"SQL Client fluent queries"),Object(o.a)("p",null,"The query API be\xadcomes flu\xadent with the ad\xaddi\xadtion of a ",Object(o.a)("inlineCode",{parentName:"p"},"Query")," API for queries cre\xadation and con\xadfig\xadu\xadra\xadtion."),Object(o.a)("p",null,"Col\xadlec\xadtors query now be\xadcomes part of the ",Object(o.a)("inlineCode",{parentName:"p"},"Query")," in\xadter\xadface."),Object(o.a)("p",null,"This is a break\xading API change done under the tech pre\xadview sta\xadtus given that SQL client is a Vert.x 4 fea\xadture back-\u200bported to Vert.x 3."),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"client.prepareQuery(sql).execute(tuple, ar -> ...);\n\n",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// With a collector"),"\nclient.preparedQuery(sql).collecting(Collectors.toList()).execute(tuple, ar -> ...);\n")),Object(o.a)("p",null,"You can read more about this new fea\xadture ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/wiki/wiki/3.9.0-Deprecations-and-breaking-changes#fluent-query-api"}),"here"),"."),Object(o.a)("h4",null,"Redis client backport"),Object(o.a)("p",null,"For Vert.x 4.0 we are doing a full re\xadboot to the redis client. The func\xadtion\xadal\xadity for the new client is ready to test on the mas\xadter branch. In order to give users the op\xadpor\xadtu\xadnity to test and make the up\xadcom\xading client even bet\xadter it has been back\xadported to the 3.9.0 re\xadlease. The new client will allow users to con\xadnect to a sin\xadgle node, sen\xadtinel or clus\xadter of redis nodes. The eas\xadi\xadest way to start is:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"Redis.createClient(\n      vertx,\n      ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"new")," RedisOptions()\n        .setConnectionString(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"redis://localhost:7006"'),"))\n      .send(Request.cmd(Command.PING), send -> {\n        ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-keyword"}),"if")," (send.succeeded()) {\n          ",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-comment"}),"// Should have received a pong..."),"\n        }\n      });\n")),Object(o.a)("h4",null,"Same-site cookies"),Object(o.a)("p",null,Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://tools.ietf.org/html/draft-west-first-party-cookies-07"}),Object(o.a)("inlineCode",{parentName:"a"},"SameSite")," Cookie")," pol\xadicy has been added to the HTTP Server Cook\xadies."),Object(o.a)("p",null,"This is also ap\xadplic\xada\xadble to web which al\xadlows cookie ses\xadsions to use ",Object(o.a)("inlineCode",{parentName:"p"},"SameSite")," cook\xadies:"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"SessionHandler.create(store)\n  .setCookieSameSite(CookieSameSite.STRICT);\n")),Object(o.a)("p",null,"Same-\u200bsite cook\xadies let servers re\xadquire that a cookie shouldn\u2019t be sent with cross-\u200bsite (where Site is de\xadfined by the reg\xadis\xadtra\xadble do\xadmain) re\xadquests,\nwhich pro\xadvides some pro\xadtec\xadtion against cross-\u200bsite re\xadquest forgery at\xadtacks (CSRF)."),Object(o.a)("h4",null,"Kafka client upgrade"),Object(o.a)("p",null,"The Kafka client has been up\xadgraded to Kafka 2.4.0 ."),Object(o.a)("p",null,"Our re\xadac\xadtive client ex\xadposes the Kafka Admin API. As of 2.4.0 this API has been re\xadplaced by a new Kafka Admin API and there\xadfore\nthe Vert.x Kafka Admin API changes, e.g list\xading con\xadsumers groups"),Object(o.a)("pre",null,Object(o.a)("code",Object(n.a)({parentName:"pre"},{className:"hljs language-java"}),"adminClient.listConsumerGroups(ar -> {\n    System.out.println(",Object(o.a)("span",Object(n.a)({parentName:"code"},{className:"hljs-string"}),'"ConsumerGroups= "')," + ar.result());\n});\n")),Object(o.a)("h4",null,"Future API"),Object(o.a)("p",null,"With the re\xadcent ad\xaddi\xadtion of ",Object(o.a)("inlineCode",{parentName:"p"},"Future#onComplete(...)")," sup\xadport\xading sev\xaderal han\xaddlers per ",Object(o.a)("inlineCode",{parentName:"p"},"Future")," in 3.9 made the\n",Object(o.a)("inlineCode",{parentName:"p"},"Future#setHandler(...)")," method feel awk\xadward. In\xaddeed ",Object(o.a)("inlineCode",{parentName:"p"},"setHandler")," con\xadveys the mean\xading that the ",Object(o.a)("inlineCode",{parentName:"p"},"Future")," man\xadages\na sin\xadgle han\xaddler. In 3.9 we dep\xadre\xadcate ",Object(o.a)("inlineCode",{parentName:"p"},"Future#setHandler")," in favor of ",Object(o.a)("inlineCode",{parentName:"p"},"Future#onComplete"),"."),Object(o.a)("h4",null,"EDNS disabled by default"),Object(o.a)("p",null,"EDNS is an ex\xadten\xadsion mech\xada\xadnism for DNS (",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://fr.wikipedia.org/wiki/EDNS"}),"https://fr.wikipedia.org/wiki/EDNS"),") that should be dis\xadabled by de\xadfault. It might\ncause un\xadwanted issue and should be dis\xadabled by de\xadfault."),Object(o.a)("h4",null,"Auth Deprecation warnings"),Object(o.a)("p",null,"As of 3.9.0 many APIs will be start warn\xading about dep\xadre\xadca\xadtions. There is a big refac\xadtor\xading and some break\xading API changes com\xading\non 4.0.0 and these warn\xadings are just to give users a heads up that API will change on the up\xadcom\xading ver\xadsion."),Object(o.a)("p",null,"For more in\xadfor\xadma\xadtion about the up\xadcom\xading 4.0 changes you can read ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/wiki/wiki/4.0.0-Deprecations-and-breaking-changes"}),"4.0.0-\u200bDeprecations-and-breaking-changes")),Object(o.a)("h4",null,"Dependency upgrades"),Object(o.a)("p",null,"In 3.9 we up\xaddate a few ver\xadsions:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},"Netty 4.1.48.Final"),Object(o.a)("li",{parentName:"ul"},"Jack\xadson 2.10.2"),Object(o.a)("li",{parentName:"ul"},"Guava 25.1-jre"),Object(o.a)("li",{parentName:"ul"},"GraphQL Java 14")),Object(o.a)("h4",null,"Finally"),Object(o.a)("p",null,"The ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/wiki/wiki/3.9.0-Release-Notes"}),"3.9.0 re\xadlease notes")," can be found on the wiki, as well as the\nlist of ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/vert-x3/wiki/wiki/3.9.0-Deprecations-and-breaking-changes"}),"dep\xadre\xadca\xadtions and break\xading changes")),Object(o.a)("p",null,"Docker im\xadages are avail\xadable on ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://hub.docker.com/u/vertx/"}),"Docker Hub"),"."),Object(o.a)("p",null,"The Vert.x dis\xadtri\xadb\xadu\xadtion can be down\xadloaded on the web\xadsite but is also avail\xadable from ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://sdkman.io/index.html"}),"SD\xadKMan")," and ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://brew.sh/"}),"Home\xadBrew"),"."),Object(o.a)("p",null,"The event bus client using the SockJS bridge is avail\xadable from:"),Object(o.a)("ul",null,Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://www.npmjs.com/package/vertx3-eventbus-client"}),"NPM")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"https://github.com/vert-x3/vertx-bus-bower"}),"Bower")),Object(o.a)("li",{parentName:"ul"},Object(o.a)("a",Object(n.a)({parentName:"li"},{href:"http://www.webjars.org/"}),"We\xadb\xadJars"))),Object(o.a)("p",null,"The re\xadlease ar\xadti\xadfacts have been de\xadployed to ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"http://search.maven.org/#search%7Cga%7C1%7Cg%3A%22io.vertx%22%20AND%20v%3A%223.9.0%22"}),"Maven Cen\xadtral")," and you can get the dis\xadtri\xadb\xadu\xadtion on ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://bintray.com/vertx/downloads/distribution/3.9.0/view"}),"Bin\xadtray"),"."),Object(o.a)("p",null,"That\u2019s it! Happy cod\xading and see you soon on our user or dev ",Object(o.a)("a",Object(n.a)({parentName:"p"},{href:"https://vertx.io/community"}),"chan\xadnels"),"."))}j.isMDXComponent=!0}}]);