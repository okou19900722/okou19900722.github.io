<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="description" content="Vert.x | Reactive applications on the JVM"/><meta name="robots" content="index,follow"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Roboto+Condensed:300,400" rel="stylesheet"/><link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&amp;display=swap" rel="stylesheet"/><link rel="shortcut icon" href="/favicons/favicon.ico"/><link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="48x48" href="/favicons/favicon-48x48.png"/><title>Vert.x 3 real time web apps | Blog | Eclipse Vert.x</title><meta name="next-head-count" content="13"/><link rel="preload" href="/_next/static/css/styles.065337ce.chunk.css" as="style"/><link rel="stylesheet" href="/_next/static/css/styles.065337ce.chunk.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-b6e20584df76f29b6f35.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.fcef98db13e2318579fb.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" as="script"/><link rel="preload" href="/_next/static/chunks/styles.6a5cc0a07ce13c54adf1.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" as="script"/><link rel="preload" href="/_next/static/chunks/5e2acbba0c73eb7c5c0e969bcd552d3808de9969.4d0eb9c3d4239c66cc89.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5B%5B...slug%5D%5D-e52c21bde616652a406f.js" as="script"/></head><body><div id="__next"><main class="page"><header><div class="navbar"><div class="navbar-content container"><div class="navbar-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="navbar-collapse-button"><span></span><span></span><span></span></div><div class="navbar-right"><div class="navbar-menu"><a class="navbar-menu-item" href="/introduction-to-vertx-and-reactive/">Intro</a><a class="navbar-menu-item" href="/docs/">Docs</a><a class="navbar-menu-item" href="/faq/">FAQ</a><a class="navbar-menu-item" href="/blog/">Blog</a><a class="navbar-menu-item" href="/community/">Community</a></div><div class="navbar-social"><a href="https://github.com/vert-x3/vertx-awesome" class="navbar-social-link" title="Awesome Vert.x" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="List of awesome Vert.x projects"><title>Awesome Vert.x</title><path d="M24 11.438l-6.154-5.645-.865.944 5.128 4.7H1.895l5.128-4.705-.865-.943-6.154 5.649H0v3.72c0 1.683 1.62 3.053 3.61 3.053h3.795c1.99 0 3.61-1.37 3.61-3.051v-2.446h1.97v2.446c0 1.68 1.62 3.051 3.61 3.051h3.794c1.99 0 3.61-1.37 3.61-3.051v-3.721z"></path></svg></a><a href="https://stackoverflow.com/questions/tagged/vert.x" class="navbar-social-link" title="Stack Overflow" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Stack Overflow questions related to Vert.x"><title>Stack Overflow</title><path d="M18.986 21.865v-6.404h2.134V24H1.844v-8.539h2.13v6.404h15.012zM6.111 19.731H16.85v-2.137H6.111v2.137zm.259-4.852l10.48 2.189.451-2.07-10.478-2.187-.453 2.068zm1.359-5.056l9.705 4.53.903-1.95-9.706-4.53-.902 1.936v.014zm2.715-4.785l8.217 6.855 1.359-1.62-8.216-6.853-1.35 1.617-.01.001zM15.751 0l-1.746 1.294 6.405 8.604 1.746-1.294L15.749 0h.002z"></path></svg></a><a href="https://www.youtube.com/channel/UCGN6L3tRhs92Uer3c6VxOSA" class="navbar-social-link" title="YouTube" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="YouTube channel of Vert.x"><title>YouTube</title><path d="M23.499 6.203a3.008 3.008 0 00-2.089-2.089c-1.87-.501-9.4-.501-9.4-.501s-7.509-.01-9.399.501a3.008 3.008 0 00-2.088 2.09A31.258 31.26 0 000 12.01a31.258 31.26 0 00.523 5.785 3.008 3.008 0 002.088 2.089c1.869.502 9.4.502 9.4.502s7.508 0 9.399-.502a3.008 3.008 0 002.089-2.09 31.258 31.26 0 00.5-5.784 31.258 31.26 0 00-.5-5.808zm-13.891 9.4V8.407l6.266 3.604z"></path></svg></a><a href="https://discord.gg/KzEMwP2" class="navbar-social-link" title="Discord" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="Eclipse Vert.x channel on Discord"><title>Discord</title><path d="M20.222 0c1.406 0 2.54 1.137 2.607 2.475V24l-2.677-2.273-1.47-1.338-1.604-1.398.67 2.205H3.71c-1.402 0-2.54-1.065-2.54-2.476V2.48C1.17 1.142 2.31.003 3.715.003h16.5L20.222 0zm-6.118 5.683h-.03l-.202.2c2.073.6 3.076 1.537 3.076 1.537-1.336-.668-2.54-1.002-3.744-1.137-.87-.135-1.74-.064-2.475 0h-.2c-.47 0-1.47.2-2.81.735-.467.203-.735.336-.735.336s1.002-1.002 3.21-1.537l-.135-.135s-1.672-.064-3.477 1.27c0 0-1.805 3.144-1.805 7.02 0 0 1 1.74 3.743 1.806 0 0 .4-.533.805-1.002-1.54-.468-2.14-1.404-2.14-1.404s.134.066.335.2h.06c.03 0 .044.015.06.03v.006c.016.016.03.03.06.03.33.136.66.27.93.4.466.202 1.065.403 1.8.536.93.135 1.996.2 3.21 0 .6-.135 1.2-.267 1.8-.535.39-.2.87-.4 1.397-.737 0 0-.6.936-2.205 1.404.33.466.795 1 .795 1 2.744-.06 3.81-1.8 3.87-1.726 0-3.87-1.815-7.02-1.815-7.02-1.635-1.214-3.165-1.26-3.435-1.26l.056-.02zm.168 4.413c.703 0 1.27.6 1.27 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334.002-.74.573-1.338 1.27-1.338zm-4.543 0c.7 0 1.266.6 1.266 1.335 0 .74-.57 1.34-1.27 1.34-.7 0-1.27-.6-1.27-1.334 0-.74.57-1.338 1.27-1.338z"></path></svg></a><a href="https://groups.google.com/forum/?fromgroups#!forum/vertx" class="navbar-social-link" title="Vert.x User Group" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24" aria-label="A Google group for Vert.x users"><title>Vert.x User Group</title><path d="M.92 3.332c-.776 0-1.216.67-.692 1.383l2.537 4.403v7.86c0 2.013 1.467 3.69 3.459 3.69H20.31a3.75 3.75 0 003.69-3.69V7.043a3.723 3.723 0 00-3.668-3.71zm5.786 3.71H20.1c.587 0 1.153.357 1.153.923 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.923 1.153-.923zm0 3.69H20.1c.587 0 1.153.356 1.153.922 0 .566-.566.922-1.153.922H6.706c-.587 0-1.153-.356-1.153-.922 0-.566.566-.922 1.153-.922zm-.021 3.71h9.705c.587 0 1.153.356 1.153.922 0 .566-.566.923-1.153.923H6.685c-.587 0-1.153-.357-1.153-.923 0-.566.566-.922 1.153-.922Z"></path></svg></a></div></div></div></div></header><div class="page-content"><div class="container"><div class="blog-post"><div class="blog-navbar"><h2>Blog</h2><ul><li><a href="/blog/">All posts</a></li><li><a href="/blog/category/releases/">releases</a></li><li><a href="/blog/category/guides/">guides</a></li><li><a href="/blog/category/news/">news</a></li></ul></div><div class="blog-post-main"><div class="blog-post-content"><h1>Vert.x 3 real time web apps</h1><span><p>One of the in­ter­est­ing fea­tures of Vert.x is the <a href="http://sockjs.org">SockJS</a> event bus bridge. This piece of soft­ware
al­lows ex­ter­nal ap­pli­ca­tions to com­mu­ni­cate with Vert.x event bus using Web­sock­ets and if your browser does not
sup­port it then it grace­fully de­grades to pool­ing AJAX calls.</p><p>Web­Sock­ets bring a new level of in­ter­ac­tion to the web, they re­ally bring real time to web ap­pli­ca­tions due to the
fact that its com­mu­ni­ca­tion model is bi-​directional in con­trast to the tra­di­tional HTTP model where a client can
ini­ti­ate a data re­quest to a server but not the other way around.</p><p>In this small post I will demon­strate how you can cre­ate a sim­ple col­lab­o­ra­tive draw­ing app. The idea is sim­ple, all
users that open the app will be be pre­sented with a empty can­vas and what they draw or is drawn on other can­vas is
shared in real time on their screen.</p><p>For the sake of sim­plic­ity and mak­ing this post light there is no se­cu­rity in­volved so, every­one is free to lis­ten to
what is being drawn, how­ever the ex­ter­nal ap­pli­ca­tion has lim­ited read write ac­cess to a sin­gle ad­dress on Vert.x
event bus, en­sur­ing that other ser­vices run­ning on the clus­ter will not be ex­posed.</p><p>This is what you should ex­pect to see:</p><p><img src="/images/blog/vertx3-realtime-webapps/screencast.gif" alt="Screencast"/></p><h2 id="bootstrap-a-project"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#bootstrap-a-project"></a>Bootstrap a project</h2><p>If you fol­lowed the pre­vi­ous <a href="/blog/my-first-vert-x-3-application/">se­ries</a> on Vert.x de­vel­op­ment, you saw
that Java and Maven were the main topic, since Vert.x is poly­glot I will focus on JavaScript and
<a href="https://www.npmjs.com/">NPM</a> as my pro­gram­ming lan­guage and pack­age man­age­ment tool.</p><p>With NPM start by cre­at­ing a <code>package.json</code>, in order to do this we should run:</p><pre><code class="hljs language-bash">npm init
</code></pre><p>This will present a se­lec­tion of ques­tions and in the end you should have a basic <code>package.json</code> file. This
con­fig­u­ra­tion is very basic so you need to add a <a href="https://www.npmjs.com/package/vertx3-full">de­pen­dency</a> to Vert.x so
you can run the ap­pli­ca­tion. You can add it to the <code>dependencies</code> prop­erty and it should look more or less like this:</p><pre><code class="hljs language-javascript">{
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;draw&quot;</span>,
  <span class="hljs-string">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-string">&quot;dependencies&quot;</span>: {
    <span class="hljs-string">&quot;vertx3-full&quot;</span>: <span class="hljs-string">&quot;3.0.0-1&quot;</span>
  },
  <span class="hljs-string">&quot;scripts&quot;</span>: {
    <span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-string">&quot;vertx run server.js&quot;</span>
  },
  <span class="hljs-string">&quot;version&quot;</span>: <span class="hljs-string">&quot;1.0.0&quot;</span>,
  <span class="hljs-string">&quot;main&quot;</span>: <span class="hljs-string">&quot;server.js&quot;</span>,
  <span class="hljs-string">&quot;devDependencies&quot;</span>: {},
  <span class="hljs-string">&quot;author&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,
  <span class="hljs-string">&quot;license&quot;</span>: <span class="hljs-string">&quot;ISC&quot;</span>,
  <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;A Real Time Drawing App&quot;</span>
}
</code></pre><p>If you do not know why there is the de­pen­dency on <code>vertx3-full</code> or why the added <code>scripts</code> prop­erty please check the <a href="/blog/vert-x3-says-hello-to-npm-users/">older</a> blog post about it.</p><h2 id="project-structure"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#project-structure"></a>Project Structure</h2><p>This post has no pref­er­ence over project struc­ture, so if you do not agree with the struc­ture used here feel free to
use what you feel best. For this ex­am­ple I will keep it to:</p><pre><code class="hljs language-text">├── package.json
├── server.js
└── webroot
  ├── assets
  │   └── js
  │     ├── script.js
  │     └── vertxbus.js
  └── index.html

3 directories, 5 files
</code></pre><p>As you can imag­ine <code>server.js</code> will be our Vert.x ap­pli­ca­tion and every­thing under <code>webroot</code> will be the client
ap­pli­ca­tion.</p><p>The client ap­pli­ca­tion is not re­ally Vert.x spe­cific and could in the­ory be used by any other frame­work so I will go
lightly over its code.</p><h3 id="client-application"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#client-application"></a>Client Application</h3><p>Our ap­pli­ca­tion main entry point is as one can ex­pect <code>index.html</code>. In the index file de­fine the fol­low­ing HTML:</p><pre><code class="hljs language-html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Real time drawing App<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-comment">&lt;!--[if lt IE 9]&gt;
  &lt;script src=&quot;http://html5shiv.googlecode.com/svn/trunk/html5.js&quot;&gt;&lt;/script&gt;
  &lt;![endif]--&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;paper&quot;</span> <span class="hljs-attr">width</span>=<span class="hljs-string">&quot;1900&quot;</span> <span class="hljs-attr">height</span>=<span class="hljs-string">&quot;1000&quot;</span>&gt;</span>
  Your browser needs to support canvas for this to work!
<span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>

<span class="hljs-comment">&lt;!-- JavaScript includes. --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://code.jquery.com/jquery-1.8.0.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&#x27;assets/js/vertxbus.js&#x27;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;assets/js/script.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre><p>As I pre­vi­ously wrote, the idea is to keep it as sim­ple as pos­si­ble so it is all about hav­ing a can­vas el­e­ment and a
ap­pli­ca­tion main script <code>script.js</code>. All the rest are files served by CDNs that pro­vide com­mon web ap­pli­ca­tion
li­braries such as <code>jQuery</code>, <code>HTML5</code> shim for older browsers, <code>SockJS</code> client and <code>vertxbus</code> bridge.</p><p>The main code is on <code>script.js</code> file:</p><pre><code class="hljs language-javascript">$(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

  <span class="hljs-comment">// This demo depends on the canvas element</span>
  <span class="hljs-keyword">if</span> (!(<span class="hljs-string">&#x27;getContext&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;canvas&#x27;</span>))) {
    alert(<span class="hljs-string">&#x27;Sorry, it looks like your browser does not support canvas!&#x27;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">var</span> doc = $(<span class="hljs-built_in">document</span>),
    canvas = $(<span class="hljs-string">&#x27;#paper&#x27;</span>),
    ctx = canvas[<span class="hljs-number">0</span>].getContext(<span class="hljs-string">&#x27;2d&#x27;</span>);

  <span class="hljs-comment">// Generate an unique ID</span>
  <span class="hljs-keyword">var</span> id = <span class="hljs-built_in">Math</span>.round($.now() * <span class="hljs-built_in">Math</span>.random());

  <span class="hljs-comment">// A flag for drawing activity</span>
  <span class="hljs-keyword">var</span> drawing = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">var</span> clients = {};
  <span class="hljs-comment">// create a event bus bridge to the server that served this file</span>
  <span class="hljs-keyword">var</span> eb = <span class="hljs-keyword">new</span> vertx.EventBus(
      <span class="hljs-built_in">window</span>.location.protocol + <span class="hljs-string">&#x27;//&#x27;</span> + <span class="hljs-built_in">window</span>.location.hostname + <span class="hljs-string">&#x27;:&#x27;</span> + <span class="hljs-built_in">window</span>.location.port + <span class="hljs-string">&#x27;/eventbus&#x27;</span>);

  eb.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// listen to draw events</span>
    eb.registerHandler(<span class="hljs-string">&#x27;draw&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
      <span class="hljs-comment">// Is the user drawing?</span>
      <span class="hljs-keyword">if</span> (data.drawing &amp;&amp; clients[data.id]) {

        <span class="hljs-comment">// Draw a line on the canvas. clients[data.id] holds</span>
        <span class="hljs-comment">// the previous position of this user&#x27;s mouse pointer</span>

        drawLine(clients[data.id].x, clients[data.id].y, data.x, data.y);
      }

      <span class="hljs-comment">// Saving the current client state</span>
      clients[data.id] = data;
      clients[data.id].updated = $.now();
    });
  };

  <span class="hljs-keyword">var</span> prev = {};

  canvas.on(<span class="hljs-string">&#x27;mousedown&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    e.preventDefault();
    drawing = <span class="hljs-literal">true</span>;
    prev.x = e.pageX;
    prev.y = e.pageY;
  });

  doc.bind(<span class="hljs-string">&#x27;mouseup mouseleave&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    drawing = <span class="hljs-literal">false</span>;
  });

  <span class="hljs-keyword">var</span> lastEmit = $.now();

  doc.on(<span class="hljs-string">&#x27;mousemove&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> ($.now() - lastEmit &gt; <span class="hljs-number">30</span>) {
      eb.publish(<span class="hljs-string">&#x27;draw&#x27;</span>, {
        <span class="hljs-string">&#x27;x&#x27;</span>: e.pageX,
        <span class="hljs-string">&#x27;y&#x27;</span>: e.pageY,
        <span class="hljs-string">&#x27;drawing&#x27;</span>: drawing,
        <span class="hljs-string">&#x27;id&#x27;</span>: id
      });
      lastEmit = $.now();
    }

    <span class="hljs-comment">// Draw a line for the current user&#x27;s movement, as it is</span>
    <span class="hljs-comment">// not received in the eventbus</span>

    <span class="hljs-keyword">if</span> (drawing) {

      drawLine(prev.x, prev.y, e.pageX, e.pageY);

      prev.x = e.pageX;
      prev.y = e.pageY;
    }
  });

  <span class="hljs-comment">// Remove inactive clients after 10 seconds of inactivity</span>
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> ident <span class="hljs-keyword">in</span> clients) {
      <span class="hljs-keyword">if</span> (clients.hasOwnProperty(ident)) {
        <span class="hljs-keyword">if</span> ($.now() - clients[ident].updated &gt; <span class="hljs-number">10000</span>) {
          <span class="hljs-comment">// Last update was more than 10 seconds ago.</span>
          <span class="hljs-comment">// This user has probably closed the page</span>
          <span class="hljs-keyword">delete</span> clients[ident];
        }
      }
    }

  }, <span class="hljs-number">10000</span>);

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawLine</span>(<span class="hljs-params">fromx, fromy, tox, toy</span>) </span>{
    ctx.moveTo(fromx, fromy);
    ctx.lineTo(tox, toy);
    ctx.stroke();
  }

});
</code></pre><p>The most im­por­tant part in this code is all the code re­lated to <code>eb</code>. The vari­able <code>eb</code> is our bridge to the event
bus, Start by cre­at­ing a bridge using the <code>vertx.EventBus</code> ob­ject and de­fine where to con­nect, using the de­tails
of the cur­rent win­dow lo­ca­tion.</p><p>Then add a <code>onopen</code> lis­tener that will sub­scribe to the ad­dress <code>draw</code> on the event bus so it can lis­ten to all
mes­sages re­gard­ing draw­ing and per­form the draw­ing ac­tions. Since lis­ten­ing is not enough I also add a mouse lis­tener
to the doc­u­ment so when it moves it pub­lishes events to the <code>draw</code> ad­dress.</p><p>Note that I am using <code>publish</code> and not <code>send</code>, the rea­son should be ob­vi­ous, I want every­one to know this users mouse
move­ments, I am not in­ter­ested on send­ing the events to just a sin­gle user. You can see now that if you want to have
a draw­ing app in a one on one user basis then in­stead of <code>publish()</code> you should use <code>send()</code>.</p><h3 id="server-application"><a aria-hidden="true" tabindex="-1" class="heading-anchor" href="#server-application"></a>Server Application</h3><p>The server code is quite straight for­ward, all you need is:</p><pre><code class="hljs language-javascript"><span class="hljs-keyword">var</span> Router = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vertx-web-js/router&quot;</span>);
<span class="hljs-keyword">var</span> SockJSHandler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vertx-web-js/sock_js_handler&quot;</span>);
<span class="hljs-keyword">var</span> StaticHandler = <span class="hljs-built_in">require</span>(<span class="hljs-string">&quot;vertx-web-js/static_handler&quot;</span>);

<span class="hljs-keyword">var</span> router = Router.router(vertx);

<span class="hljs-comment">// Allow outbound traffic to the draw address</span>

<span class="hljs-keyword">var</span> options = {
  <span class="hljs-string">&quot;outboundPermitteds&quot;</span> : [{<span class="hljs-string">&quot;address&quot;</span> : <span class="hljs-string">&quot;draw&quot;</span>}],
  <span class="hljs-string">&quot;inboundPermitteds&quot;</span> :  [{<span class="hljs-string">&quot;address&quot;</span> : <span class="hljs-string">&quot;draw&quot;</span>}]
};

router.route(<span class="hljs-string">&quot;/eventbus/*&quot;</span>).handler(SockJSHandler.create(vertx).bridge(options).handle);

<span class="hljs-comment">// Serve the static resources</span>
router.route().handler(StaticHandler.create().handle);

vertx.createHttpServer().requestHandler(router.accept).listen(<span class="hljs-number">8080</span>);
</code></pre><p>We start with the usual im­ports, we im­port a ref­er­ence to the <code>Router</code> ob­ject and a cou­ple of helper han­dlers
<code>SockJSHandler</code> and <code>StaticHandler</code>. As their names should tell you one han­dler will be re­spon­si­ble to han­dle all
<code>SockJS</code> data and the other all HTTP file serv­ing re­quests.</p><p>We then add then to a router and start a HTTP server that will han­dle all in­com­ing re­quest using the han­dler ac­cept
func­tion. Fi­nally we lis­ten on port <code>8080</code> and we are ready.</p><p>Note that there is a op­tions ob­ject where a cou­ple of prop­er­ties are de­fined <code>outbound/inbound</code> per­mit­ted ad­dresses.
With­out this con­fig­u­ra­tion the ex­ter­nal ap­pli­ca­tion will not be al­lowed to con­nect to the vert.x bus, in fact the
de­fault con­fig­u­ra­tion of the Sock­JSHan­dler is deny all. So you must spec­ify ex­plic­itly which ad­dress are al­lowed to
re­ceive mes­sages from <code>SockJS</code> and which ones are al­lowed to send/pub­lish to <code>SockJS</code>.</p><p>Now you can start your ap­pli­ca­tion, don’t for­get to in­stall the de­pen­den­cies for the first time:</p><pre><code class="hljs language-bash">npm install
</code></pre><p>And then run the ap­pli­ca­tion:</p><pre><code class="hljs language-bash">npm start
</code></pre><p>If you now open 2 browser win­dows you will be able to draw nice pic­tures and see the draw­ing show­ing in “real time”
on the other win­dow, if you then draw on the sec­ond you should get the mir­ror ef­fect on the first win­dow.</p><p>Have fun!</p></span></div><div class="blog-post-sidebar"><div class="blog-post-author"><img class="blog-post-author-avatar" src="https://github.com/pmlopes.png?size=160"/><div class="blog-post-author-name">by <a href="https://github.com/pmlopes" target="_blank" rel="noopener noreferrer">Paulo Lopes</a></div></div><div class="blog-post-sidebar-date">Posted on <!-- -->31 August 2015</div>in <a class="blog-post-sidebar-category" href="/blog/category/guides/">guides</a><div class="blog-post-sidebar-reading-time"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <!-- -->7 min read</div><div class="blog-post-sidebar-share-icons"><a href="https://twitter.com/intent/tweet?text=Vert.x%203%20real%20time%20web%20apps&amp;url=https%3A%2F%2Fokou19900722.github.com%2Fvertx-web-site.github.io%2Fblog%2Fvert-x3-real-time-web-apps&amp;via=vertx_project" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>Twitter</title><path d="M23.954 4.569c-.885.389-1.83.654-2.825.775 1.014-.611 1.794-1.574 2.163-2.723-.951.555-2.005.959-3.127 1.184-.896-.959-2.173-1.559-3.591-1.559-2.717 0-4.92 2.203-4.92 4.917 0 .39.045.765.127 1.124C7.691 8.094 4.066 6.13 1.64 3.161c-.427.722-.666 1.561-.666 2.475 0 1.71.87 3.213 2.188 4.096-.807-.026-1.566-.248-2.228-.616v.061c0 2.385 1.693 4.374 3.946 4.827-.413.111-.849.171-1.296.171-.314 0-.615-.03-.916-.086.631 1.953 2.445 3.377 4.604 3.417-1.68 1.319-3.809 2.105-6.102 2.105-.39 0-.779-.023-1.17-.067 2.189 1.394 4.768 2.209 7.557 2.209 9.054 0 13.999-7.496 13.999-13.986 0-.209 0-.42-.015-.63.961-.689 1.8-1.56 2.46-2.548l-.047-.02z"></path></svg></a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fokou19900722.github.com%2Fvertx-web-site.github.io%2Fblog%2Fvert-x3-real-time-web-apps" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"></path></svg></a><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fokou19900722.github.com%2Fvertx-web-site.github.io%2Fblog%2Fvert-x3-real-time-web-apps" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 24 24"><title>Facebook</title><path d="M23.9981 11.9991C23.9981 5.37216 18.626 0 11.9991 0C5.37216 0 0 5.37216 0 11.9991C0 17.9882 4.38789 22.9522 10.1242 23.8524V15.4676H7.07758V11.9991H10.1242V9.35553C10.1242 6.34826 11.9156 4.68714 14.6564 4.68714C15.9692 4.68714 17.3424 4.92149 17.3424 4.92149V7.87439H15.8294C14.3388 7.87439 13.8739 8.79933 13.8739 9.74824V11.9991H17.2018L16.6698 15.4676H13.8739V23.8524C19.6103 22.9522 23.9981 17.9882 23.9981 11.9991Z"></path></svg></a></div></div></div><div class="blog-post-next-prev"><div class="blog-post-next-prev-entry"><h5>Next post</h5><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">14 September 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/writing-secure-vert-x-web-apps/">Writing secure Vert.x Web apps</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/pmlopes.png?size=50"/><a href="https://github.com/pmlopes" target="_blank" rel="noopener noreferrer">Paulo Lopes</a></li></ul></span><p class="blog-entry-summary">This is a starting guide for securing Vert.x web applications. Standard rules and practices apply to Vert.x apps as if they would to any other web framework.</p><span class="read-more-link"><a href="/blog/writing-secure-vert-x-web-apps/">Read more</a></span></div></div><div class="blog-post-next-prev-entry"><h5>Previous post</h5><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">3 August 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/unit-and-integration-tests/">Unit and Integration Tests</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/cescoffier.png?size=50"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="blog-entry-summary">Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API.</p><span class="read-more-link"><a href="/blog/unit-and-integration-tests/">Read more</a></span></div></div></div><div class="blog-post-related"><h5>Related posts</h5><div class="blog-post-related-posts"><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">3 August 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/unit-and-integration-tests/">Unit and Integration Tests</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/cescoffier.png?size=50"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="blog-entry-summary">Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API.</p><span class="read-more-link"><a href="/blog/unit-and-integration-tests/">Read more</a></span></div><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">30 November 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/combine-vert-x-and-mongo-to-build-a-giant/">Combine vert.x and mongo to build a giant</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/cescoffier.png?size=50"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="blog-entry-summary">This blog post is part of the introduction to Vert.x series. We are now going to replace this JDBC client by the vertx-mongo-client, and thus connect to a Mongo database.</p><span class="read-more-link"><a href="/blog/combine-vert-x-and-mongo-to-build-a-giant/">Read more</a></span></div><div class="blog-entry"><div class="blog-entry-meta"><div class="blog-entry-meta-left"><span class="blog-entry-date">19 October 2015</span>​<a class="blog-entry-category" href="/blog/category/guides/">guides</a></div><div class="blog-entry-meta-right"></div></div><h3><a href="/blog/using-the-asynchronous-sql-client/">Using the asynchronous SQL client</a></h3><span class="blog-entry-authors"><ul><li class=""><img src="https://github.com/cescoffier.png?size=50"/><a href="https://github.com/cescoffier" target="_blank" rel="noopener noreferrer">Clement Escoffier</a></li></ul></span><p class="blog-entry-summary">Finally, back... This post is the fifth post of the introduction to vert.x blog series, after a not-that-small break. In this post we are going to see how we can use JDBC in a vert.x application.</p><span class="read-more-link"><a href="/blog/using-the-asynchronous-sql-client/">Read more</a></span></div></div></div></div></div></div><footer><div class="container"><div class="footer-nav-section"><div class="footer-nav-list footer-logo"><a href="/"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAxMTI1LjYgMzE1LjIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6Izc4MmE5MX08L3N0eWxlPjxwYXRoIGQ9Ik0xMjAuOSAyMTQuMkwxOTAuNSAwaDUyLjNsLTk4LjUgMjczLjhIOTguMkwwIDBoNTIuMWw2OC44IDIxNC4yem0yOTEuMi02Mi42SDI5OS42djg0LjJINDMxdjM4SDI1MlYwaDE3Ny43djM4LjRIMjk5LjZWMTE0aDExMi41djM3LjZ6bTgzLjctMTEzLjJINTQ2YzE2LjUuMyAyOSA0LjQgMzcuMyAxMi40IDguMyA4IDEyLjUgMTkuNCAxMi41IDM0IDAgMTQtNC41IDI1LjEtMTMuNSAzMy4yLTkgOC4xLTIxLjYgMTIuMS0zNy42IDEyLjFoLTI3LjF2MjQuMmw4Ni4xIDExOS41aDUxdi0yLjRsLTc3LjItMTA2LjdjMjQuOS01LjUgNDMuMy0yMS43IDUyLjYtMzUuOSA4LjItMTIuNiAxMy4zLTI3LjcgMTMuMy00NiAwLTI2LjgtOC42LTQ3LjQtMjUuOC02MS41QzYwMC41IDcuMSA1NzYuMSAwIDU0NC41IDBoLTk2LjN2MjczLjhoNDcuNiIvPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik0xMDUyLjMgMTU3LjdsLTQxLjUgNjIuNyAyOS43IDUzLjRoODUuMXoiLz48Y2lyY2xlIGNsYXNzPSJzdDAiIGN4PSI4MjcuOSIgY3k9IjI3NC43IiByPSI0MC41Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTEwMzcgMGwtNDcuNiA3NC4yTDk0OSAwaC04NGw4NS4zIDEzNS44LTY3LjEgMTA1LjdjNS43IDkuNSA5LjEgMjAuNSA5LjIgMzIuNGg1MC4xTDExMjEuMyAwSDEwMzd6Ii8+PHBhdGggZD0iTTc2My41IDI3My44Yy4xLTkuOSAyLjUtMTkuMiA2LjYtMjcuNVYzOC40aDg1LjRWMEg2MzguMnYzOC40aDg0LjZ2MjM1LjRoNDAuN3oiLz48L3N2Zz4=" alt="Vert.x Logo"/></a></div><div class="footer-nav-list"><h5>Eclipse Vert.x</h5><ul class=""><li><a class="navbar-menu-item" href="/docs/">Docs</a></li><li><a href="/download/">Download</a></li><li><a href="/faq/">FAQ</a></li><li><a href="/blog/">Blog</a></li><li><a href="/community/">Community</a></li><li><a href="/channels/">Channels</a></li></ul></div><div class="footer-nav-list"><h5>Eclipse</h5><ul class=""><li><a href="https://www.eclipse.org/">Eclipse Foundation</a></li><li><a href="https://www.eclipse.org/legal/privacy.php">Privacy Policy</a></li><li><a href="https://www.eclipse.org/legal/termsofuse.php">Terms of Use</a></li><li><a href="https://www.eclipse.org/legal/copyright.php">Copyright Agent</a></li><li><a href="https://www.eclipse.org/legal/">Legal Resources</a></li></ul></div></div><div class="footer-copyright"><div class="footer-copyright-remarks">© <!-- -->2020<!-- --> Eclipse Vert.x<br/>Eclipse Vert.x is open source and dual-licensed under the <a href="https://creativecommons.org/licenses/by-sa/3.0/" target="_blank" rel="noopener noreferrer">Eclipse Public License 2.0</a> and the <a href="https://www.apache.org/licenses/LICENSE-2.0.html" target="_blank" rel="noopener noreferrer">Apache License 2.0</a>. <br class="footer-copyright-break"/>Website design by <a href="https://michelkraemer.com" target="_blank" rel="noopener noreferrer">Michel Krämer</a>.</div><div class="footer-copyright-eclipse-logo"><a href="https://www.eclipse.org/" target="_blank" rel="noopener noreferrer"><img src="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyODEuMyA5MS4xIiB4bWw6c3BhY2U9InByZXNlcnZlIj48c3R5bGU+LnN0MHtmaWxsOiNmNzk0MjJ9LnN0MXtmaWxsOiMzZDNjM2J9PC9zdHlsZT48ZyBpZD0iTGF5ZXJfMV8xXyI+PHBhdGggY2xhc3M9InN0MCIgZD0iTTI2NS43IDg0TDI1NyA3M2gtMi43djE3LjdoMy4zdi0xMmw5LjMgMTJoMi4xVjczaC0zLjN2MTF6bS0zMi40LTguM2M0LjIgMCA1LjggMy4zIDUuOCA2LjNzLTEuNiA2LTUuOCA2LTUuNy0zLjEtNS44LTYgMS43LTYuMyA1LjgtNi4zem0wLTNjLTYuMSAwLTkuMSA0LjctOS4xIDkuMyAwIDQuNyAyLjkgOS4xIDkuMSA5LjFzOS00LjYgOS4xLTkuMi0zLTkuMi05LjEtOS4yem0tMjEuMiAxOFY3M2gtMy4zdjE3LjdoMy4zem0tMjMuNiAwaDMuM1Y3Nmg1LjZ2LTNoLTE0LjZ2M2g1LjZsLjEgMTQuN3ptLTE4LjktNi41SDE2M2wzLjMtNy42IDMuMyA3LjZ6bTIuOCA2LjVoMy42TDE2OC4yIDczaC0zLjZsLTggMTcuN2gzLjZsMS41LTMuM2g5LjNsMS40IDMuM3ptLTM4LTE0LjZoMy42YzMuOSAwIDUuNSAyLjggNS41IDUuNS4xIDIuOC0xLjUgNS44LTUuNSA1LjhoLTMuNlY3Ni4xem0zLjctMy4xaC02Ljl2MTcuN2g2LjljNi4yIDAgOC45LTQuNSA4LjktOXMtMi44LTguNy04LjktOC43em0tMjIuNCAxMUwxMDcgNzNoLTIuN3YxNy43aDMuM3YtMTJsOS4zIDEyaDIuMVY3M2gtMy4zdjExek04OC4yIDczdjEwLjJjMCAzLTEuNiA0LjktNC4zIDQuOXMtNC42LTEuNy00LjYtNC45VjczSDc2djEwLjFjMCA1LjMgMy42IDcuOSA3LjkgNy45IDQuNCAwIDcuNy0yLjcgNy43LTcuOVY3M2gtMy40em0tMzMgMi43YzQuMiAwIDUuOCAzLjMgNS44IDYuM3MtMS42IDYtNS44IDYtNS43LTMuMS01LjgtNiAxLjctNi4zIDUuOC02LjN6bTAtM2MtNi4xIDAtOS4xIDQuNy05LjEgOS4zczIuOSA5LjEgOS4xIDkuMSA5LTQuNiA5LjEtOS4yLTMtOS4yLTkuMS05LjJ6bS0yOS43IDE4di02LjVoOC45di0zLjFoLTguOXYtNC44aDkuNFY3M0gyMi4ydjE3LjZoMy4zeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNjkuNCA1NC40aC0yMi4ydi04LjloMjEuNHYtNi45aC0yMS40di05LjFoMjIuMnYtNy4yaC0yOS42djM5LjVoMjkuNnYtNy40em0tNDAtMjUuNmMtMy02LjEtOS40LTcuOC0xNS41LTcuOC03LjMgMC0xNS4zIDMuNC0xNS4zIDExLjUgMCA4LjkgNy40IDExIDE1LjUgMTIgNS4yLjYgOS4xIDIuMSA5LjEgNS44IDAgNC4zLTQuNCA1LjktOS4xIDUuOXMtOS40LTEuOS0xMS4xLTYuM2wtNi4yIDMuMmMyLjkgNy4yIDkuMSA5LjcgMTcuMiA5LjcgOC44IDAgMTYuNi0zLjggMTYuNi0xMi42IDAtOS40LTcuNy0xMS42LTE1LjktMTIuNi00LjctLjYtOC44LTEuNS04LjgtNSAwLTIuOSAyLjYtNS4yIDguMi01LjIgNC4zIDAgOCAyLjIgOS40IDQuNGw1LjktM3pNMTc2IDIyLjJjLTYuMi0uMS0xMi40IDAtMTguNiAwdjM5LjVoNy40VjUwLjFIMTc2YzE5LjQgMCAxOS40LTI3LjkgMC0yNy45em0tMTEuMSA3LjFIMTc2YzkuNSAwIDkuNSAxNCAwIDE0aC0xMS4ybC4xLTE0em0tMTggMzIuNVYyMi4yaC03LjR2MzkuNWw3LjQuMXptLTQ0LTM5LjZ2MzkuNWgyNy43di02LjloLTIwLjNWMjIuMmgtNy40ek05MC43IDUxLjdjLTIuNyAyLjUtNi4yIDQtOS45IDQtOS44IDAtMTMuNS02LjgtMTMuNi0xMy40czQuMS0xMy43IDEzLjYtMTMuN2MzLjUtLjEgNyAxLjMgOS41IDMuN2w1LTQuOGMtMy44LTMuOS05LjEtNi0xNC41LTYtMTQuMyAwLTIxIDEwLjUtMjAuOSAyMC44czYuMyAyMC4zIDIwLjkgMjAuM2M1LjYuMSAxMS0yIDE1LTUuOWwtNS4xLTV6bS0zOSAyLjdIMjkuNXYtOC45aDIxLjR2LTYuOUgyOS41di05LjFoMjIuMnYtNy4ySDIyLjJ2MzkuNWgyOS42bC0uMS03LjR6Ii8+PHBhdGggY2xhc3M9InN0MCIgZD0iTTkuOCAxOC4yQzE4LjggNC4xIDM2LjktLjggNTIuMSA2bC0xLS43QzM1LjctNC42IDE1LjItLjEgNS4zIDE1LjNzLTUuNCAzNS45IDEwIDQ1LjhsMS4xLjZDMy44IDUwLjguOCAzMi4zIDkuOCAxOC4yeiIvPjxwYXRoIGNsYXNzPSJzdDEiIGQ9Ik0yNzIuMiAyNi4xYzAtMi41IDIuMS00LjYgNC42LTQuNiAyLjUgMCA0LjYgMi4xIDQuNiA0LjYgMCAyLjUtMi4xIDQuNi00LjYgNC42LTIuNiAwLTQuNi0yLjEtNC42LTQuNnptOC42IDBjMC0yLjItMS44LTQuMS00LTQuMXMtNC4xIDEuOC00LjEgNC4xYzAgMi4yIDEuNyA0IDMuOSA0LjFoLjFjMi4zIDAgNC4xLTEuOCA0LjEtNC4xem0tNi0yLjVoMi4zYzEuMSAwIDEuOS41IDEuOSAxLjYgMCAuNy0uNCAxLjMtMS4xIDEuNWwxLjIgMS43aC0xLjRsLTEtMS41aC0uN3YxLjVoLTEuMWwtLjEtNC44em0yLjIgMi4zYy41IDAgLjgtLjMuOC0uN3MtLjMtLjctLjgtLjdoLTF2MS4zbDEgLjF6Ii8+PC9nPjwvc3ZnPg==" alt="Eclipse foundation Logo"/></a></div></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"categories":["releases","guides","news"],"post":{"meta":{"title":"Vert.x 3 real time web apps","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"One of the interesting features of Vert.x is the SockJS event bus bridge. It allows external applications to communicate with Vert.x event bus using Websockets."},"date":"2015-08-31","slug":"vert-x3-real-time-web-apps","readingTime":{"text":"7 min read","minutes":6.975,"time":418500,"words":1395},"content":{"compiledSource":"\"use strict\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i \u003c arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i \u003c sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i \u003c sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) \u003e= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar layoutProps = {};\nvar MDXLayout = \"wrapper\";\n\nfunction MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"One of the in\\xADter\\xADest\\xADing fea\\xADtures of Vert.x is the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://sockjs.org\"\n  }), \"SockJS\"), \" event bus bridge. This piece of soft\\xADware\\nal\\xADlows ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtions to com\\xADmu\\xADni\\xADcate with Vert.x event bus using Web\\xADsock\\xADets and if your browser does not\\nsup\\xADport it then it grace\\xADfully de\\xADgrades to pool\\xADing AJAX calls.\"), mdx(\"p\", null, \"Web\\xADSock\\xADets bring a new level of in\\xADter\\xADac\\xADtion to the web, they re\\xADally bring real time to web ap\\xADpli\\xADca\\xADtions due to the\\nfact that its com\\xADmu\\xADni\\xADca\\xADtion model is bi-\\u200Bdirectional in con\\xADtrast to the tra\\xADdi\\xADtional HTTP model where a client can\\nini\\xADti\\xADate a data re\\xADquest to a server but not the other way around.\"), mdx(\"p\", null, \"In this small post I will demon\\xADstrate how you can cre\\xADate a sim\\xADple col\\xADlab\\xADo\\xADra\\xADtive draw\\xADing app. The idea is sim\\xADple, all\\nusers that open the app will be be pre\\xADsented with a empty can\\xADvas and what they draw or is drawn on other can\\xADvas is\\nshared in real time on their screen.\"), mdx(\"p\", null, \"For the sake of sim\\xADplic\\xADity and mak\\xADing this post light there is no se\\xADcu\\xADrity in\\xADvolved so, every\\xADone is free to lis\\xADten to\\nwhat is being drawn, how\\xADever the ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtion has lim\\xADited read write ac\\xADcess to a sin\\xADgle ad\\xADdress on Vert.x\\nevent bus, en\\xADsur\\xADing that other ser\\xADvices run\\xADning on the clus\\xADter will not be ex\\xADposed.\"), mdx(\"p\", null, \"This is what you should ex\\xADpect to see:\"), mdx(\"p\", null, mdx(\"img\", _extends({\n    parentName: \"p\"\n  }, {\n    \"src\": \"/images/blog/vertx3-realtime-webapps/screencast.gif\",\n    \"alt\": \"Screencast\"\n  }))), mdx(\"h2\", {\n    \"id\": \"bootstrap-a-project\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#bootstrap-a-project\"\n  })), \"Bootstrap a project\"), mdx(\"p\", null, \"If you fol\\xADlowed the pre\\xADvi\\xADous \", mdx(Link, {\n    href: \"/blog/my-first-vert-x-3-application/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"se\\xADries\")), \" on Vert.x de\\xADvel\\xADop\\xADment, you saw\\nthat Java and Maven were the main topic, since Vert.x is poly\\xADglot I will focus on JavaScript and\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/\"\n  }), \"NPM\"), \" as my pro\\xADgram\\xADming lan\\xADguage and pack\\xADage man\\xADage\\xADment tool.\"), mdx(\"p\", null, \"With NPM start by cre\\xADat\\xADing a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \", in order to do this we should run:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"npm init\\n\")), mdx(\"p\", null, \"This will present a se\\xADlec\\xADtion of ques\\xADtions and in the end you should have a basic \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"package.json\"), \" file. This\\ncon\\xADfig\\xADu\\xADra\\xADtion is very basic so you need to add a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.npmjs.com/package/vertx3-full\"\n  }), \"de\\xADpen\\xADdency\"), \" to Vert.x so\\nyou can run the ap\\xADpli\\xADca\\xADtion. You can add it to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"dependencies\"), \" prop\\xADerty and it should look more or less like this:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-javascript\"\n  }), \"{\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"name\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"draw\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"private\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"dependencies\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx3-full\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"3.0.0-1\\\"\"), \"\\n  },\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"scripts\\\"\"), \": {\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"start\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx run server.js\\\"\"), \"\\n  },\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"version\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"1.0.0\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"main\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"server.js\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"devDependencies\\\"\"), \": {},\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"author\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"license\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"ISC\\\"\"), \",\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"description\\\"\"), \": \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"A Real Time Drawing App\\\"\"), \"\\n}\\n\")), mdx(\"p\", null, \"If you do not know why there is the de\\xADpen\\xADdency on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx3-full\"), \" or why the added \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"scripts\"), \" prop\\xADerty please check the \", mdx(Link, {\n    href: \"/blog/vert-x3-says-hello-to-npm-users/\",\n    passHref: true,\n    mdxType: \"Link\"\n  }, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"\"\n  }), \"older\")), \" blog post about it.\"), mdx(\"h2\", {\n    \"id\": \"project-structure\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h2\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#project-structure\"\n  })), \"Project Structure\"), mdx(\"p\", null, \"This post has no pref\\xADer\\xADence over project struc\\xADture, so if you do not agree with the struc\\xADture used here feel free to\\nuse what you feel best. For this ex\\xADam\\xADple I will keep it to:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-text\"\n  }), \"\\u251C\\u2500\\u2500 package.json\\n\\u251C\\u2500\\u2500 server.js\\n\\u2514\\u2500\\u2500 webroot\\n  \\u251C\\u2500\\u2500 assets\\n  \\u2502\\xA0\\xA0 \\u2514\\u2500\\u2500 js\\n  \\u2502\\xA0\\xA0   \\u251C\\u2500\\u2500 script.js\\n  \\u2502\\xA0\\xA0   \\u2514\\u2500\\u2500 vertxbus.js\\n  \\u2514\\u2500\\u2500 index.html\\n\\n3 directories, 5 files\\n\")), mdx(\"p\", null, \"As you can imag\\xADine \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"server.js\"), \" will be our Vert.x ap\\xADpli\\xADca\\xADtion and every\\xADthing under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"webroot\"), \" will be the client\\nap\\xADpli\\xADca\\xADtion.\"), mdx(\"p\", null, \"The client ap\\xADpli\\xADca\\xADtion is not re\\xADally Vert.x spe\\xADcific and could in the\\xADory be used by any other frame\\xADwork so I will go\\nlightly over its code.\"), mdx(\"h3\", {\n    \"id\": \"client-application\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#client-application\"\n  })), \"Client Application\"), mdx(\"p\", null, \"Our ap\\xADpli\\xADca\\xADtion main entry point is as one can ex\\xADpect \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"index.html\"), \". In the index file de\\xADfine the fol\\xADlow\\xADing HTML:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-html\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-meta\"\n  }), \"\u003c!DOCTYPE \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-meta-keyword\"\n  }), \"html\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"html\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"head\"), \"\u003e\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"meta\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"charset\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"utf-8\\\"\"), \"/\u003e\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"title\"), \"\u003e\"), \"Real time drawing App\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"title\"), \"\u003e\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"\u003c!--[if lt IE 9]\u003e\\n  \u003cscript src=\\\"http://html5shiv.googlecode.com/svn/trunk/html5.js\\\"\u003e\u003c/script\u003e\\n  \u003c![endif]--\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"head\"), \"\u003e\"), \"\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"body\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"canvas\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"id\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"paper\\\"\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"width\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"1900\\\"\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"height\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"1000\\\"\"), \"\u003e\"), \"\\n  Your browser needs to support canvas for this to work!\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"canvas\"), \"\u003e\"), \"\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"\u003c!-- JavaScript includes. --\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"src\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"http://code.jquery.com/jquery-1.8.0.min.js\\\"\"), \"\u003e\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"src\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js\\\"\"), \"\u003e\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"src\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'assets/js/vertxbus.js'\"), \"\u003e\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-attr\"\n  }), \"src\"), \"=\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"assets/js/script.js\\\"\"), \"\u003e\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"script\"), \"\u003e\"), \"\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"body\"), \"\u003e\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-tag\"\n  }), \"\u003c/\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-name\"\n  }), \"html\"), \"\u003e\"), \"\\n\")), mdx(\"p\", null, \"As I pre\\xADvi\\xADously wrote, the idea is to keep it as sim\\xADple as pos\\xADsi\\xADble so it is all about hav\\xADing a can\\xADvas el\\xADe\\xADment and a\\nap\\xADpli\\xADca\\xADtion main script \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script.js\"), \". All the rest are files served by CDNs that pro\\xADvide com\\xADmon web ap\\xADpli\\xADca\\xADtion\\nli\\xADbraries such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jQuery\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"HTML5\"), \" shim for older browsers, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SockJS\"), \" client and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertxbus\"), \" bridge.\"), mdx(\"p\", null, \"The main code is on \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"script.js\"), \" file:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-javascript\"\n  }), \"$(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  })), \") \"), \"{\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// This demo depends on the canvas element\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (!(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'getContext'\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"in\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"document\"), \".createElement(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'canvas'\"), \"))) {\\n    alert(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'Sorry, it looks like your browser does not support canvas!'\"), \");\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"return\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \";\\n  }\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" doc = $(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"document\"), \"),\\n    canvas = $(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'#paper'\"), \"),\\n    ctx = canvas[\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"0\"), \"].getContext(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'2d'\"), \");\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Generate an unique ID\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" id = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"Math\"), \".round($.now() * \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"Math\"), \".random());\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// A flag for drawing activity\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" drawing = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \";\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" clients = {};\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// create a event bus bridge to the server that served this file\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" eb = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"new\"), \" vertx.EventBus(\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"window\"), \".location.protocol + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'//'\"), \" + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"window\"), \".location.hostname + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"':'\"), \" + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"window\"), \".location.port + \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'/eventbus'\"), \");\\n\\n  eb.onopen = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  })), \") \"), \"{\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// listen to draw events\"), \"\\n    eb.registerHandler(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'draw'\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"data\"), \") \"), \"{\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Is the user drawing?\"), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (data.drawing \u0026\u0026 clients[data.id]) {\\n\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Draw a line on the canvas. clients[data.id] holds\"), \"\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// the previous position of this user's mouse pointer\"), \"\\n\\n        drawLine(clients[data.id].x, clients[data.id].y, data.x, data.y);\\n      }\\n\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Saving the current client state\"), \"\\n      clients[data.id] = data;\\n      clients[data.id].updated = $.now();\\n    });\\n  };\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" prev = {};\\n\\n  canvas.on(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'mousedown'\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"e\"), \") \"), \"{\\n    e.preventDefault();\\n    drawing = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"true\"), \";\\n    prev.x = e.pageX;\\n    prev.y = e.pageY;\\n  });\\n\\n  doc.bind(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'mouseup mouseleave'\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  })), \") \"), \"{\\n    drawing = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-literal\"\n  }), \"false\"), \";\\n  });\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" lastEmit = $.now();\\n\\n  doc.on(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'mousemove'\"), \", \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"e\"), \") \"), \"{\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" ($.now() - lastEmit \u003e \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"30\"), \") {\\n      eb.publish(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'draw'\"), \", {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'x'\"), \": e.pageX,\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'y'\"), \": e.pageY,\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'drawing'\"), \": drawing,\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"'id'\"), \": id\\n      });\\n      lastEmit = $.now();\\n    }\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Draw a line for the current user's movement, as it is\"), \"\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// not received in the eventbus\"), \"\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (drawing) {\\n\\n      drawLine(prev.x, prev.y, e.pageX, e.pageY);\\n\\n      prev.x = e.pageX;\\n      prev.y = e.pageY;\\n    }\\n  });\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Remove inactive clients after 10 seconds of inactivity\"), \"\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"setInterval\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  })), \") \"), \"{\\n\\n    \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"for\"), \" (\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" ident \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"in\"), \" clients) {\\n      \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" (clients.hasOwnProperty(ident)) {\\n        \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"if\"), \" ($.now() - clients[ident].updated \u003e \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"10000\"), \") {\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Last update was more than 10 seconds ago.\"), \"\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// This user has probably closed the page\"), \"\\n          \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"delete\"), \" clients[ident];\\n        }\\n      }\\n    }\\n\\n  }, \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"10000\"), \");\\n\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-function\"\n  }), mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"function\"), \" \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-title\"\n  }), \"drawLine\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"hljs-params\"\n  }), \"fromx, fromy, tox, toy\"), \") \"), \"{\\n    ctx.moveTo(fromx, fromy);\\n    ctx.lineTo(tox, toy);\\n    ctx.stroke();\\n  }\\n\\n});\\n\")), mdx(\"p\", null, \"The most im\\xADpor\\xADtant part in this code is all the code re\\xADlated to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"eb\"), \". The vari\\xADable \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"eb\"), \" is our bridge to the event\\nbus, Start by cre\\xADat\\xADing a bridge using the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"vertx.EventBus\"), \" ob\\xADject and de\\xADfine where to con\\xADnect, using the de\\xADtails\\nof the cur\\xADrent win\\xADdow lo\\xADca\\xADtion.\"), mdx(\"p\", null, \"Then add a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"onopen\"), \" lis\\xADtener that will sub\\xADscribe to the ad\\xADdress \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"draw\"), \" on the event bus so it can lis\\xADten to all\\nmes\\xADsages re\\xADgard\\xADing draw\\xADing and per\\xADform the draw\\xADing ac\\xADtions. Since lis\\xADten\\xADing is not enough I also add a mouse lis\\xADtener\\nto the doc\\xADu\\xADment so when it moves it pub\\xADlishes events to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"draw\"), \" ad\\xADdress.\"), mdx(\"p\", null, \"Note that I am using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"publish\"), \" and not \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"send\"), \", the rea\\xADson should be ob\\xADvi\\xADous, I want every\\xADone to know this users mouse\\nmove\\xADments, I am not in\\xADter\\xADested on send\\xADing the events to just a sin\\xADgle user. You can see now that if you want to have\\na draw\\xADing app in a one on one user basis then in\\xADstead of \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"publish()\"), \" you should use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"send()\"), \".\"), mdx(\"h3\", {\n    \"id\": \"server-application\"\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"aria-hidden\": true,\n    \"tabIndex\": -1,\n    \"className\": \"heading-anchor\",\n    \"href\": \"#server-application\"\n  })), \"Server Application\"), mdx(\"p\", null, \"The server code is quite straight for\\xADward, all you need is:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-javascript\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" Router = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"require\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx-web-js/router\\\"\"), \");\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" SockJSHandler = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"require\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx-web-js/sock_js_handler\\\"\"), \");\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" StaticHandler = \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-built_in\"\n  }), \"require\"), \"(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"vertx-web-js/static_handler\\\"\"), \");\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" router = Router.router(vertx);\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Allow outbound traffic to the draw address\"), \"\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-keyword\"\n  }), \"var\"), \" options = {\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"outboundPermitteds\\\"\"), \" : [{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"address\\\"\"), \" : \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"draw\\\"\"), \"}],\\n  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"inboundPermitteds\\\"\"), \" :  [{\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"address\\\"\"), \" : \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"draw\\\"\"), \"}]\\n};\\n\\nrouter.route(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-string\"\n  }), \"\\\"/eventbus/*\\\"\"), \").handler(SockJSHandler.create(vertx).bridge(options).handle);\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-comment\"\n  }), \"// Serve the static resources\"), \"\\nrouter.route().handler(StaticHandler.create().handle);\\n\\nvertx.createHttpServer().requestHandler(router.accept).listen(\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"hljs-number\"\n  }), \"8080\"), \");\\n\")), mdx(\"p\", null, \"We start with the usual im\\xADports, we im\\xADport a ref\\xADer\\xADence to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Router\"), \" ob\\xADject and a cou\\xADple of helper han\\xADdlers\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SockJSHandler\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"StaticHandler\"), \". As their names should tell you one han\\xADdler will be re\\xADspon\\xADsi\\xADble to han\\xADdle all\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SockJS\"), \" data and the other all HTTP file serv\\xADing re\\xADquests.\"), mdx(\"p\", null, \"We then add then to a router and start a HTTP server that will han\\xADdle all in\\xADcom\\xADing re\\xADquest using the han\\xADdler ac\\xADcept\\nfunc\\xADtion. Fi\\xADnally we lis\\xADten on port \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"8080\"), \" and we are ready.\"), mdx(\"p\", null, \"Note that there is a op\\xADtions ob\\xADject where a cou\\xADple of prop\\xADer\\xADties are de\\xADfined \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"outbound/inbound\"), \" per\\xADmit\\xADted ad\\xADdresses.\\nWith\\xADout this con\\xADfig\\xADu\\xADra\\xADtion the ex\\xADter\\xADnal ap\\xADpli\\xADca\\xADtion will not be al\\xADlowed to con\\xADnect to the vert.x bus, in fact the\\nde\\xADfault con\\xADfig\\xADu\\xADra\\xADtion of the Sock\\xADJSHan\\xADdler is deny all. So you must spec\\xADify ex\\xADplic\\xADitly which ad\\xADdress are al\\xADlowed to\\nre\\xADceive mes\\xADsages from \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SockJS\"), \" and which ones are al\\xADlowed to send/pub\\xADlish to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"SockJS\"), \".\"), mdx(\"p\", null, \"Now you can start your ap\\xADpli\\xADca\\xADtion, don\\u2019t for\\xADget to in\\xADstall the de\\xADpen\\xADden\\xADcies for the first time:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"npm install\\n\")), mdx(\"p\", null, \"And then run the ap\\xADpli\\xADca\\xADtion:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"hljs language-bash\"\n  }), \"npm start\\n\")), mdx(\"p\", null, \"If you now open 2 browser win\\xADdows you will be able to draw nice pic\\xADtures and see the draw\\xADing show\\xADing in \\u201Creal time\\u201D\\non the other win\\xADdow, if you then draw on the sec\\xADond you should get the mir\\xADror ef\\xADfect on the first win\\xADdow.\"), mdx(\"p\", null, \"Have fun!\"));\n}\n\n;\nMDXContent.isMDXComponent = true;","renderedOutput":"\u003cp\u003eOne of the in­ter­est­ing fea­tures of Vert.x is the \u003ca href=\"http://sockjs.org\"\u003eSockJS\u003c/a\u003e event bus bridge. This piece of soft­ware\nal­lows ex­ter­nal ap­pli­ca­tions to com­mu­ni­cate with Vert.x event bus using Web­sock­ets and if your browser does not\nsup­port it then it grace­fully de­grades to pool­ing AJAX calls.\u003c/p\u003e\u003cp\u003eWeb­Sock­ets bring a new level of in­ter­ac­tion to the web, they re­ally bring real time to web ap­pli­ca­tions due to the\nfact that its com­mu­ni­ca­tion model is bi-​directional in con­trast to the tra­di­tional HTTP model where a client can\nini­ti­ate a data re­quest to a server but not the other way around.\u003c/p\u003e\u003cp\u003eIn this small post I will demon­strate how you can cre­ate a sim­ple col­lab­o­ra­tive draw­ing app. The idea is sim­ple, all\nusers that open the app will be be pre­sented with a empty can­vas and what they draw or is drawn on other can­vas is\nshared in real time on their screen.\u003c/p\u003e\u003cp\u003eFor the sake of sim­plic­ity and mak­ing this post light there is no se­cu­rity in­volved so, every­one is free to lis­ten to\nwhat is being drawn, how­ever the ex­ter­nal ap­pli­ca­tion has lim­ited read write ac­cess to a sin­gle ad­dress on Vert.x\nevent bus, en­sur­ing that other ser­vices run­ning on the clus­ter will not be ex­posed.\u003c/p\u003e\u003cp\u003eThis is what you should ex­pect to see:\u003c/p\u003e\u003cp\u003e\u003cimg src=\"/images/blog/vertx3-realtime-webapps/screencast.gif\" alt=\"Screencast\"/\u003e\u003c/p\u003e\u003ch2 id=\"bootstrap-a-project\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#bootstrap-a-project\"\u003e\u003c/a\u003eBootstrap a project\u003c/h2\u003e\u003cp\u003eIf you fol­lowed the pre­vi­ous \u003ca href=\"/blog/my-first-vert-x-3-application/\"\u003ese­ries\u003c/a\u003e on Vert.x de­vel­op­ment, you saw\nthat Java and Maven were the main topic, since Vert.x is poly­glot I will focus on JavaScript and\n\u003ca href=\"https://www.npmjs.com/\"\u003eNPM\u003c/a\u003e as my pro­gram­ming lan­guage and pack­age man­age­ment tool.\u003c/p\u003e\u003cp\u003eWith NPM start by cre­at­ing a \u003ccode\u003epackage.json\u003c/code\u003e, in order to do this we should run:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm init\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis will present a se­lec­tion of ques­tions and in the end you should have a basic \u003ccode\u003epackage.json\u003c/code\u003e file. This\ncon­fig­u­ra­tion is very basic so you need to add a \u003ca href=\"https://www.npmjs.com/package/vertx3-full\"\u003ede­pen­dency\u003c/a\u003e to Vert.x so\nyou can run the ap­pli­ca­tion. You can add it to the \u003ccode\u003edependencies\u003c/code\u003e prop­erty and it should look more or less like this:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e{\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;name\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;draw\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;private\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;dependencies\u0026quot;\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx3-full\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;3.0.0-1\u0026quot;\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;scripts\u0026quot;\u003c/span\u003e: {\n    \u003cspan class=\"hljs-string\"\u003e\u0026quot;start\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx run server.js\u0026quot;\u003c/span\u003e\n  },\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;version\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;1.0.0\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;main\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;server.js\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;devDependencies\u0026quot;\u003c/span\u003e: {},\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;author\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;license\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;ISC\u0026quot;\u003c/span\u003e,\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;description\u0026quot;\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;A Real Time Drawing App\u0026quot;\u003c/span\u003e\n}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIf you do not know why there is the de­pen­dency on \u003ccode\u003evertx3-full\u003c/code\u003e or why the added \u003ccode\u003escripts\u003c/code\u003e prop­erty please check the \u003ca href=\"/blog/vert-x3-says-hello-to-npm-users/\"\u003eolder\u003c/a\u003e blog post about it.\u003c/p\u003e\u003ch2 id=\"project-structure\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#project-structure\"\u003e\u003c/a\u003eProject Structure\u003c/h2\u003e\u003cp\u003eThis post has no pref­er­ence over project struc­ture, so if you do not agree with the struc­ture used here feel free to\nuse what you feel best. For this ex­am­ple I will keep it to:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-text\"\u003e├── package.json\n├── server.js\n└── webroot\n  ├── assets\n  │   └── js\n  │     ├── script.js\n  │     └── vertxbus.js\n  └── index.html\n\n3 directories, 5 files\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAs you can imag­ine \u003ccode\u003eserver.js\u003c/code\u003e will be our Vert.x ap­pli­ca­tion and every­thing under \u003ccode\u003ewebroot\u003c/code\u003e will be the client\nap­pli­ca­tion.\u003c/p\u003e\u003cp\u003eThe client ap­pli­ca­tion is not re­ally Vert.x spe­cific and could in the­ory be used by any other frame­work so I will go\nlightly over its code.\u003c/p\u003e\u003ch3 id=\"client-application\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#client-application\"\u003e\u003c/a\u003eClient Application\u003c/h3\u003e\u003cp\u003eOur ap­pli­ca­tion main entry point is as one can ex­pect \u003ccode\u003eindex.html\u003c/code\u003e. In the index file de­fine the fol­low­ing HTML:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-html\"\u003e\u003cspan class=\"hljs-meta\"\u003e\u0026lt;!DOCTYPE \u003cspan class=\"hljs-meta-keyword\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003emeta\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003echarset\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;utf-8\u0026quot;\u003c/span\u003e/\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003eReal time drawing App\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003etitle\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e\u0026lt;!--[if lt IE 9]\u0026gt;\n  \u0026lt;script src=\u0026quot;http://html5shiv.googlecode.com/svn/trunk/html5.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt;\n  \u0026lt;![endif]--\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehead\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;paper\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;1900\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eheight\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;1000\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n  Your browser needs to support canvas for this to work!\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ecanvas\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-comment\"\u003e\u0026lt;!-- JavaScript includes. --\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://code.jquery.com/jquery-1.8.0.min.js\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026#x27;assets/js/vertxbus.js\u0026#x27;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;assets/js/script.js\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ehtml\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAs I pre­vi­ously wrote, the idea is to keep it as sim­ple as pos­si­ble so it is all about hav­ing a can­vas el­e­ment and a\nap­pli­ca­tion main script \u003ccode\u003escript.js\u003c/code\u003e. All the rest are files served by CDNs that pro­vide com­mon web ap­pli­ca­tion\nli­braries such as \u003ccode\u003ejQuery\u003c/code\u003e, \u003ccode\u003eHTML5\u003c/code\u003e shim for older browsers, \u003ccode\u003eSockJS\u003c/code\u003e client and \u003ccode\u003evertxbus\u003c/code\u003e bridge.\u003c/p\u003e\u003cp\u003eThe main code is on \u003ccode\u003escript.js\u003c/code\u003e file:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e$(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\n  \u003cspan class=\"hljs-comment\"\u003e// This demo depends on the canvas element\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;getContext\u0026#x27;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;canvas\u0026#x27;\u003c/span\u003e))) {\n    alert(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Sorry, it looks like your browser does not support canvas!\u0026#x27;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e doc = $(\u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e),\n    canvas = $(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;#paper\u0026#x27;\u003c/span\u003e),\n    ctx = canvas[\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e].getContext(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;2d\u0026#x27;\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-comment\"\u003e// Generate an unique ID\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e id = \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.round($.now() * \u003cspan class=\"hljs-built_in\"\u003eMath\u003c/span\u003e.random());\n\n  \u003cspan class=\"hljs-comment\"\u003e// A flag for drawing activity\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e drawing = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e clients = {};\n  \u003cspan class=\"hljs-comment\"\u003e// create a event bus bridge to the server that served this file\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e eb = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e vertx.EventBus(\n      \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.location.protocol + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;//\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.location.hostname + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;:\u0026#x27;\u003c/span\u003e + \u003cspan class=\"hljs-built_in\"\u003ewindow\u003c/span\u003e.location.port + \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/eventbus\u0026#x27;\u003c/span\u003e);\n\n  eb.onopen = \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-comment\"\u003e// listen to draw events\u003c/span\u003e\n    eb.registerHandler(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;draw\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e) \u003c/span\u003e{\n      \u003cspan class=\"hljs-comment\"\u003e// Is the user drawing?\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (data.drawing \u0026amp;\u0026amp; clients[data.id]) {\n\n        \u003cspan class=\"hljs-comment\"\u003e// Draw a line on the canvas. clients[data.id] holds\u003c/span\u003e\n        \u003cspan class=\"hljs-comment\"\u003e// the previous position of this user\u0026#x27;s mouse pointer\u003c/span\u003e\n\n        drawLine(clients[data.id].x, clients[data.id].y, data.x, data.y);\n      }\n\n      \u003cspan class=\"hljs-comment\"\u003e// Saving the current client state\u003c/span\u003e\n      clients[data.id] = data;\n      clients[data.id].updated = $.now();\n    });\n  };\n\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e prev = {};\n\n  canvas.on(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;mousedown\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n    e.preventDefault();\n    drawing = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n    prev.x = e.pageX;\n    prev.y = e.pageY;\n  });\n\n  doc.bind(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;mouseup mouseleave\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n    drawing = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n  });\n\n  \u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e lastEmit = $.now();\n\n  doc.on(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;mousemove\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ($.now() - lastEmit \u0026gt; \u003cspan class=\"hljs-number\"\u003e30\u003c/span\u003e) {\n      eb.publish(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;draw\u0026#x27;\u003c/span\u003e, {\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;x\u0026#x27;\u003c/span\u003e: e.pageX,\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;y\u0026#x27;\u003c/span\u003e: e.pageY,\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;drawing\u0026#x27;\u003c/span\u003e: drawing,\n        \u003cspan class=\"hljs-string\"\u003e\u0026#x27;id\u0026#x27;\u003c/span\u003e: id\n      });\n      lastEmit = $.now();\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// Draw a line for the current user\u0026#x27;s movement, as it is\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e// not received in the eventbus\u003c/span\u003e\n\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (drawing) {\n\n      drawLine(prev.x, prev.y, e.pageX, e.pageY);\n\n      prev.x = e.pageX;\n      prev.y = e.pageY;\n    }\n  });\n\n  \u003cspan class=\"hljs-comment\"\u003e// Remove inactive clients after 10 seconds of inactivity\u003c/span\u003e\n  \u003cspan class=\"hljs-built_in\"\u003esetInterval\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) \u003c/span\u003e{\n\n    \u003cspan class=\"hljs-keyword\"\u003efor\u003c/span\u003e (\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e ident \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e clients) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (clients.hasOwnProperty(ident)) {\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e ($.now() - clients[ident].updated \u0026gt; \u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e) {\n          \u003cspan class=\"hljs-comment\"\u003e// Last update was more than 10 seconds ago.\u003c/span\u003e\n          \u003cspan class=\"hljs-comment\"\u003e// This user has probably closed the page\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword\"\u003edelete\u003c/span\u003e clients[ident];\n        }\n      }\n    }\n\n  }, \u003cspan class=\"hljs-number\"\u003e10000\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003edrawLine\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003efromx, fromy, tox, toy\u003c/span\u003e) \u003c/span\u003e{\n    ctx.moveTo(fromx, fromy);\n    ctx.lineTo(tox, toy);\n    ctx.stroke();\n  }\n\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe most im­por­tant part in this code is all the code re­lated to \u003ccode\u003eeb\u003c/code\u003e. The vari­able \u003ccode\u003eeb\u003c/code\u003e is our bridge to the event\nbus, Start by cre­at­ing a bridge using the \u003ccode\u003evertx.EventBus\u003c/code\u003e ob­ject and de­fine where to con­nect, using the de­tails\nof the cur­rent win­dow lo­ca­tion.\u003c/p\u003e\u003cp\u003eThen add a \u003ccode\u003eonopen\u003c/code\u003e lis­tener that will sub­scribe to the ad­dress \u003ccode\u003edraw\u003c/code\u003e on the event bus so it can lis­ten to all\nmes­sages re­gard­ing draw­ing and per­form the draw­ing ac­tions. Since lis­ten­ing is not enough I also add a mouse lis­tener\nto the doc­u­ment so when it moves it pub­lishes events to the \u003ccode\u003edraw\u003c/code\u003e ad­dress.\u003c/p\u003e\u003cp\u003eNote that I am using \u003ccode\u003epublish\u003c/code\u003e and not \u003ccode\u003esend\u003c/code\u003e, the rea­son should be ob­vi­ous, I want every­one to know this users mouse\nmove­ments, I am not in­ter­ested on send­ing the events to just a sin­gle user. You can see now that if you want to have\na draw­ing app in a one on one user basis then in­stead of \u003ccode\u003epublish()\u003c/code\u003e you should use \u003ccode\u003esend()\u003c/code\u003e.\u003c/p\u003e\u003ch3 id=\"server-application\"\u003e\u003ca aria-hidden=\"true\" tabindex=\"-1\" class=\"heading-anchor\" href=\"#server-application\"\u003e\u003c/a\u003eServer Application\u003c/h3\u003e\u003cp\u003eThe server code is quite straight for­ward, all you need is:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e Router = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx-web-js/router\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e SockJSHandler = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx-web-js/sock_js_handler\u0026quot;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e StaticHandler = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;vertx-web-js/static_handler\u0026quot;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e router = Router.router(vertx);\n\n\u003cspan class=\"hljs-comment\"\u003e// Allow outbound traffic to the draw address\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003evar\u003c/span\u003e options = {\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;outboundPermitteds\u0026quot;\u003c/span\u003e : [{\u003cspan class=\"hljs-string\"\u003e\u0026quot;address\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;draw\u0026quot;\u003c/span\u003e}],\n  \u003cspan class=\"hljs-string\"\u003e\u0026quot;inboundPermitteds\u0026quot;\u003c/span\u003e :  [{\u003cspan class=\"hljs-string\"\u003e\u0026quot;address\u0026quot;\u003c/span\u003e : \u003cspan class=\"hljs-string\"\u003e\u0026quot;draw\u0026quot;\u003c/span\u003e}]\n};\n\nrouter.route(\u003cspan class=\"hljs-string\"\u003e\u0026quot;/eventbus/*\u0026quot;\u003c/span\u003e).handler(SockJSHandler.create(vertx).bridge(options).handle);\n\n\u003cspan class=\"hljs-comment\"\u003e// Serve the static resources\u003c/span\u003e\nrouter.route().handler(StaticHandler.create().handle);\n\nvertx.createHttpServer().requestHandler(router.accept).listen(\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWe start with the usual im­ports, we im­port a ref­er­ence to the \u003ccode\u003eRouter\u003c/code\u003e ob­ject and a cou­ple of helper han­dlers\n\u003ccode\u003eSockJSHandler\u003c/code\u003e and \u003ccode\u003eStaticHandler\u003c/code\u003e. As their names should tell you one han­dler will be re­spon­si­ble to han­dle all\n\u003ccode\u003eSockJS\u003c/code\u003e data and the other all HTTP file serv­ing re­quests.\u003c/p\u003e\u003cp\u003eWe then add then to a router and start a HTTP server that will han­dle all in­com­ing re­quest using the han­dler ac­cept\nfunc­tion. Fi­nally we lis­ten on port \u003ccode\u003e8080\u003c/code\u003e and we are ready.\u003c/p\u003e\u003cp\u003eNote that there is a op­tions ob­ject where a cou­ple of prop­er­ties are de­fined \u003ccode\u003eoutbound/inbound\u003c/code\u003e per­mit­ted ad­dresses.\nWith­out this con­fig­u­ra­tion the ex­ter­nal ap­pli­ca­tion will not be al­lowed to con­nect to the vert.x bus, in fact the\nde­fault con­fig­u­ra­tion of the Sock­JSHan­dler is deny all. So you must spec­ify ex­plic­itly which ad­dress are al­lowed to\nre­ceive mes­sages from \u003ccode\u003eSockJS\u003c/code\u003e and which ones are al­lowed to send/pub­lish to \u003ccode\u003eSockJS\u003c/code\u003e.\u003c/p\u003e\u003cp\u003eNow you can start your ap­pli­ca­tion, don’t for­get to in­stall the de­pen­den­cies for the first time:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm install\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAnd then run the ap­pli­ca­tion:\u003c/p\u003e\u003cpre\u003e\u003ccode class=\"hljs language-bash\"\u003enpm start\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eIf you now open 2 browser win­dows you will be able to draw nice pic­tures and see the draw­ing show­ing in “real time”\non the other win­dow, if you then draw on the sec­ond you should get the mir­ror ef­fect on the first win­dow.\u003c/p\u003e\u003cp\u003eHave fun!\u003c/p\u003e","scope":{}}},"prevPost":{"meta":{"title":"Writing secure Vert.x Web apps","category":"guides","authors":[{"name":"Paulo Lopes","github_id":"pmlopes"}],"summary":"This is a starting guide for securing Vert.x web applications. Standard rules and practices apply to Vert.x apps as if they would to any other web framework."},"date":"2015-09-14","slug":"writing-secure-vert-x-web-apps"},"nextPost":{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},"relatedPosts":[{"meta":{"title":"Unit and Integration Tests","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Let’s refresh our mind about what we developed so far in the introduction to vert.x series. We forgot an important task. We didn’t test the API."},"date":"2015-08-03","slug":"unit-and-integration-tests"},{"meta":{"title":"Combine vert.x and mongo to build a giant","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"This blog post is part of the introduction to Vert.x series. We are now going to replace this JDBC client by the vertx-mongo-client, and thus connect to a Mongo database."},"date":"2015-11-30","slug":"combine-vert-x-and-mongo-to-build-a-giant"},{"meta":{"title":"Using the asynchronous SQL client","category":"guides","authors":[{"name":"Clement Escoffier","github_id":"cescoffier"}],"summary":"Finally, back... This post is the fifth post of the introduction to vert.x blog series, after a not-that-small break. In this post we are going to see how we can use JDBC in a vert.x application."},"date":"2015-10-19","slug":"using-the-asynchronous-sql-client"}]},"__N_SSG":true},"page":"/blog/[[...slug]]","query":{"slug":["vert-x3-real-time-web-apps"]},"buildId":"sCg9mz3_RXk8PIIBHJVcF","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-7cde6f5ea12aaa40097b.js"></script><script src="/_next/static/chunks/main-b6e20584df76f29b6f35.js" async=""></script><script src="/_next/static/chunks/webpack-d7b2fb72fb7257504a38.js" async=""></script><script src="/_next/static/chunks/framework.fcef98db13e2318579fb.js" async=""></script><script src="/_next/static/chunks/commons.5b8771ac6e8a338f82f1.js" async=""></script><script src="/_next/static/chunks/styles.6a5cc0a07ce13c54adf1.js" async=""></script><script src="/_next/static/chunks/pages/_app-3dbbc9c041333077c167.js" async=""></script><script src="/_next/static/chunks/5e2acbba0c73eb7c5c0e969bcd552d3808de9969.4d0eb9c3d4239c66cc89.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5B%5B...slug%5D%5D-e52c21bde616652a406f.js" async=""></script><script src="/_next/static/sCg9mz3_RXk8PIIBHJVcF/_buildManifest.js" async=""></script><script src="/_next/static/sCg9mz3_RXk8PIIBHJVcF/_ssgManifest.js" async=""></script></body></html>